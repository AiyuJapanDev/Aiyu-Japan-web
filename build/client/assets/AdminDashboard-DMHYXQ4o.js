import{t as Bs,p as e,a as l,R as wt,w as ea,v as ta}from"./chunk-4WY6JWTD-CQ2BrMui.js";import{u as sa}from"./AppContext-ASKE5L8w.js";import{u as ra}from"./useAuth-DROiUoFu.js";import{B as S,b as Qs}from"./button-B0x8FPUr.js";import{B as aa,u as pt,k as zs,G as na,t as jt,q as ms,M as ia,C as oa}from"./index-Ce6NvDUG.js";import{s as C}from"./client-D-irrw7s.js";import{L as cs,P as la}from"./ProtectedRoute-DFjb99Eu.js";import{C as ca,M as da}from"./menu-DTJiNrxO.js";import{X as hs,D as Le,a as Fe,b as Ue,c as $e,f as Yt,d as Je,e as Ze,g as Hs,O as ua,P as ma,W as ha,C as pa,T as xa,h as ga,i as Vs,R as fa,j as ja}from"./dialog-Sc23x6E5.js";import{P as ye}from"./package-CQEqUhWv.js";import{c as Ft,u as st}from"./index-BNeLBswU.js";import{T as et,S as va}from"./truck-DVkQtnrb.js";import{m as as,t as De,n as yt,o as wa,p as ks,q as ba,r as Xs,s as ya,l as Na,e as _a,f as Sa,g as Ps,h as Et,i as Ca,j as Tt,R as Gs,a as qt,C as Ot,b as Ks,D as ps,k as Js,H as ka,u as Me,v as Pa,w as Ia,x as qe,y as Da,z as At,A as Is,B as Ra,U as Ea,P as Ta,S as Ds,T as Aa,c as Oa,N as qa}from"./NotificationsView-CuIv8_ER.js";import{I as $}from"./input-CM33OdNU.js";import{B as Ie,C as Bt,c as ke}from"./badge-CCGCsnjh.js";import{C as V,c as Z,a as Pe,b as tt,d as xs}from"./card-SCvgtUFv.js";import{c as gs,b as We,a as Ne,e as Ma,f as La}from"./Combination-BRrAW_Vh.js";import{c as Zs,R as Fa,I as Ua}from"./index-B51jR1Lo.js";import{P as Ut}from"./index-B_pwq4tm.js";import{u as er,C as fs}from"./index-Cc9y-45e.js";import{c as ue}from"./utils-CDN07tui.js";import{S as ut}from"./skeleton-BFc3on2W.js";import{S as tr}from"./search-BPGFXk71.js";import{E as Rs}from"./eye-C2ugwyJB.js";import{C as js,a as vs,b as ws}from"./collapsible-0hcxGzXU.js";import{L as z}from"./label-DN8oXECS.js";import{T as ds}from"./textarea-DhCnVIFz.js";import{S as Nt,a as _t,b as St,c as Ct,d as U,C as $a,e as Wa}from"./select-D1jRWDQg.js";import{u as ns}from"./use-toast-aoUui9pM.js";import{C as Es,L as Mt}from"./link-BJqyYBkU.js";import{F as Ya,T as Ba}from"./trash-2-BEv6Pjd1.js";import{b as Ts}from"./index-CobyQ-6_.js";import{C as As}from"./circle-check-big-QBdueTg8.js";import{P as Os}from"./plus-DnVR-hSP.js";import{u as ht,a as Qa}from"./index-Bc3lnN9I.js";import{S as qs}from"./send--J3t3OJ8.js";import"./index-CwuhT9dy.js";import"./index-B_jtOnfb.js";import"./index-DQ6zQjx3.js";import"./tslib.es6-DcwbYiNs.js";import"./index-DnUP4w3H.js";const za=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Ha=Ft("calendar",za);const Va=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Xa=Ft("settings",Va);const Ga=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ka=Ft("users",Ga);const Ja=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11",key:"pb2vm6"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z",key:"doq5xv"}],["path",{d:"M6 13h12",key:"yf64js"}],["path",{d:"M6 17h12",key:"1jwigz"}]],Za=Ft("warehouse",Ja);const en=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],tn=Ft("weight",en);function Lt(t,s){const r=as(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,i=De(t,s?.in),u=i.getDay(),h=(u<a?7:0)+u-a;return i.setDate(i.getDate()-h),i.setHours(0,0,0,0),i}function Vt(t,s){return Lt(t,{...s,weekStartsOn:1})}function sr(t,s){const r=De(t,s?.in),a=r.getFullYear(),i=yt(r,0);i.setFullYear(a+1,0,4),i.setHours(0,0,0,0);const u=Vt(i),h=yt(r,0);h.setFullYear(a,0,4),h.setHours(0,0,0,0);const g=Vt(h);return r.getTime()>=u.getTime()?a+1:r.getTime()>=g.getTime()?a:a-1}function Ms(t,s){const r=De(t,s?.in);return r.setHours(0,0,0,0),r}function sn(t,s,r){const[a,i]=wa(r?.in,t,s),u=Ms(a),h=Ms(i),g=+u-ks(u),p=+h-ks(h);return Math.round((g-p)/ba)}function rn(t,s){const r=sr(t,s),a=yt(t,0);return a.setFullYear(r,0,4),a.setHours(0,0,0,0),Vt(a)}function an(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function nn(t){return!(!an(t)&&typeof t!="number"||isNaN(+De(t)))}function on(t,s){const r=De(t,s?.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ln(t,s){const r=De(t,s?.in);return sn(r,on(r))+1}function cn(t,s){const r=De(t,s?.in),a=+Vt(r)-+rn(r);return Math.round(a/Xs)+1}function rr(t,s){const r=De(t,s?.in),a=r.getFullYear(),i=as(),u=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??i.firstWeekContainsDate??i.locale?.options?.firstWeekContainsDate??1,h=yt(s?.in||t,0);h.setFullYear(a+1,0,u),h.setHours(0,0,0,0);const g=Lt(h,s),p=yt(s?.in||t,0);p.setFullYear(a,0,u),p.setHours(0,0,0,0);const x=Lt(p,s);return+r>=+g?a+1:+r>=+x?a:a-1}function dn(t,s){const r=as(),a=s?.firstWeekContainsDate??s?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,i=rr(t,s),u=yt(s?.in||t,0);return u.setFullYear(i,0,a),u.setHours(0,0,0,0),Lt(u,s)}function un(t,s){const r=De(t,s?.in),a=+Lt(r,s)-+dn(r,s);return Math.round(a/Xs)+1}function F(t,s){const r=t<0?"-":"",a=Math.abs(t).toString().padStart(s,"0");return r+a}const Ke={y(t,s){const r=t.getFullYear(),a=r>0?r:1-r;return F(s==="yy"?a%100:a,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):F(r+1,2)},d(t,s){return F(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return F(t.getHours()%12||12,s.length)},H(t,s){return F(t.getHours(),s.length)},m(t,s){return F(t.getMinutes(),s.length)},s(t,s){return F(t.getSeconds(),s.length)},S(t,s){const r=s.length,a=t.getMilliseconds(),i=Math.trunc(a*Math.pow(10,r-3));return F(i,s.length)}},vt={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ls={G:function(t,s,r){const a=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(a,{width:"abbreviated"});case"GGGGG":return r.era(a,{width:"narrow"});case"GGGG":default:return r.era(a,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const a=t.getFullYear(),i=a>0?a:1-a;return r.ordinalNumber(i,{unit:"year"})}return Ke.y(t,s)},Y:function(t,s,r,a){const i=rr(t,a),u=i>0?i:1-i;if(s==="YY"){const h=u%100;return F(h,2)}return s==="Yo"?r.ordinalNumber(u,{unit:"year"}):F(u,s.length)},R:function(t,s){const r=sr(t);return F(r,s.length)},u:function(t,s){const r=t.getFullYear();return F(r,s.length)},Q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(a);case"QQ":return F(a,2);case"Qo":return r.ordinalNumber(a,{unit:"quarter"});case"QQQ":return r.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(a,{width:"wide",context:"formatting"})}},q:function(t,s,r){const a=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(a);case"qq":return F(a,2);case"qo":return r.ordinalNumber(a,{unit:"quarter"});case"qqq":return r.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(a,{width:"wide",context:"standalone"})}},M:function(t,s,r){const a=t.getMonth();switch(s){case"M":case"MM":return Ke.M(t,s);case"Mo":return r.ordinalNumber(a+1,{unit:"month"});case"MMM":return r.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(a,{width:"wide",context:"formatting"})}},L:function(t,s,r){const a=t.getMonth();switch(s){case"L":return String(a+1);case"LL":return F(a+1,2);case"Lo":return r.ordinalNumber(a+1,{unit:"month"});case"LLL":return r.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(a,{width:"wide",context:"standalone"})}},w:function(t,s,r,a){const i=un(t,a);return s==="wo"?r.ordinalNumber(i,{unit:"week"}):F(i,s.length)},I:function(t,s,r){const a=cn(t);return s==="Io"?r.ordinalNumber(a,{unit:"week"}):F(a,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):Ke.d(t,s)},D:function(t,s,r){const a=ln(t);return s==="Do"?r.ordinalNumber(a,{unit:"dayOfYear"}):F(a,s.length)},E:function(t,s,r){const a=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(a,{width:"short",context:"formatting"});case"EEEE":default:return r.day(a,{width:"wide",context:"formatting"})}},e:function(t,s,r,a){const i=t.getDay(),u=(i-a.weekStartsOn+8)%7||7;switch(s){case"e":return String(u);case"ee":return F(u,2);case"eo":return r.ordinalNumber(u,{unit:"day"});case"eee":return r.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(i,{width:"short",context:"formatting"});case"eeee":default:return r.day(i,{width:"wide",context:"formatting"})}},c:function(t,s,r,a){const i=t.getDay(),u=(i-a.weekStartsOn+8)%7||7;switch(s){case"c":return String(u);case"cc":return F(u,s.length);case"co":return r.ordinalNumber(u,{unit:"day"});case"ccc":return r.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(i,{width:"narrow",context:"standalone"});case"cccccc":return r.day(i,{width:"short",context:"standalone"});case"cccc":default:return r.day(i,{width:"wide",context:"standalone"})}},i:function(t,s,r){const a=t.getDay(),i=a===0?7:a;switch(s){case"i":return String(i);case"ii":return F(i,s.length);case"io":return r.ordinalNumber(i,{unit:"day"});case"iii":return r.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(a,{width:"short",context:"formatting"});case"iiii":default:return r.day(a,{width:"wide",context:"formatting"})}},a:function(t,s,r){const i=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(t,s,r){const a=t.getHours();let i;switch(a===12?i=vt.noon:a===0?i=vt.midnight:i=a/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(t,s,r){const a=t.getHours();let i;switch(a>=17?i=vt.evening:a>=12?i=vt.afternoon:a>=4?i=vt.morning:i=vt.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let a=t.getHours()%12;return a===0&&(a=12),r.ordinalNumber(a,{unit:"hour"})}return Ke.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):Ke.H(t,s)},K:function(t,s,r){const a=t.getHours()%12;return s==="Ko"?r.ordinalNumber(a,{unit:"hour"}):F(a,s.length)},k:function(t,s,r){let a=t.getHours();return a===0&&(a=24),s==="ko"?r.ordinalNumber(a,{unit:"hour"}):F(a,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):Ke.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):Ke.s(t,s)},S:function(t,s){return Ke.S(t,s)},X:function(t,s,r){const a=t.getTimezoneOffset();if(a===0)return"Z";switch(s){case"X":return Us(a);case"XXXX":case"XX":return mt(a);case"XXXXX":case"XXX":default:return mt(a,":")}},x:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"x":return Us(a);case"xxxx":case"xx":return mt(a);case"xxxxx":case"xxx":default:return mt(a,":")}},O:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+Fs(a,":");case"OOOO":default:return"GMT"+mt(a,":")}},z:function(t,s,r){const a=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+Fs(a,":");case"zzzz":default:return"GMT"+mt(a,":")}},t:function(t,s,r){const a=Math.trunc(+t/1e3);return F(a,s.length)},T:function(t,s,r){return F(+t,s.length)}};function Fs(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),i=Math.trunc(a/60),u=a%60;return u===0?r+String(i):r+String(i)+s+F(u,2)}function Us(t,s){return t%60===0?(t>0?"-":"+")+F(Math.abs(t)/60,2):mt(t,s)}function mt(t,s=""){const r=t>0?"-":"+",a=Math.abs(t),i=F(Math.trunc(a/60),2),u=F(a%60,2);return r+i+s+u}const $s=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},ar=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},mn=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],a=r[1],i=r[2];if(!i)return $s(t,s);let u;switch(a){case"P":u=s.dateTime({width:"short"});break;case"PP":u=s.dateTime({width:"medium"});break;case"PPP":u=s.dateTime({width:"long"});break;case"PPPP":default:u=s.dateTime({width:"full"});break}return u.replace("{{date}}",$s(a,s)).replace("{{time}}",ar(i,s))},hn={p:ar,P:mn},pn=/^D+$/,xn=/^Y+$/,gn=["D","DD","YY","YYYY"];function fn(t){return pn.test(t)}function jn(t){return xn.test(t)}function vn(t,s,r){const a=wn(t,s,r);if(console.warn(a),gn.includes(t))throw new RangeError(a)}function wn(t,s,r){const a=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${a} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const bn=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,yn=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Nn=/^'([^]*?)'?$/,_n=/''/g,Sn=/[a-zA-Z]/;function Qt(t,s,r){const a=as(),i=a.locale??ya,u=a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,h=a.weekStartsOn??a.locale?.options?.weekStartsOn??0,g=De(t,r?.in);if(!nn(g))throw new RangeError("Invalid time value");let p=s.match(yn).map(f=>{const w=f[0];if(w==="p"||w==="P"){const N=hn[w];return N(f,i.formatLong)}return f}).join("").match(bn).map(f=>{if(f==="''")return{isToken:!1,value:"'"};const w=f[0];if(w==="'")return{isToken:!1,value:Cn(f)};if(Ls[w])return{isToken:!0,value:f};if(w.match(Sn))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");return{isToken:!1,value:f}});i.localize.preprocessor&&(p=i.localize.preprocessor(g,p));const x={firstWeekContainsDate:u,weekStartsOn:h,locale:i};return p.map(f=>{if(!f.isToken)return f.value;const w=f.value;(jn(w)||fn(w))&&vn(w,s,String(t));const N=Ls[w[0]];return N(g,w,i.localize,x)}).join("")}function Cn(t){const s=t.match(Nn);return s?s[1].replace(_n,"'"):t}const kn=({activeTab:t,setActiveTab:s,isMobile:r,sidebarOpen:a,setSidebarOpen:i,refetchUsers:u})=>{const h=Bs(),g=[{id:"requests",label:"Product Requests",icon:ye},{id:"storage",label:"Storage",icon:Za},{id:"shipping-requests",label:"Shipping Requests",icon:et},{id:"users",label:"User Management",icon:Ka},{id:"notifications",label:"Notifications",icon:aa},{id:"analytics",label:"Analytics",icon:Na},{id:"settings",label:"Settings",icon:Xa}];return e.jsxs("div",{className:`${r?"fixed inset-y-0 left-0 z-50 w-64 bg-white/95 backdrop-blur-sm border-r border-blue-200 transform transition-transform duration-300":"w-64 bg-white/90 backdrop-blur-sm border-r border-blue-200 min-h-screen"} ${r&&!a?"-translate-x-full":"translate-x-0"} p-6`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-300 to-blue-400 rounded-full flex items-center justify-center",children:e.jsx(ca,{className:"text-white w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-800",children:"Admin Panel"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Website Management"})]})]}),r&&e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>i(!1),children:e.jsx(hs,{className:"h-4 w-4"})})]}),e.jsx("nav",{className:"space-y-2",children:g.map(p=>{const x=p.icon;return e.jsxs(S,{variant:t===p.id?"default":"ghost",className:"w-full justify-start",onClick:()=>{h(`/admin-dashboard?tab=${p.id}`,{replace:!0}),r&&i(!1),p.id==="users"&&u()},children:[e.jsx(x,{className:"mr-2 h-4 w-4"}),p.label]},p.id)})})]})};var is="Tabs",[Pn]=gs(is,[Zs]),nr=Zs(),[In,bs]=Pn(is),ir=l.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,onValueChange:i,defaultValue:u,orientation:h="horizontal",dir:g,activationMode:p="automatic",...x}=t,f=er(g),[w,N]=Ma({prop:a,onChange:i,defaultProp:u??"",caller:is});return e.jsx(In,{scope:r,baseId:La(),value:w,onValueChange:N,orientation:h,dir:f,activationMode:p,children:e.jsx(We.div,{dir:f,"data-orientation":h,...x,ref:s})})});ir.displayName=is;var or="TabsList",lr=l.forwardRef((t,s)=>{const{__scopeTabs:r,loop:a=!0,...i}=t,u=bs(or,r),h=nr(r);return e.jsx(Fa,{asChild:!0,...h,orientation:u.orientation,dir:u.dir,loop:a,children:e.jsx(We.div,{role:"tablist","aria-orientation":u.orientation,...i,ref:s})})});lr.displayName=or;var cr="TabsTrigger",dr=l.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,disabled:i=!1,...u}=t,h=bs(cr,r),g=nr(r),p=hr(h.baseId,a),x=pr(h.baseId,a),f=a===h.value;return e.jsx(Ua,{asChild:!0,...g,focusable:!i,active:f,children:e.jsx(We.button,{type:"button",role:"tab","aria-selected":f,"aria-controls":x,"data-state":f?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:p,...u,ref:s,onMouseDown:Ne(t.onMouseDown,w=>{!i&&w.button===0&&w.ctrlKey===!1?h.onValueChange(a):w.preventDefault()}),onKeyDown:Ne(t.onKeyDown,w=>{[" ","Enter"].includes(w.key)&&h.onValueChange(a)}),onFocus:Ne(t.onFocus,()=>{const w=h.activationMode!=="manual";!f&&!i&&w&&h.onValueChange(a)})})})});dr.displayName=cr;var ur="TabsContent",mr=l.forwardRef((t,s)=>{const{__scopeTabs:r,value:a,forceMount:i,children:u,...h}=t,g=bs(ur,r),p=hr(g.baseId,a),x=pr(g.baseId,a),f=a===g.value,w=l.useRef(f);return l.useEffect(()=>{const N=requestAnimationFrame(()=>w.current=!1);return()=>cancelAnimationFrame(N)},[]),e.jsx(Ut,{present:i||f,children:({present:N})=>e.jsx(We.div,{"data-state":f?"active":"inactive","data-orientation":g.orientation,role:"tabpanel","aria-labelledby":p,hidden:!N,id:x,tabIndex:0,...h,ref:s,style:{...t.style,animationDuration:w.current?"0s":void 0},children:N&&u})})});mr.displayName=ur;function hr(t,s){return`${t}-trigger-${s}`}function pr(t,s){return`${t}-content-${s}`}var Dn=ir,xr=lr,gr=dr,fr=mr;const Rn=Dn,jr=l.forwardRef(({className:t,...s},r)=>e.jsx(xr,{ref:r,className:ue("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));jr.displayName=xr.displayName;const zt=l.forwardRef(({className:t,...s},r)=>e.jsx(gr,{ref:r,className:ue("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));zt.displayName=gr.displayName;const Ht=l.forwardRef(({className:t,...s},r)=>e.jsx(fr,{ref:r,className:ue("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ht.displayName=fr.displayName;function En({user:t,open:s,onOpenChange:r}){const{data:a,isLoading:i}=pt({queryKey:["user-profile",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:x,error:f}=await C.from("profiles").select("*").eq("id",t.id).single();if(f)throw f;return x},enabled:s&&!!t?.id}),{data:u,isLoading:h}=pt({queryKey:["user-orders",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:x,error:f}=await C.from("orders").select("*, order_items(id)").eq("user_id",t.id).order("created_at",{ascending:!1});if(f)throw f;return x},enabled:s&&!!t?.id}),{data:g,isLoading:p}=pt({queryKey:["user-shipments",t?.id],queryFn:async()=>{if(!t?.id)return[];const{data:x,error:f}=await C.from("shipping_quotes").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(f)throw f;return x},enabled:s&&!!t?.id});return t?e.jsx(Le,{open:s,onOpenChange:r,children:e.jsxs(Fe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsxs($e,{children:["User Information - ",t.full_name]})}),e.jsxs(Rn,{defaultValue:"profile",className:"w-full",children:[e.jsxs(jr,{className:"grid w-full grid-cols-3",children:[e.jsx(zt,{value:"profile",children:"Profile"}),e.jsx(zt,{value:"orders",children:"Orders"}),e.jsx(zt,{value:"shipping",children:"Shipping"})]}),e.jsx(Ht,{value:"profile",className:"space-y-4",children:i?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ut,{className:"h-4 w-full"}),e.jsx(ut,{className:"h-4 w-full"}),e.jsx(ut,{className:"h-4 w-3/4"})]}):a?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Full Name"}),e.jsx("p",{children:a.full_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{children:a.email||t.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{children:a.phone_number||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{children:a.user_personal_id||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Country"}),e.jsx("p",{children:a.country||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Postal Code"}),e.jsx("p",{children:a.postal_code||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"City"}),e.jsx("p",{children:a.city||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"State"}),e.jsx("p",{children:a.state||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Join Date"}),e.jsx("p",{children:Qt(new Date(t.created_at),"MMM dd, yyyy")})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Address"}),e.jsx("p",{children:a.address||"N/A"}),a.address_notes&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:a.address_notes})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No profile information found"})}),e.jsx(Ht,{value:"orders",className:"space-y-4",children:h?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ut,{className:"h-20 w-full"}),e.jsx(ut,{className:"h-20 w-full"})]}):u&&u.length>0?e.jsx("div",{className:"space-y-3",children:u.map(x=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Order #",x.order_personal_id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Qt(new Date(x.created_at),"MMM dd, yyyy")})]}),e.jsx(Ie,{children:x.status})]}),e.jsxs("p",{className:"text-sm",children:[x.order_items?.length||0," item(s)"]})]},x.id))}):e.jsx("p",{className:"text-muted-foreground",children:"No orders found"})}),e.jsx(Ht,{value:"shipping",className:"space-y-4",children:p?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ut,{className:"h-20 w-full"}),e.jsx(ut,{className:"h-20 w-full"})]}):g&&g.length>0?e.jsx("div",{className:"space-y-3",children:g.map(x=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Shipment #",x.shipment_personal_id]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Qt(new Date(x.created_at),"MMM dd, yyyy")})]}),e.jsx(Ie,{children:x.status})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Destination:"})," ",x.destination]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Method:"})," ",x.shipping_method]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Weight:"})," ",x.total_weight,"g"]}),x.estimated_cost&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Est. Cost:"})," ¥",x.estimated_cost]}),x.actual_cost&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Actual Cost:"})," ¥",x.actual_cost]})]})]},x.id))}):e.jsx("p",{className:"text-muted-foreground",children:"No shipping quotes found"})})]})]})}):null}const Tn=({users:t,usersLoading:s,refetchUsers:r,handleRoleChange:a})=>{const[i,u]=l.useState(""),[h,g]=l.useState(null),[p,x]=l.useState(!1),f=zs(),w=v=>{g(v),x(!0)},N=t.filter(v=>v.email.toLowerCase().includes(i.toLowerCase())||v.full_name.toLowerCase().includes(i.toLowerCase())),k=v=>{switch(v){case"admin":return"bg-red-100 text-red-800";case"moderator":return"bg-yellow-100 text-yellow-800";case"user":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"User Management"}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx($,{placeholder:"Search users...",className:"pl-10 w-full sm:w-80",value:i,onChange:v=>u(v.target.value)})]}),e.jsx(S,{onClick:()=>r(),disabled:s,className:"flex-shrink-0",children:s?"Loading...":"Refresh"})]})]}),f?e.jsx("div",{className:"space-y-4",children:N.map(v=>e.jsx(V,{children:e.jsxs(Z,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:v.full_name}),v.user_personal_id&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["#",v.user_personal_id]})]}),e.jsx(Ie,{className:k(v.role),children:v.role.toUpperCase()})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-muted-foreground break-all",children:v.email}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:v.country||"N/A"})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Joined: ",new Date(v.created_at).toLocaleDateString()]})]}),e.jsxs(S,{size:"sm",variant:"outline",className:"w-full mt-2",onClick:()=>w(v),children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"See User Info"]})]})},v.id))}):e.jsx(V,{children:e.jsx(Z,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(_a,{children:[e.jsx(Sa,{children:e.jsxs(Ps,{children:[e.jsx(Et,{className:"min-w-[150px]",children:"User"}),e.jsx(Et,{className:"min-w-[200px]",children:"Email"}),e.jsx(Et,{className:"min-w-[100px]",children:"Country"}),e.jsx(Et,{className:"min-w-[100px]",children:"Joined"}),e.jsx(Et,{className:"text-right",children:"Actions"})]})}),e.jsx(Ca,{children:N.map(v=>e.jsxs(Ps,{children:[e.jsxs(Tt,{className:"font-medium",children:[v.full_name,v.user_personal_id&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["#",v.user_personal_id]}),e.jsx(Ie,{className:`${k(v.role)} ml-2`,children:v.role.toUpperCase()})]}),e.jsx(Tt,{className:"break-all",children:v.email}),e.jsx(Tt,{children:v.country||"N/A"}),e.jsx(Tt,{children:new Date(v.created_at).toLocaleDateString()}),e.jsx(Tt,{className:"text-right",children:e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>w(v),children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),"See User Info"]})})]},v.id))})]})})})}),e.jsx(En,{user:h,open:p,onOpenChange:x})]})};function Ws({orderId:t}){const[s,r]=l.useState([]),[a,i]=l.useState(!0),[u,h]=l.useState(!1),[g,p]=l.useState(1),[x,f]=l.useState(new Set),[w,N]=l.useState(""),[k,v]=l.useState("all"),[I,Y]=l.useState(!1),[L,G]=l.useState(10),[O,se]=l.useState(null),[ge,re]=l.useState(""),[oe,ae]=l.useState(""),[A,B]=l.useState(""),[ee,me]=l.useState(new Map),[Be,Qe]=l.useState(!1),[ze,He]=l.useState(""),[Pt,fe]=l.useState(""),[rt,je]=l.useState(!1),[_e,ne]=l.useState(""),{toast:R}=ns();l.useEffect(()=>{D()},[I,L]),l.useEffect(()=>{t&&s.length>0&&(f(c=>new Set(c).add(t)),setTimeout(()=>{document.getElementById(`order-${t}`)?.scrollIntoView({behavior:"smooth",block:"center"})},100))},[t,s.length]),l.useEffect(()=>{p(1)},[k,L,I,w]);const D=async()=>{try{i(!0);let c=C.from("orders").select(`
          *,
          order_items (
            product_request_id
          ),
          quotes (*)
        `);I&&(c=c.eq("is_rejected",!1));const{data:j,error:d}=await c.order("created_at",{ascending:!1});if(d)throw d;const n=new Set;(j||[]).forEach(q=>{q.order_items.forEach(we=>{n.add(we.product_request_id)})});const{data:b,error:y}=await C.from("product_requests").select("*").in("id",Array.from(n));if(y)throw y;const T=new Map;(b||[]).forEach(q=>{T.set(q.id,q)});const K=[...new Set((j||[]).map(q=>q.user_id))],{data:E,error:X}=await C.from("profiles").select("id, full_name, email, user_personal_id").in("id",K);if(X)throw X;const ve=new Map((E||[]).map(q=>[q.id,q])),gt=(j||[]).map(q=>{let we;if(q.is_rejected&&q.rejection_details&&typeof q.rejection_details=="object"){const Oe=q.rejection_details;Oe.product_issues&&Array.isArray(Oe.product_issues)?we=Oe.product_issues.map(ie=>({id:ie.product_id,user_id:q.user_id,product_url:ie.product_url,item_name:ie.item_name,quantity:ie.quantity||1,status:"rejected",has_purchase_issue:ie.has_issue,purchase_issue_description:ie.issue_description,created_at:q.created_at,updated_at:q.updated_at})):we=[]}else we=q.order_items.map(Oe=>T.get(Oe.product_request_id)).filter(Boolean);return{...q,profiles:ve.get(q.user_id)||null,items:we}});r(gt.map(q=>({...q,rejection_details:q.rejection_details}))),r(gt.map(q=>({...q,rejection_details:q.rejection_details})))}catch(c){console.error("Error fetching orders:",c),R({title:"Error",description:"Failed to fetch orders",variant:"destructive"})}finally{i(!1)}},he=async()=>{h(!0);try{await D(),jt.success("Orders updated successfully")}catch{jt.error("Failed to refresh orders")}finally{h(!1)}},pe=c=>{f(j=>{const d=new Set(j);return d.has(c)?d.delete(c):d.add(c),d})},xt=async()=>{if(!(!O||!oe))try{const{error:c}=await C.from("quotes").insert({type:"product",order_id:O.id,price_jpy:null,status:"sent",quote_url:oe});if(c)throw c;const j=O.items.map(n=>n.id),{error:d}=await C.from("product_requests").update({status:"quoted"}).in("id",j);if(d)throw d;await ke(O.user_id,"quote_received",`Your product quote for Order #${O.order_personal_id} is ready. Please review and complete payment.`,O.order_personal_id,null,O.id),R({title:"Quote Created",description:"Order quote has been sent to the customer"}),se(null),ae(""),me(new Map),D()}catch(c){R({title:"Error",description:c.message||"Failed to create quote",variant:"destructive"})}},at=async()=>{if(!O||!A.trim()){R({title:"Error",description:"Please provide a reason for rejection",variant:"destructive"});return}try{const c=O.items.map(y=>({product_id:y.id,product_url:y.product_url,item_name:y.item_name,quantity:y.quantity,has_issue:ee.get(y.id)?.hasIssue||!1,issue_description:ee.get(y.id)?.description||null})),j={rejection_reason:A.trim(),rejected_at:new Date().toISOString(),product_issues:c},{error:d}=await C.from("orders").update({is_rejected:!0,rejection_reason:A.trim(),rejection_details:j}).eq("id",O.id);if(d)throw d;const n=O.items.map(y=>y.id),{error:b}=await C.from("product_requests").update({status:"rejected",rejection_reason:A.trim()}).in("id",n);if(b)throw b;for(const[y,T]of ee.entries())T.hasIssue&&await C.from("product_requests").update({has_purchase_issue:!0,purchase_issue_description:T.description}).eq("id",y);await ke(O.user_id,"order_rejected",`Your Order #${O.order_personal_id} has been rejected. Reason: ${A.substring(0,100)}${A.length>100?"...":""}`,O.order_personal_id,null,O.id),R({title:"Order Rejected",description:"Order has been rejected and customer will be notified"}),se(null),B(""),me(new Map),D()}catch(c){R({title:"Error",description:c.message||"Failed to reject order",variant:"destructive"})}},nt=(c,j,d)=>{me(n=>{const b=new Map(n);return b.set(c,{hasIssue:j,description:d}),b})},it=async c=>{try{const j=c.quotes?.find(y=>y.status==="sent"&&y.type==="product");if(!j){R({title:"Error",description:"No pending quote found for this order",variant:"destructive"});return}const{error:d}=await C.from("quotes").update({status:"paid"}).eq("id",j.id);if(d)throw d;const n=c.items.map(y=>y.id),{error:b}=await C.from("product_requests").update({status:"paid"}).in("id",n);if(b)throw b;await ke(c.user_id,"payment_confirmed",`Your payment for Order #${c.order_personal_id} has been confirmed! We will now purchase your items.`,c.order_personal_id,null,c.id),R({title:"Payment Confirmed",description:"Payment has been confirmed and products status updated"}),D()}catch(j){R({title:"Error",description:j.message||"Failed to confirm payment",variant:"destructive"})}},Ve=async(c,j)=>{try{const d=c.items.filter(y=>y.status==="purchased");if(d.length===0){R({title:"No Items Found",description:"There are no purchased items to mark as received."});return}for(const y of d){const T=j.get(y.id);await C.from("product_requests").update({status:"received",updated_at:new Date().toISOString(),...T!==void 0?{weight:T}:{}}).eq("id",y.id)}const{data:n}=await C.from("order_items").select(`
          product_request_id,
          product_requests!inner(status)
        `).eq("order_id",c.id);n?.every(y=>y.product_requests.status==="received")&&n&&n.length>0&&await ke(c.user_id,"items_at_warehouse",`All your items for Order #${c.order_personal_id} have arrived at our warehouse!`,c.order_personal_id,null,c.id),R({title:"Products Marked",description:`${d.length} product(s) marked as received.`}),D()}catch(d){R({title:"Error",description:d.message||"Failed to mark products as received.",variant:"destructive"})}},ot=async c=>{try{const j=c.items.filter(n=>n.status==="paid");if(j.length===0){R({title:"No Products to Mark",description:"No paid products found to mark as purchased"});return}const d=j.map(n=>{const y=document.getElementById(`invoice-${n.id}`)?.value?.trim()||null;return{id:n.id,invoice_id:y}});for(const{id:n,invoice_id:b}of d)await C.from("product_requests").update({status:"purchased",invoice_id:b,updated_at:new Date().toISOString()}).eq("id",n);R({title:"Products Marked",description:`${d.length} product(s) marked as purchased with invoice IDs`}),D()}catch(j){R({title:"Error",description:j.message||"Failed to mark products as purchased",variant:"destructive"})}},le=async c=>{try{const d=document.getElementById(`invoice-${c}`)?.value?.trim()||null,{error:n}=await C.from("product_requests").update({status:"purchased",invoice_id:d,updated_at:new Date().toISOString()}).eq("id",c);if(n)throw n;R({title:"Product Marked",description:"Product marked as purchased"}),D()}catch(j){R({title:"Error",description:j.message||"Failed to mark product as purchased",variant:"destructive"})}},Xe=async(c,j)=>{try{const{error:d}=await C.from("product_requests").update({invoice_id:j.trim()||null,updated_at:new Date().toISOString()}).eq("id",c);if(d)throw d;R({title:"Invoice ID Updated",description:"Product invoice ID has been updated"}),D()}catch(d){R({title:"Error",description:d.message||"Failed to update invoice ID",variant:"destructive"})}},Ee=async(c,j)=>{try{const d={status:"received",updated_at:new Date().toISOString()};j!==void 0&&(d.weight=j);const{error:n}=await C.from("product_requests").update(d).eq("id",c);if(n)throw n;const{data:b}=await C.from("order_items").select("product_request_id, order_id").eq("product_request_id",c).single();if(b){const{data:y}=await C.from("order_items").select(`
            product_request_id,
            product_requests!inner(status)
          `).eq("order_id",b.order_id);if(y?.every(K=>K.product_requests.status==="received")&&y&&y.length>0){const{data:K}=await C.from("orders").select("user_id, order_personal_id").eq("id",b.order_id).single();K&&await ke(K.user_id,"items_at_warehouse",`All your items for Order #${K.order_personal_id} have arrived at our warehouse!`,K.order_personal_id,null,b.order_id)}}R({title:"Product Marked",description:"Product marked as received"}),D()}catch(d){R({title:"Error",description:d.message||"Failed to mark product as received",variant:"destructive"})}},It=async c=>{try{const j=c.quotes?.find(b=>b.type==="shipping"&&b.status==="sent");if(j){const{error:b}=await C.from("quotes").update({status:"paid"}).eq("id",j.id);if(b)throw b}const d=c.items.map(b=>b.id),{error:n}=await C.from("product_requests").update({status:"shipping_paid"}).in("id",d);if(n)throw n;R({title:"Shipping Payment Confirmed",description:"Shipping payment has been confirmed"}),D()}catch(j){R({title:"Error",description:j.message||"Failed to confirm shipping payment",variant:"destructive"})}},Se=async c=>{if(_e)try{const{error:j}=await C.from("orders").update({status:"shipped",tracking_number:_e,shipped_at:new Date().toISOString()}).eq("id",c.id);if(j)throw j;const d=c.items.map(b=>b.id),{error:n}=await C.from("product_requests").update({status:"shipped"}).in("id",d);if(n)throw n;R({title:"Order Shipped",description:"Order has been marked as shipped"}),je(!1),ne(""),D()}catch(j){R({title:"Error",description:j.message||"Failed to ship order",variant:"destructive"})}},lt=c=>{if(c.is_rejected)return"Rejected";if(c.status==="shipped")return"Shipped";const j=c.items.map(T=>T.status);if(j.every(T=>T===j[0])&&j[0])switch(j[0]){case"shipping_paid":return"Ready to Ship";case"shipping_quoted":return"Awaiting Shipping Payment";case"received":return"Stored";case"purchased":return"Purchased";case"paid":return"Paid";case"quoted":return"Quoted";case"requested":return"New"}const n=j.includes("purchased"),b=j.includes("paid"),y=j.includes("received");return n&&b?"Partially Purchased":y&&(n||b)?"Partial Processing":c.status==="awaiting_shipping_payment"?"Awaiting Shipping Payment":c.status==="weighing"?"Weighing":c.status==="preparing"?"Preparing":"New"},ct=c=>{switch(c){case"New":return"bg-capybara-yellow text-red-500 border-slate-400/20";case"Quoted":return"bg-yellow-500/10 text-yellow-600 border-yellow-500/20";case"Paid":return"bg-emerald-500/10 text-emerald-600 border-emerald-500/20";case"Partially Purchased":return"bg-orange-500/10 text-orange-600 border-orange-500/20";case"Purchased":return"bg-orange-500/10 text-orange-600 border-orange-500/20";case"Partial Processing":return"bg-indigo-500/10 text-indigo-600 border-indigo-500/20";case"Preparing":return"bg-purple-500/10 text-purple-600 border-purple-500/20";case"Stored":return"bg-sky-500/10 text-sky-600 border-sky-500/20";case"Awaiting Shipping":return"bg-amber-500/10 text-amber-600 border-amber-500/20";case"Shipped":return"bg-cyan-500/10 text-cyan-600 border-cyan-500/20";case"Rejected":return"bg-red-500/10 text-red-600 border-red-500/20";default:return"bg-gray-500/10 text-gray-600 border-gray-500/20"}},Dt=c=>{const j=lt(c),d=c.items.every(E=>["purchased","received","shipping_quoted","shipping_paid","shipped"].includes(E.status));c.items.some(E=>["purchased","received","shipping_quoted","shipping_paid","shipped"].includes(E.status)),c.items.some(E=>E.status==="received");const n=c.items.every(E=>E.status==="received"),b=d||j==="Partial Processing"||j==="Weighing"||j==="Awaiting Shipping Payment"||n?"Items Purchased":"Item(s) being purchased",y=[{label:"Request Submitted",status:"upcoming",icon:e.jsx(Es,{className:"h-4 w-4"})},{label:"Payment Confirmed",status:"upcoming",icon:e.jsx(As,{className:"h-4 w-4"})},{label:b,status:"upcoming",icon:e.jsx(va,{className:"h-4 w-4"})},{label:"Item(s) on the way to warehouse",status:"upcoming",icon:e.jsx(et,{className:"h-4 w-4"})},{label:"All Items at Warehouse",status:"upcoming",icon:e.jsx(ka,{className:"h-4 w-4"})}],K={New:0,Quoted:0,Paid:1,Purchased:2,"Partially Purchased":2,"Partial Processing":3,Weighing:4,"Awaiting Shipping Payment":4,"Ready to Ship":4,Shipped:4}[j]??-1;return j==="Rejected"?y.map((E,X)=>({...E,status:X===K?"rejected":"upcoming"})):y.map((E,X)=>{if(X===0)return{...E,status:"completed"};if(X===1){const ve=j.toLowerCase();if(["new","quoted"].includes(ve))return{...E,status:"current"};if(["paid","purchased","weighing","shipped"].includes(ve))return{...E,status:"completed"}}if(X===2){const ve=j.toLowerCase();if(ve==="paid")return{...E,status:"current"};if(["purchased","weighing","shipped"].includes(ve))return{...E,status:"completed"}}return(j==="Stored"||j==="Awaiting Shipping Payment"||j==="Ready to Ship")&&X<=4?{...E,status:"completed"}:j==="Purchased"&&d?X<2?{...E,status:"completed"}:X===2?{...E,status:"completed"}:X===3?{...E,status:"current"}:{...E,status:"upcoming"}:X<K?{...E,status:"completed"}:X===K?{...E,status:"current"}:j==="Partial Processing"&&X===2?{...E,status:"completed"}:{...E,status:"upcoming"}})};if(a)return e.jsx(V,{children:e.jsx(Z,{className:"p-6",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading orders..."})})});let H=s.filter(c=>{const j=w.toLowerCase();return c.profiles?.full_name?.toLowerCase().includes(j)||c.profiles?.email?.toLowerCase().includes(j)||c.profiles?.user_personal_id?.toLowerCase().includes(j)||c.order_personal_id?.toLowerCase().includes(j)||c.id.toLowerCase().includes(j)});k!=="all"&&(H=H.filter(c=>lt(c).toLowerCase()===k.toLowerCase()));const Ge=Math.ceil(H.length/L),Te=(g-1)*L,Ae=Te+L,ce=H.slice(Te,Ae),dt=c=>{try{const j=new URL(c),d=j.hostname.replace(/^www\./,""),n=j.pathname+j.search+j.hash,b=n.length>40?n.slice(0,40)+"...":n;return`${d}${b}`}catch{return c.length>50?c.slice(0,50)+"...":c}};return e.jsx("div",{className:"space-y-4",children:e.jsxs(V,{children:[e.jsxs(Pe,{children:[e.jsx(tt,{children:"Order Management"}),e.jsx(xs,{children:"Manage customer orders and product requests"})]}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx(V,{className:"bg-muted/30",children:e.jsxs(Z,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx($,{placeholder:"Search by customer name, email, customer ID, or order ID...",value:w,onChange:c=>N(c.target.value),className:"pl-10 w-full sm:w-[350px]"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs(Nt,{value:k,onValueChange:v,children:[e.jsx(_t,{className:"w-[180px]",children:e.jsx(St,{})}),e.jsxs(Ct,{children:[e.jsx(U,{value:"all",children:"All Statuses"}),e.jsx(U,{value:"new",children:"New"}),e.jsx(U,{value:"quoted",children:"Quoted"}),e.jsx(U,{value:"paid",children:"Paid"}),e.jsx(U,{value:"purchased",children:"Purchased"}),e.jsx(U,{value:"partially purchased",children:"Partially Purchased"}),e.jsx(U,{value:"partial processing",children:"Partial Processing"}),e.jsx(U,{value:"weighing",children:"Weighing"}),e.jsx(U,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:he,disabled:u,className:"gap-2",children:[e.jsx(Gs,{className:`h-4 w-4 ${u?"animate-spin":""}`}),u?"Refreshing...":"Update"]}),e.jsx(qt,{id:"hide-rejected-products",checked:I,onCheckedChange:c=>Y(c===!0)}),e.jsx("label",{htmlFor:"hide-rejected-products",className:"text-sm font-medium cursor-pointer",children:"Hide rejected"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Show:"}),e.jsxs(Nt,{value:L.toString(),onValueChange:c=>G(Number(c)),children:[e.jsx(_t,{className:"w-[100px]",children:e.jsx(St,{})}),e.jsxs(Ct,{children:[e.jsx(U,{value:"5",children:"5"}),e.jsx(U,{value:"10",children:"10"}),e.jsx(U,{value:"25",children:"25"}),e.jsx(U,{value:"50",children:"50"})]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"per page"})]})]}),H.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",Te+1,"-",Math.min(Ae,H.length)," of ",H.length," orders"]})]})}),H.length===0&&s.length>0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ye,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No orders found with this filter"}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or filter criteria."})]}):H.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No orders found matching your criteria."}):ce.map(c=>{const j=x.has(c.id),d=lt(c);return e.jsx(js,{open:j,onOpenChange:()=>pe(c.id),children:e.jsxs(V,{id:`order-${c.id}`,className:"border",children:[e.jsx(vs,{asChild:!0,children:e.jsx(S,{variant:"ghost",className:"w-full p-0 h-auto hover:bg-transparent",onClick:n=>{(window.getSelection()?.toString().length??0)>0&&n.stopPropagation()},children:e.jsx("div",{className:"w-full p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col text-left flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-base flex items-baseline gap-1 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0 select-text",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:"Order from"}),e.jsx("span",{className:"text-blue-500 font-semibold truncate select-text",title:c.profiles?.full_name||c.profiles?.email||"Unknown",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:c.profiles?.full_name||c.profiles?.email||"Unknown"})]}),c.profiles?.full_name||c.profiles?.email?e.jsx(S,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:n=>{n.stopPropagation(),navigator.clipboard.writeText(c.profiles?.full_name||c.profiles?.email||""),jt.success("Customer name copied to clipboard")},title:"Copy Customer Name",children:e.jsx(Ot,{className:"h-3 w-3"})}):null]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground min-w-0",children:[e.jsxs("span",{className:"flex items-baseline gap-1 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0 select-text",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:"Customer ID:"}),e.jsx("span",{className:"font-medium text-green-500 truncate select-text",title:c.profiles?.user_personal_id?`#${c.profiles.user_personal_id}`:"N/A",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:c.profiles?.user_personal_id?`#${c.profiles.user_personal_id}`:"N/A"})]}),c.profiles?.user_personal_id&&e.jsx(S,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:n=>{n.stopPropagation(),navigator.clipboard.writeText(c.profiles?.user_personal_id||""),jt.success("Customer ID copied to clipboard")},title:"Copy Customer ID",children:e.jsx(Ot,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground min-w-0",children:[e.jsxs("span",{className:"flex items-baseline gap-1 min-w-0",children:[e.jsx("span",{className:"flex-shrink-0 select-text",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:"Customer Order ID:"}),e.jsx("span",{className:"font-medium text-green-500 truncate select-text",title:c.order_personal_id?`#${c.order_personal_id}`:"N/A",onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:c.order_personal_id?`#${c.order_personal_id}`:"N/A"})]}),c.order_personal_id&&e.jsx(S,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:n=>{n.stopPropagation(),navigator.clipboard.writeText(c.order_personal_id||""),jt.success("Customer Order ID copied to clipboard")},title:"Copy Customer Order ID",children:e.jsx(Ot,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground min-w-0",children:[e.jsxs("span",{className:"font-medium truncate select-text",title:`Order #${c.id.slice(0,8).toUpperCase()}`,onMouseDown:n=>n.stopPropagation(),onClick:n=>n.stopPropagation(),children:["Order #",c.id.slice(0,8).toUpperCase()]}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:n=>{n.stopPropagation(),navigator.clipboard.writeText(c.id),jt.success("Order ID copied to clipboard")},title:"Copy Order ID",children:e.jsx(Ot,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex flex-row sm:flex-col items-center sm:items-end justify-between sm:justify-start gap-2 sm:gap-1 text-right flex-shrink-0 min-w-fit",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:`${ct(d)} text-xs`,children:d}),e.jsx(fs,{className:`h-5 w-5 text-muted-foreground transform transition-transform duration-300 ${j?"rotate-180":"rotate-0"}`})]}),e.jsxs("div",{className:"flex flex-col sm:items-end text-xs text-muted-foreground",children:[e.jsxs("p",{className:"flex items-center gap-1",children:[e.jsx(Es,{className:"h-3 w-3"}),new Date(c.created_at).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("p",{children:[c.items.length," product",c.items.length!==1?"s":""]})]})]})]})})})}),e.jsx(ws,{children:e.jsxs("div",{className:"px-4 pb-4 border-t pt-3",children:[e.jsx("div",{className:"mb-4",children:e.jsx(Ks,{steps:Dt(c)})}),c.is_rejected&&c.rejection_details&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Bt,{className:"h-5 w-5 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-red-900 mb-1",children:"Order Rejected"}),e.jsx("p",{className:"text-sm text-red-800",children:c.rejection_details.rejection_reason}),e.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Rejected on ",new Date(c.rejection_details.rejected_at).toLocaleString()]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Products in this order:"}),c.items.map((n,b)=>e.jsx("div",{className:"p-3 bg-secondary/30 rounded-lg",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"font-medium",children:[b+1,") ",n.item_name||"Unnamed Product"]}),n.has_purchase_issue&&e.jsxs(Ie,{className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/20 text-xs",children:[e.jsx(Ya,{className:"h-3 w-3 mr-1"}),"Issue Flagged"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Qty: ",n.quantity]}),e.jsx("div",{className:"space-y-2",children:e.jsxs("a",{href:n.product_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:underline break-all",title:n.product_url,children:[e.jsx(Mt,{className:"h-3 w-3 flex-shrink-0"}),dt(n.product_url)]})})]}),n.notes&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Notes: ",n.notes]}),(()=>{if(c.rejection_details){const y=c.rejection_details.product_issues?.find(T=>T.product_id===n.id);return y?.has_issue&&y?.issue_description?e.jsxs("div",{className:"flex items-center gap-1 mt-2 bg-yellow-50 border border-yellow-200 rounded p-2",children:[e.jsx(Bt,{className:"h-3 w-3 text-yellow-600 flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-yellow-700",children:["Issue: ",y.issue_description]})]}):null}else return n.purchase_issue_description?e.jsxs("div",{className:"flex items-center gap-1 mt-2 bg-yellow-50 border border-yellow-200 rounded p-2",children:[e.jsx(Bt,{className:"h-3 w-3 text-yellow-600 flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-yellow-700",children:["Issue: ",n.purchase_issue_description]})]}):null})(),n.status==="paid"&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>le(n.id),className:"mt-2",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Mark as Purchased"]}),["paid","purchased","received","shipping_quoted","shipping_paid","shipped"].includes(n.status)&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx($,{type:"text",placeholder:"Invoice ID",className:"w-40 h-8",defaultValue:n.invoice_id||"",id:`invoice-${n.id}`}),["purchased","received","shipping_quoted","shipping_paid","shipped"].includes(n.status)&&e.jsx(S,{onClick:()=>{const y=document.getElementById(`invoice-${n.id}`);y&&Xe(n.id,y.value)},size:"sm",variant:"outline",children:"Save Invoice ID"})]}),n.status==="purchased"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx($,{type:"number",placeholder:"Weight (g)",className:"w-28 h-8",id:`weight-${n.id}`,min:"0",step:"1"}),e.jsxs(S,{onClick:()=>{const y=document.getElementById(`weight-${n.id}`),T=y?parseFloat(y.value):void 0;Ee(n.id,T)},size:"sm",variant:"outline",children:[e.jsx(Ts,{className:"h-3 w-3 mr-1"}),"Mark as Received"]})]}),n.status==="received"&&n.weight&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Weight: ",n.weight,"g"]})]})})},n.id))]}),!c.is_rejected&&e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[!c.quotes?.length&&e.jsxs(e.Fragment,{children:[e.jsxs(Le,{children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>se(c),children:[e.jsx(ps,{className:"h-4 w-4 mr-1"}),"Create Quote"]})}),e.jsxs(Fe,{className:"max-w-2xl",children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Create Order Quote"}),e.jsx(Je,{children:"Enter the invoice URL for this order quote."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"quote-url",children:"Invoice URL"}),e.jsx($,{id:"quote-url",type:"url",value:oe,onChange:n=>ae(n.target.value),placeholder:"Enter PayPal invoice URL",className:"mt-2"})]})}),e.jsx(Ze,{children:e.jsx(S,{onClick:xt,children:"Create Quote"})})]})]}),e.jsxs(Le,{children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(S,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>se(c),children:[e.jsx(hs,{className:"h-4 w-4 mr-1"}),"Reject Order"]})}),e.jsxs(Fe,{className:"max-w-2xl",children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Reject Order"}),e.jsx(Je,{children:"Reject the entire order. The customer will be able to edit and resubmit."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"rejection-reason",children:"Rejection Reason *"}),e.jsx(ds,{id:"rejection-reason",value:A,onChange:n=>B(n.target.value),placeholder:"Explain why the order is being rejected...",className:"min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(z,{children:"Flag Specific Products with Issues (optional)"}),e.jsx("div",{className:"space-y-2 mt-2 max-h-60 overflow-y-auto",children:c.items.map(n=>{const b=ee.get(n.id)||{hasIssue:!1,description:""};return e.jsx("div",{className:"p-3 border rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qt,{checked:b.hasIssue,onCheckedChange:y=>nt(n.id,y,b.description)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:n.item_name||"Unnamed Product"}),b.hasIssue&&e.jsx($,{className:"mt-2",placeholder:"Describe the issue with this product...",value:b.description,onChange:y=>nt(n.id,!0,y.target.value)})]})]})},n.id)})})]})]}),e.jsx(Ze,{children:e.jsx(S,{variant:"destructive",onClick:at,children:"Reject Order"})})]})]})]}),c.quotes?.some(n=>n.status==="sent"&&n.type==="product")&&e.jsxs(S,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700",onClick:()=>it(c),children:[e.jsx(As,{className:"h-4 w-4 mr-1"}),"Confirm Payment"]}),c.items.some(n=>n.status==="paid")&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>ot(c),children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"Mark All Paid as Purchased"]}),c.items.some(n=>n.status==="purchased")&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>{const n=new Map;c.items.forEach(b=>{if(b.status==="purchased"){const y=document.getElementById(`weight-${b.id}`);if(y?.value){const T=parseFloat(y.value);isNaN(T)||n.set(b.id,T)}}}),Ve(c,n)},children:[e.jsx(Ts,{className:"h-4 w-4 mr-1"}),"Mark All Purchased as Received"]}),c.quotes?.some(n=>n.status==="sent"&&n.type==="shipping")&&e.jsxs(S,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700",onClick:()=>It(c),children:[e.jsx(Js,{className:"h-4 w-4 mr-1"}),"Confirm Shipping Payment"]}),c.items.every(n=>n.status==="shipping_paid")&&e.jsxs(Le,{open:rt,onOpenChange:je,children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(S,{size:"sm",variant:"outline",className:"text-blue-600 hover:text-blue-700",children:[e.jsx(et,{className:"h-4 w-4 mr-1"}),"Mark as Shipped"]})}),e.jsxs(Fe,{children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Ship Order"}),e.jsx(Je,{children:"Enter the tracking number for this shipment."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"tracking",children:"Tracking Number"}),e.jsx($,{id:"tracking",value:_e,onChange:n=>ne(n.target.value),placeholder:"Enter tracking number"})]})}),e.jsx(Ze,{children:e.jsx(S,{onClick:()=>Se(c),children:"Confirm Shipment"})})]})]})]}),c.quotes&&c.quotes.length>0&&e.jsxs("div",{className:"mt-4 p-4 border border-blue-200 bg-blue-50/50 rounded-xl",children:[e.jsx("p",{className:"text-sm font-semibold text-blue-900 mb-2",children:"Quote Information"}),e.jsx("div",{className:"space-y-2",children:c.quotes.map(n=>{const b=n.status.charAt(0).toUpperCase()+n.status.slice(1);let y=n.quote_url;try{const T=new URL(n.quote_url),K=T.hostname.replace(/^www\./,""),E=T.pathname+T.search+T.hash;y=`${K}${E.length>20?E.slice(0,20)+"...":E}`}catch{y=n.quote_url.length>25?n.quote_url.slice(0,25)+"...":n.quote_url}return e.jsx("div",{className:"flex items-center justify-between bg-white/60 rounded-lg p-3 border border-blue-100 ",children:e.jsxs("div",{className:" sm:flex-row sm:items-center sm:gap-3 text-sm",children:[e.jsxs("p",{className:"text-blue-900 font-medium",children:["Status: ",b]}),e.jsxs("a",{href:n.quote_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline",title:n.quote_url,children:[e.jsx(Mt,{className:"h-3.5 w-3.5"}),y]})]})},n.id)})})]})]})})]})},c.id)}),Ge>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>p(c=>Math.max(1,c-1)),disabled:g===1,children:"Previous"}),e.jsxs("span",{className:"flex items-center px-3 text-sm",children:["Page ",g," of ",Ge]}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>p(c=>Math.min(Ge,c+1)),disabled:g===Ge,children:"Next"})]})]})]})})}var An=Symbol("radix.slottable");function On(t){const s=({children:r})=>e.jsx(e.Fragment,{children:r});return s.displayName=`${t}.Slottable`,s.__radixId=An,s}var vr="AlertDialog",[qn]=gs(vr,[Hs]),Ye=Hs(),wr=t=>{const{__scopeAlertDialog:s,...r}=t,a=Ye(s);return e.jsx(fa,{...a,...r,modal:!0})};wr.displayName=vr;var Mn="AlertDialogTrigger",Ln=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,i=Ye(r);return e.jsx(ja,{...i,...a,ref:s})});Ln.displayName=Mn;var Fn="AlertDialogPortal",br=t=>{const{__scopeAlertDialog:s,...r}=t,a=Ye(s);return e.jsx(ma,{...a,...r})};br.displayName=Fn;var Un="AlertDialogOverlay",yr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,i=Ye(r);return e.jsx(ua,{...i,...a,ref:s})});yr.displayName=Un;var bt="AlertDialogContent",[$n,Wn]=qn(bt),Yn=On("AlertDialogContent"),Nr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,children:a,...i}=t,u=Ye(r),h=l.useRef(null),g=st(s,h),p=l.useRef(null);return e.jsx(ha,{contentName:bt,titleName:_r,docsSlug:"alert-dialog",children:e.jsx($n,{scope:r,cancelRef:p,children:e.jsxs(pa,{role:"alertdialog",...u,...i,ref:g,onOpenAutoFocus:Ne(i.onOpenAutoFocus,x=>{x.preventDefault(),p.current?.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[e.jsx(Yn,{children:a}),e.jsx(Qn,{contentRef:h})]})})})});Nr.displayName=bt;var _r="AlertDialogTitle",Sr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,i=Ye(r);return e.jsx(xa,{...i,...a,ref:s})});Sr.displayName=_r;var Cr="AlertDialogDescription",kr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,i=Ye(r);return e.jsx(ga,{...i,...a,ref:s})});kr.displayName=Cr;var Bn="AlertDialogAction",Pr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,i=Ye(r);return e.jsx(Vs,{...i,...a,ref:s})});Pr.displayName=Bn;var Ir="AlertDialogCancel",Dr=l.forwardRef((t,s)=>{const{__scopeAlertDialog:r,...a}=t,{cancelRef:i}=Wn(Ir,r),u=Ye(r),h=st(s,i);return e.jsx(Vs,{...u,...a,ref:h})});Dr.displayName=Ir;var Qn=({contentRef:t})=>{const s=`\`${bt}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${bt}\` by passing a \`${Cr}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${bt}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return l.useEffect(()=>{document.getElementById(t.current?.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},zn=wr,Hn=br,Rr=yr,Er=Nr,Tr=Pr,Ar=Dr,Or=Sr,qr=kr;const us=zn,Vn=Hn,Mr=l.forwardRef(({className:t,...s},r)=>e.jsx(Rr,{className:ue("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:r}));Mr.displayName=Rr.displayName;const Xt=l.forwardRef(({className:t,...s},r)=>e.jsxs(Vn,{children:[e.jsx(Mr,{}),e.jsx(Er,{ref:r,className:ue("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));Xt.displayName=Er.displayName;const Gt=({className:t,...s})=>e.jsx("div",{className:ue("flex flex-col space-y-2 text-center sm:text-left",t),...s});Gt.displayName="AlertDialogHeader";const Kt=({className:t,...s})=>e.jsx("div",{className:ue("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Kt.displayName="AlertDialogFooter";const Jt=l.forwardRef(({className:t,...s},r)=>e.jsx(Or,{ref:r,className:ue("text-lg font-semibold",t),...s}));Jt.displayName=Or.displayName;const Zt=l.forwardRef(({className:t,...s},r)=>e.jsx(qr,{ref:r,className:ue("text-sm text-muted-foreground",t),...s}));Zt.displayName=qr.displayName;const es=l.forwardRef(({className:t,...s},r)=>e.jsx(Tr,{ref:r,className:ue(Qs(),t),...s}));es.displayName=Tr.displayName;const ts=l.forwardRef(({className:t,...s},r)=>e.jsx(Ar,{ref:r,className:ue(Qs({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));ts.displayName=Ar.displayName;const Xn=t=>{try{const s=new URL(t),r=s.hostname.replace(/^www\./,""),a=s.pathname+s.search+s.hash,i=a.length>40?a.slice(0,40)+"...":a;return r+i}catch{return t.length>60?t.slice(0,60)+"...":t}},Lr=wt.memo(()=>{const{toast:t}=ns(),s=ms(),[r,a]=l.useState({}),[i,u]=l.useState({}),[h,g]=l.useState({}),[p,x]=l.useState(""),[f,w]=l.useState(!1),[N,k]=l.useState(null),[v,I]=l.useState(null),[Y,L]=l.useState(!1),[G,O]=l.useState(null),[se,ge]=l.useState(""),[re,oe]=l.useState(""),[ae,A]=l.useState(""),[B,ee]=l.useState("1"),[me,Be]=l.useState(""),[Qe,ze]=l.useState(""),[He,Pt]=l.useState(""),[fe,rt]=l.useState(!1),[je,_e]=l.useState(""),[ne,R]=l.useState({}),[D,he]=l.useState(1),[pe,xt]=l.useState(10),{data:at}=pt({queryKey:["all-users"],queryFn:async()=>{const{data:d,error:n}=await C.from("profiles").select("id, full_name, email, user_personal_id").order("full_name",{ascending:!0});if(n)throw n;return d}}),{data:nt,isLoading:it}=pt({queryKey:["admin-storage"],queryFn:async()=>{const{data:d,error:n}=await C.from("product_requests").select("*").eq("status","received").order("created_at",{ascending:!1});if(n)throw n;if(!d||d.length===0)return[];const{data:b,error:y}=await C.from("shipping_quotes").select("items").eq("status","sent");if(y)throw y;const T=new Set;b?.forEach(P=>{P.items?.forEach(Ce=>{Ce.order_item_id&&T.add(Ce.order_item_id)})});const K=d.map(P=>P.id),{data:E,error:X}=await C.from("order_items").select("id, product_request_id").in("product_request_id",K);if(X)throw X;const ve=new Map(E?.map(P=>[P.product_request_id,P.id])||[]),gt=[...new Set(d.map(P=>P.user_id))],{data:q,error:we}=await C.from("profiles").select("id, full_name, email, phone_number, user_personal_id").in("id",gt);if(we)throw we;const Oe=new Map(q?.map(P=>[P.id,P])||[]),ie={};return d.forEach(P=>{const de=P.user_id,Ce=Oe.get(de),Rt=ve.get(P.id),$t=Rt&&T.has(Rt)||T.has(P.id);ie[de]||(ie[de]={user_id:de,user:{full_name:Ce?.full_name||"Unknown User",email:Ce?.email||"No email",phone_number:Ce?.phone_number||"No phone"},items:[],totalWeight:0,totalItems:0}),ie[de].items.push({id:P.id,item_name:P.item_name,product_url:P.product_url,quantity:P.quantity,weight:P.weight,invoice_id:P.invoice_id,created_at:P.created_at,status:P.status,isShipped:$t,is_box:P.is_box,local_tracking_number:P.local_tracking_number}),ie[de].totalWeight+=P.weight||0,ie[de].totalItems+=P.quantity||1}),Object.values(ie)},refetchInterval:3e4}),Ve=Me({mutationFn:async({itemId:d,weight:n})=>{const{error:b}=await C.from("product_requests").update({weight:n}).eq("id",d);if(b)throw b},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-storage"]}),t({title:"Weight updated",description:"Item weight has been updated successfully."})},onError:d=>{t({title:"Error",description:"Failed to update weight. Please try again.",variant:"destructive"}),console.error("Update weight error:",d)}}),ot=Me({mutationFn:async({itemId:d,invoiceId:n})=>{const{error:b}=await C.from("product_requests").update({invoice_id:n}).eq("id",d);if(b)throw b},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-storage"]}),t({title:"Invoice ID updated",description:"Item invoice ID has been updated successfully."})},onError:d=>{t({title:"Error",description:"Failed to update invoice ID. Please try again.",variant:"destructive"}),console.error("Update invoice ID error:",d)}}),le=Me({mutationFn:async d=>{const{error:n}=await C.from("product_requests").insert({...d,status:"received"});if(n)throw n;return d},onSuccess:d=>{s.invalidateQueries({queryKey:["admin-storage"]}),d.is_box||(w(!1),Se(),t({title:"Item added",description:"Item has been added to storage successfully."}))},onError:d=>{t({title:"Error",description:"Failed to add item. Please try again.",variant:"destructive"}),console.error("Add item error:",d)}}),Xe=Me({mutationFn:async d=>{const{error:n}=await C.from("product_requests").delete().eq("id",d);if(n)throw n},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-storage"]}),k(null),t({title:"Item deleted",description:"Item has been removed from storage successfully."})},onError:d=>{t({title:"Error",description:"Failed to delete item. Please try again.",variant:"destructive"}),console.error("Delete item error:",d)}}),Ee=d=>{const n=parseFloat(i[d]);!isNaN(n)&&n>0&&Ve.mutate({itemId:d,weight:n})},It=d=>{const n=h[d]?.trim();n&&ot.mutate({itemId:d,invoiceId:n})},Se=()=>{ge(""),oe(""),A(""),ee("1"),Be(""),ze(""),Pt(""),rt(!1),_e(""),I(null),R({})},lt=d=>{I(d),ge(d),w(!0)},ct=()=>{const d={userId:!se,itemName:!re.trim(),productUrl:!ae.trim(),isBox:!1};if(R(d),Object.values(d).some(b=>b)){t({title:"Missing required fields",description:"Please fill in all required fields (marked with *).",variant:"destructive"});return}const n={user_id:se,item_name:re.trim(),product_url:ae.trim(),quantity:parseInt(B)||1,is_box:fe};me&&(n.weight=parseFloat(me)),Qe?.trim()&&(n.invoice_id=Qe.trim()),He?.trim()&&(n.notes=He.trim()),fe&&je.trim()&&(n.local_tracking_number=je.trim()),fe?(O(n),L(!0)):le.mutate(n)},Dt=async()=>{if(G)try{await le.mutateAsync(G),await ke(G.user_id,"box_item_added",`A box shipment (${G.item_name}) has arrived at our warehouse and has been added to your storage.`,null,null,null),L(!1),O(null),w(!1),Se(),t({title:"Box item added",description:"Box item added successfully and user has been notified by email."})}catch(d){console.error("Error adding box item:",d),L(!1)}},H=d=>{Xe.mutate(d)},Ge=d=>{a(n=>({...n,[d]:!n[d]}))},Te=nt?.filter(d=>{const n=p.toLowerCase();return d.user.full_name?.toLowerCase().includes(n)||d.user.email?.toLowerCase().includes(n)||d.items.some(b=>b.item_name?.toLowerCase().includes(n))}),Ae=Te?.length||0,ce=Math.ceil(Ae/pe),dt=(D-1)*pe,c=dt+pe,j=Te?.slice(dt,c);return l.useEffect(()=>{he(1)},[p,pe]),l.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[D]),it?e.jsx(V,{children:e.jsx(Z,{className:"p-8",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading storage data..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(tt,{children:"Storage Management"}),e.jsx(xs,{children:"View and manage all products currently in storage, grouped by customer"})]}),e.jsxs(Le,{open:f,onOpenChange:d=>{w(d),d||Se()},children:[e.jsx(Yt,{asChild:!0,children:e.jsxs(S,{className:"w-full sm:w-auto",children:[e.jsx(Os,{className:"h-4 w-4 mr-2"}),"Add Item"]})}),e.jsxs(Fe,{className:"max-w-2xl max-h-[90vh] overflow-y-auto px-4 sm:px-6",children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Add Item to Storage"}),e.jsx(Je,{children:"Add a new item directly to a customer's storage"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"user",children:"Customer *"}),e.jsxs(Nt,{value:se,onValueChange:d=>{ge(d),R(n=>({...n,userId:!1}))},children:[e.jsx(_t,{className:ne.userId?"border-destructive":"",children:e.jsx(St,{placeholder:"Select a customer"})}),e.jsx(Ct,{children:at?.map(d=>e.jsxs(U,{value:d.id,children:[d.full_name," (",d.user_personal_id||d.email,")"]},d.id))})]}),ne.userId&&e.jsx("p",{className:"text-xs text-destructive",children:"Customer is required"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"item-name",children:"Item Name *"}),e.jsx($,{id:"item-name",value:re,onChange:d=>{oe(d.target.value),R(n=>({...n,itemName:!1}))},placeholder:"Enter item name",className:ne.itemName?"border-destructive":""}),ne.itemName&&e.jsx("p",{className:"text-xs text-destructive",children:"Item name is required"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"product-url",children:"Product URL *"}),e.jsx($,{id:"product-url",value:ae,onChange:d=>{A(d.target.value),R(n=>({...n,productUrl:!1}))},placeholder:"https://...",className:ne.productUrl?"border-destructive":""}),ne.productUrl&&e.jsx("p",{className:"text-xs text-destructive",children:"Product URL is required"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"quantity",children:"Quantity"}),e.jsx($,{id:"quantity",type:"number",min:"1",value:B,onChange:d=>ee(d.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"weight",children:"Weight (g)"}),e.jsx($,{id:"weight",type:"number",min:"0",value:me,onChange:d=>Be(d.target.value),placeholder:"Optional"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"invoice-id",children:"Invoice ID"}),e.jsx($,{id:"invoice-id",value:Qe,onChange:d=>ze(d.target.value),placeholder:"Optional"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"is-box",className:"flex items-center gap-2",children:"Is this a box shipment? *"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qt,{id:"is-box",checked:fe,onCheckedChange:d=>{rt(d===!0),R(n=>({...n,isBox:!1})),d||_e("")},className:ne.isBox?"border-destructive":""}),e.jsx("label",{htmlFor:"is-box",className:"text-sm",children:"Check if this item is a box shipment"})]}),ne.isBox&&e.jsx("p",{className:"text-xs text-destructive",children:"Please specify if this is a box shipment"})]}),fe&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"local-tracking",children:"Local Tracking Number"}),e.jsx($,{id:"local-tracking",value:je,onChange:d=>_e(d.target.value),placeholder:"Optional - Enter local tracking number"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Only applicable for box shipments"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(z,{htmlFor:"notes",children:"Notes"}),e.jsx($,{id:"notes",value:He,onChange:d=>Pt(d.target.value),placeholder:"Optional"})]})]}),e.jsxs(Ze,{children:[e.jsx(S,{variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(S,{onClick:ct,disabled:le.isPending,children:le.isPending?"Adding...":"Add Item"})]})]})]})]})}),e.jsxs(Z,{children:[ce>1&&e.jsxs("div",{className:"mb-6 pb-6 border-b flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Items per page:"}),e.jsxs(Nt,{value:pe.toString(),onValueChange:d=>xt(parseInt(d)),children:[e.jsx(_t,{className:"w-[70px]",children:e.jsx(St,{})}),e.jsxs(Ct,{children:[e.jsx(U,{value:"5",children:"5"}),e.jsx(U,{value:"10",children:"10"}),e.jsx(U,{value:"20",children:"20"}),e.jsx(U,{value:"50",children:"50"})]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",dt+1,"-",Math.min(c,Ae)," of ",Ae]})]}),e.jsx(Pa,{children:e.jsxs(Ia,{children:[e.jsx(qe,{children:e.jsx(Da,{onClick:()=>he(d=>Math.max(1,d-1)),className:D===1?"pointer-events-none opacity-50":"cursor-pointer"})}),D>2&&e.jsx(qe,{children:e.jsx(At,{onClick:()=>he(1),isActive:D===1,className:"cursor-pointer",children:"1"})}),D>3&&e.jsx(qe,{children:e.jsx(Is,{})}),D>1&&e.jsx(qe,{children:e.jsx(At,{onClick:()=>he(D-1),className:"cursor-pointer",children:D-1})}),e.jsx(qe,{children:e.jsx(At,{isActive:!0,className:"cursor-default",children:D})}),D<ce&&e.jsx(qe,{children:e.jsx(At,{onClick:()=>he(D+1),className:"cursor-pointer",children:D+1})}),D<ce-2&&e.jsx(qe,{children:e.jsx(Is,{})}),D<ce-1&&e.jsx(qe,{children:e.jsx(At,{onClick:()=>he(ce),isActive:D===ce,className:"cursor-pointer",children:ce})}),e.jsx(qe,{children:e.jsx(Ra,{onClick:()=>he(d=>Math.min(ce,d+1)),className:D===ce?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx($,{placeholder:"Search by customer name, email, or product...",value:p,onChange:d=>x(d.target.value),className:"w-full sm:max-w-sm"})}),e.jsx("div",{className:"space-y-4",children:Te?.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No items currently in storage"}):j?.map(d=>e.jsxs(js,{open:r[d.user_id],onOpenChange:()=>Ge(d.user_id),children:[e.jsx(vs,{asChild:!0,children:e.jsx(V,{className:"cursor-pointer hover:bg-accent/50 transition-colors",children:e.jsx(Pe,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(Ea,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"font-medium truncate",children:[d.user.full_name,d.user.user_personal_id&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["#",d.user.user_personal_id]})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:d.user.email})]})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end gap-4",children:[e.jsxs("div",{className:"text-left sm:text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:[d.totalItems," items"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.totalWeight,"g total"]})]}),r[d.user_id]?e.jsx($a,{className:"h-5 w-5 flex-shrink-0"}):e.jsx(fs,{className:"h-5 w-5 flex-shrink-0"})]})]})})})}),e.jsx(ws,{children:e.jsx(V,{className:"mt-2 bg-accent/5",children:e.jsxs(Z,{className:"pt-4",children:[e.jsx("div",{className:"space-y-3",children:d.items.map(n=>e.jsxs("div",{className:"p-3 rounded-lg space-y-2 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium break-words",children:n.item_name||"Unnamed Item"}),e.jsxs(Ie,{variant:"outline",children:["Qty: ",n.quantity]}),n.isShipped&&e.jsxs(Ie,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:[e.jsx(Ta,{className:"h-3 w-3 mr-1"}),"Shipped"]})]}),n.is_box&&n.local_tracking_number?e.jsxs("div",{className:"flex items-center gap-1 text-sm mt-1",children:[e.jsx(ye,{className:"h-3 w-3 flex-shrink-0 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Tracking #:"}),e.jsx("span",{className:"text-muted-foreground",children:n.local_tracking_number})]}):e.jsxs("a",{href:n.product_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-sm text-blue-600 hover:underline break-all mt-1",title:n.product_url,children:[e.jsx(Mt,{className:"h-3 w-3 flex-shrink-0"}),Xn(n.product_url)]})]}),e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>k(n.id),className:"text-destructive hover:text-destructive",children:e.jsx(Ba,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(tn,{className:"h-4 w-4 flex-shrink-0 text-muted-foreground"}),e.jsx($,{type:"number",placeholder:"Weight (g)",className:"flex-1 sm:w-24 min-w-0",value:i[n.id]!==void 0?i[n.id]:n.weight||"",onChange:b=>u(y=>({...y,[n.id]:b.target.value}))}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>Ee(n.id),disabled:!i[n.id]||Ve.isPending,children:"Update"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Invoice:"}),e.jsx($,{type:"text",placeholder:"Invoice ID",className:"flex-1 sm:w-32 min-w-0",value:h[n.id]!==void 0?h[n.id]:n.invoice_id||"",onChange:b=>g(y=>({...y,[n.id]:b.target.value}))}),e.jsx(S,{size:"sm",variant:"outline",onClick:()=>It(n.id),disabled:h[n.id]===void 0||ot.isPending,children:"Update"})]})]})]},n.id))}),e.jsx("div",{className:"mt-4 pt-4 border-t",children:e.jsxs(S,{variant:"outline",className:"w-full sm:w-auto",onClick:n=>{n.stopPropagation(),lt(d.user_id)},children:[e.jsx(Os,{className:"h-4 w-4 mr-2"}),"Add Item for ",d.user.full_name]})})]})})})]},d.user_id))})]})]}),e.jsx(us,{open:N!==null,onOpenChange:d=>!d&&k(null),children:e.jsxs(Xt,{children:[e.jsxs(Gt,{children:[e.jsx(Jt,{children:"Delete Item"}),e.jsx(Zt,{children:"Are you sure you want to delete this item from storage? This action cannot be undone."})]}),e.jsxs(Kt,{children:[e.jsx(ts,{children:"Cancel"}),e.jsx(es,{onClick:()=>N&&H(N),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(us,{open:Y,onOpenChange:L,children:e.jsxs(Xt,{children:[e.jsxs(Gt,{children:[e.jsx(Jt,{children:"Add Box Item to Storage"}),e.jsxs(Zt,{children:["Are you sure you want to add this box item to storage?",e.jsx("br",{}),e.jsx("br",{}),e.jsx("strong",{children:"This will notify the user by email"})," that their package has arrived at the warehouse."]})]}),e.jsxs(Kt,{children:[e.jsx(ts,{onClick:()=>{L(!1),O(null)},children:"Cancel"}),e.jsx(es,{onClick:Dt,disabled:le.isPending,children:le.isPending?"Adding...":"Confirm and Notify User"})]})]})})]})});Lr.displayName="StorageManagement";function Gn(t,s){return l.useReducer((r,a)=>s[r][a]??r,t)}var ys="ScrollArea",[Fr]=gs(ys),[Kn,xe]=Fr(ys),Ur=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,type:a="hover",dir:i,scrollHideDelay:u=600,...h}=t,[g,p]=l.useState(null),[x,f]=l.useState(null),[w,N]=l.useState(null),[k,v]=l.useState(null),[I,Y]=l.useState(null),[L,G]=l.useState(0),[O,se]=l.useState(0),[ge,re]=l.useState(!1),[oe,ae]=l.useState(!1),A=st(s,ee=>p(ee)),B=er(i);return e.jsx(Kn,{scope:r,type:a,dir:B,scrollHideDelay:u,scrollArea:g,viewport:x,onViewportChange:f,content:w,onContentChange:N,scrollbarX:k,onScrollbarXChange:v,scrollbarXEnabled:ge,onScrollbarXEnabledChange:re,scrollbarY:I,onScrollbarYChange:Y,scrollbarYEnabled:oe,onScrollbarYEnabledChange:ae,onCornerWidthChange:G,onCornerHeightChange:se,children:e.jsx(We.div,{dir:B,...h,ref:A,style:{position:"relative","--radix-scroll-area-corner-width":L+"px","--radix-scroll-area-corner-height":O+"px",...t.style}})})});Ur.displayName=ys;var $r="ScrollAreaViewport",Wr=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,children:a,nonce:i,...u}=t,h=xe($r,r),g=l.useRef(null),p=st(s,g,h.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),e.jsx(We.div,{"data-radix-scroll-area-viewport":"",...u,ref:p,style:{overflowX:h.scrollbarXEnabled?"scroll":"hidden",overflowY:h.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:h.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});Wr.displayName=$r;var Re="ScrollAreaScrollbar",Ns=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=xe(Re,t.__scopeScrollArea),{onScrollbarXEnabledChange:u,onScrollbarYEnabledChange:h}=i,g=t.orientation==="horizontal";return l.useEffect(()=>(g?u(!0):h(!0),()=>{g?u(!1):h(!1)}),[g,u,h]),i.type==="hover"?e.jsx(Jn,{...a,ref:s,forceMount:r}):i.type==="scroll"?e.jsx(Zn,{...a,ref:s,forceMount:r}):i.type==="auto"?e.jsx(Yr,{...a,ref:s,forceMount:r}):i.type==="always"?e.jsx(_s,{...a,ref:s}):null});Ns.displayName=Re;var Jn=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=xe(Re,t.__scopeScrollArea),[u,h]=l.useState(!1);return l.useEffect(()=>{const g=i.scrollArea;let p=0;if(g){const x=()=>{window.clearTimeout(p),h(!0)},f=()=>{p=window.setTimeout(()=>h(!1),i.scrollHideDelay)};return g.addEventListener("pointerenter",x),g.addEventListener("pointerleave",f),()=>{window.clearTimeout(p),g.removeEventListener("pointerenter",x),g.removeEventListener("pointerleave",f)}}},[i.scrollArea,i.scrollHideDelay]),e.jsx(Ut,{present:r||u,children:e.jsx(Yr,{"data-state":u?"visible":"hidden",...a,ref:s})})}),Zn=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=xe(Re,t.__scopeScrollArea),u=t.orientation==="horizontal",h=ls(()=>p("SCROLL_END"),100),[g,p]=Gn("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(g==="idle"){const x=window.setTimeout(()=>p("HIDE"),i.scrollHideDelay);return()=>window.clearTimeout(x)}},[g,i.scrollHideDelay,p]),l.useEffect(()=>{const x=i.viewport,f=u?"scrollLeft":"scrollTop";if(x){let w=x[f];const N=()=>{const k=x[f];w!==k&&(p("SCROLL"),h()),w=k};return x.addEventListener("scroll",N),()=>x.removeEventListener("scroll",N)}},[i.viewport,u,p,h]),e.jsx(Ut,{present:r||g!=="hidden",children:e.jsx(_s,{"data-state":g==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:Ne(t.onPointerEnter,()=>p("POINTER_ENTER")),onPointerLeave:Ne(t.onPointerLeave,()=>p("POINTER_LEAVE"))})})}),Yr=l.forwardRef((t,s)=>{const r=xe(Re,t.__scopeScrollArea),{forceMount:a,...i}=t,[u,h]=l.useState(!1),g=t.orientation==="horizontal",p=ls(()=>{if(r.viewport){const x=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;h(g?x:f)}},10);return kt(r.viewport,p),kt(r.content,p),e.jsx(Ut,{present:a||u,children:e.jsx(_s,{"data-state":u?"visible":"hidden",...i,ref:s})})}),_s=l.forwardRef((t,s)=>{const{orientation:r="vertical",...a}=t,i=xe(Re,t.__scopeScrollArea),u=l.useRef(null),h=l.useRef(0),[g,p]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=Vr(g.viewport,g.content),f={...a,sizes:g,onSizesChange:p,hasThumb:x>0&&x<1,onThumbChange:N=>u.current=N,onThumbPointerUp:()=>h.current=0,onThumbPointerDown:N=>h.current=N};function w(N,k){return ni(N,h.current,g,k)}return r==="horizontal"?e.jsx(ei,{...f,ref:s,onThumbPositionChange:()=>{if(i.viewport&&u.current){const N=i.viewport.scrollLeft,k=Ys(N,g,i.dir);u.current.style.transform=`translate3d(${k}px, 0, 0)`}},onWheelScroll:N=>{i.viewport&&(i.viewport.scrollLeft=N)},onDragScroll:N=>{i.viewport&&(i.viewport.scrollLeft=w(N,i.dir))}}):r==="vertical"?e.jsx(ti,{...f,ref:s,onThumbPositionChange:()=>{if(i.viewport&&u.current){const N=i.viewport.scrollTop,k=Ys(N,g);u.current.style.transform=`translate3d(0, ${k}px, 0)`}},onWheelScroll:N=>{i.viewport&&(i.viewport.scrollTop=N)},onDragScroll:N=>{i.viewport&&(i.viewport.scrollTop=w(N))}}):null}),ei=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...i}=t,u=xe(Re,t.__scopeScrollArea),[h,g]=l.useState(),p=l.useRef(null),x=st(s,p,u.onScrollbarXChange);return l.useEffect(()=>{p.current&&g(getComputedStyle(p.current))},[p]),e.jsx(Qr,{"data-orientation":"horizontal",...i,ref:x,sizes:r,style:{bottom:0,left:u.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:u.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":os(r)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.x),onDragScroll:f=>t.onDragScroll(f.x),onWheelScroll:(f,w)=>{if(u.viewport){const N=u.viewport.scrollLeft+f.deltaX;t.onWheelScroll(N),Gr(N,w)&&f.preventDefault()}},onResize:()=>{p.current&&u.viewport&&h&&a({content:u.viewport.scrollWidth,viewport:u.viewport.offsetWidth,scrollbar:{size:p.current.clientWidth,paddingStart:rs(h.paddingLeft),paddingEnd:rs(h.paddingRight)}})}})}),ti=l.forwardRef((t,s)=>{const{sizes:r,onSizesChange:a,...i}=t,u=xe(Re,t.__scopeScrollArea),[h,g]=l.useState(),p=l.useRef(null),x=st(s,p,u.onScrollbarYChange);return l.useEffect(()=>{p.current&&g(getComputedStyle(p.current))},[p]),e.jsx(Qr,{"data-orientation":"vertical",...i,ref:x,sizes:r,style:{top:0,right:u.dir==="ltr"?0:void 0,left:u.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":os(r)+"px",...t.style},onThumbPointerDown:f=>t.onThumbPointerDown(f.y),onDragScroll:f=>t.onDragScroll(f.y),onWheelScroll:(f,w)=>{if(u.viewport){const N=u.viewport.scrollTop+f.deltaY;t.onWheelScroll(N),Gr(N,w)&&f.preventDefault()}},onResize:()=>{p.current&&u.viewport&&h&&a({content:u.viewport.scrollHeight,viewport:u.viewport.offsetHeight,scrollbar:{size:p.current.clientHeight,paddingStart:rs(h.paddingTop),paddingEnd:rs(h.paddingBottom)}})}})}),[si,Br]=Fr(Re),Qr=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,sizes:a,hasThumb:i,onThumbChange:u,onThumbPointerUp:h,onThumbPointerDown:g,onThumbPositionChange:p,onDragScroll:x,onWheelScroll:f,onResize:w,...N}=t,k=xe(Re,r),[v,I]=l.useState(null),Y=st(s,A=>I(A)),L=l.useRef(null),G=l.useRef(""),O=k.viewport,se=a.content-a.viewport,ge=ht(f),re=ht(p),oe=ls(w,10);function ae(A){if(L.current){const B=A.clientX-L.current.left,ee=A.clientY-L.current.top;x({x:B,y:ee})}}return l.useEffect(()=>{const A=B=>{const ee=B.target;v?.contains(ee)&&ge(B,se)};return document.addEventListener("wheel",A,{passive:!1}),()=>document.removeEventListener("wheel",A,{passive:!1})},[O,v,se,ge]),l.useEffect(re,[a,re]),kt(v,oe),kt(k.content,oe),e.jsx(si,{scope:r,scrollbar:v,hasThumb:i,onThumbChange:ht(u),onThumbPointerUp:ht(h),onThumbPositionChange:re,onThumbPointerDown:ht(g),children:e.jsx(We.div,{...N,ref:Y,style:{position:"absolute",...N.style},onPointerDown:Ne(t.onPointerDown,A=>{A.button===0&&(A.target.setPointerCapture(A.pointerId),L.current=v.getBoundingClientRect(),G.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",k.viewport&&(k.viewport.style.scrollBehavior="auto"),ae(A))}),onPointerMove:Ne(t.onPointerMove,ae),onPointerUp:Ne(t.onPointerUp,A=>{const B=A.target;B.hasPointerCapture(A.pointerId)&&B.releasePointerCapture(A.pointerId),document.body.style.webkitUserSelect=G.current,k.viewport&&(k.viewport.style.scrollBehavior=""),L.current=null})})})}),ss="ScrollAreaThumb",zr=l.forwardRef((t,s)=>{const{forceMount:r,...a}=t,i=Br(ss,t.__scopeScrollArea);return e.jsx(Ut,{present:r||i.hasThumb,children:e.jsx(ri,{ref:s,...a})})}),ri=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,style:a,...i}=t,u=xe(ss,r),h=Br(ss,r),{onThumbPositionChange:g}=h,p=st(s,w=>h.onThumbChange(w)),x=l.useRef(void 0),f=ls(()=>{x.current&&(x.current(),x.current=void 0)},100);return l.useEffect(()=>{const w=u.viewport;if(w){const N=()=>{if(f(),!x.current){const k=ii(w,g);x.current=k,g()}};return g(),w.addEventListener("scroll",N),()=>w.removeEventListener("scroll",N)}},[u.viewport,f,g]),e.jsx(We.div,{"data-state":h.hasThumb?"visible":"hidden",...i,ref:p,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Ne(t.onPointerDownCapture,w=>{const k=w.target.getBoundingClientRect(),v=w.clientX-k.left,I=w.clientY-k.top;h.onThumbPointerDown({x:v,y:I})}),onPointerUp:Ne(t.onPointerUp,h.onThumbPointerUp)})});zr.displayName=ss;var Ss="ScrollAreaCorner",Hr=l.forwardRef((t,s)=>{const r=xe(Ss,t.__scopeScrollArea),a=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&a?e.jsx(ai,{...t,ref:s}):null});Hr.displayName=Ss;var ai=l.forwardRef((t,s)=>{const{__scopeScrollArea:r,...a}=t,i=xe(Ss,r),[u,h]=l.useState(0),[g,p]=l.useState(0),x=!!(u&&g);return kt(i.scrollbarX,()=>{const f=i.scrollbarX?.offsetHeight||0;i.onCornerHeightChange(f),p(f)}),kt(i.scrollbarY,()=>{const f=i.scrollbarY?.offsetWidth||0;i.onCornerWidthChange(f),h(f)}),x?e.jsx(We.div,{...a,ref:s,style:{width:u,height:g,position:"absolute",right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function rs(t){return t?parseInt(t,10):0}function Vr(t,s){const r=t/s;return isNaN(r)?0:r}function os(t){const s=Vr(t.viewport,t.content),r=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-r)*s;return Math.max(a,18)}function ni(t,s,r,a="ltr"){const i=os(r),u=i/2,h=s||u,g=i-h,p=r.scrollbar.paddingStart+h,x=r.scrollbar.size-r.scrollbar.paddingEnd-g,f=r.content-r.viewport,w=a==="ltr"?[0,f]:[f*-1,0];return Xr([p,x],w)(t)}function Ys(t,s,r="ltr"){const a=os(s),i=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,u=s.scrollbar.size-i,h=s.content-s.viewport,g=u-a,p=r==="ltr"?[0,h]:[h*-1,0],x=Wa(t,p);return Xr([0,h],[0,g])(x)}function Xr(t,s){return r=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(r-t[0])}}function Gr(t,s){return t>0&&t<s}var ii=(t,s=()=>{})=>{let r={left:t.scrollLeft,top:t.scrollTop},a=0;return(function i(){const u={left:t.scrollLeft,top:t.scrollTop},h=r.left!==u.left,g=r.top!==u.top;(h||g)&&s(),r=u,a=window.requestAnimationFrame(i)})(),()=>window.cancelAnimationFrame(a)};function ls(t,s){const r=ht(t),a=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(a.current),[]),l.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(r,s)},[r,s])}function kt(t,s){const r=ht(s);Qa(()=>{let a=0;if(t){const i=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(r)});return i.observe(t),()=>{window.cancelAnimationFrame(a),i.unobserve(t)}}},[t,r])}var Kr=Ur,oi=Wr,li=Hr;const Jr=l.forwardRef(({className:t,children:s,...r},a)=>e.jsxs(Kr,{ref:a,className:ue("relative overflow-hidden",t),...r,children:[e.jsx(oi,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Zr,{}),e.jsx(li,{})]}));Jr.displayName=Kr.displayName;const Zr=l.forwardRef(({className:t,orientation:s="vertical",...r},a)=>e.jsx(Ns,{ref:a,orientation:s,className:ue("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...r,children:e.jsx(zr,{className:"relative flex-1 rounded-full bg-border"})}));Zr.displayName=Ns.displayName;const ci=wt.memo(({shipmentId:t})=>{const{toast:s}=ns(),r=ms(),[a,i]=l.useState({}),[u,h]=l.useState(""),[g,p]=l.useState(!1),[x,f]=l.useState(null),[w,N]=l.useState(""),[k,v]=l.useState([]),[I,Y]=l.useState(""),[L,G]=l.useState({}),[O,se]=l.useState([]),[ge,re]=l.useState(!1),[oe,ae]=l.useState(null),[A,B]=l.useState(!1),[ee,me]=l.useState(null),[Be,Qe]=l.useState(""),[ze,He]=l.useState(""),[Pt,fe]=l.useState(!1),[rt,je]=l.useState(""),[_e,ne]=l.useState(null),[R,D]=l.useState(!1),[he,pe]=l.useState(""),[xt,at]=l.useState(null),[nt,it]=l.useState(null),[Ve,ot]=l.useState(!1),[le,Xe]=l.useState(1),[Ee,It]=l.useState(5),[Se,lt]=l.useState("all"),[ct,Dt]=l.useState(!1),{data:H,isLoading:Ge}=pt({queryKey:["admin-shipping-requests"],queryFn:async()=>{const{data:o,error:m}=await C.from("shipping_quotes").select("*").order("created_at",{ascending:!1});if(m)throw m;if(!o||o.length===0)return[];const _=[...new Set(o.map(Q=>Q.user_id))],{data:M,error:W}=await C.from("profiles").select("id, full_name, email, phone_number, user_personal_id").in("id",_);if(W)throw W;const be=new Map(M?.map(Q=>[Q.id,Q])||[]);return await Promise.all(o.map(async Q=>{const J=Array.isArray(Q.items)?Q.items:[],Wt=await Promise.all(J.map(async ft=>{if(ft.order_item_id){const{data:Cs}=await C.from("product_requests").select("id, product_url, item_name, quantity, weight, has_shipping_issue, shipping_issue_description, is_box, local_tracking_number").eq("id",ft.order_item_id).maybeSingle();if(Cs)return{...ft,...Cs}}return ft}));return{...Q,items:Wt,tracking_urls:Q.tracking_urls||void 0,user:be.get(Q.user_id)||{full_name:"Unknown User",email:"No email",phone_number:"No phone"}}}))},refetchInterval:3e4});wt.useEffect(()=>{t&&H&&H.length>0&&(i(o=>({...o,[t]:!0})),setTimeout(()=>{document.getElementById(`shipment-${t}`)?.scrollIntoView({behavior:"smooth",block:"center"})},100))},[t,H]),wt.useEffect(()=>{Xe(1)},[Se,Ee,ct]),wt.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[le]);const Te=Me({mutationFn:async({requestId:o,price:m,url:_})=>{const{error:M}=await C.from("shipping_quotes").update({actual_cost:m,quote_url:_,status:"quoted"}).eq("id",o);if(M)throw M},onSuccess:async(o,m)=>{const _=H?.find(M=>M.id===m.requestId);_&&await ke(_.user_id,"shipping_quote_received",`Your shipping quote of ¥${m.price.toLocaleString()} for Shipment #${_.shipment_personal_id}. Please review and complete payment.`,null,_.shipment_personal_id,m.requestId),r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Quote sent",description:"Shipping quote has been sent to the customer."}),B(!1),Qe(""),He(""),me(null)},onError:o=>{s({title:"Error",description:"Failed to send quote. Please try again.",variant:"destructive"}),console.error("Send quote error:",o)}}),Ae=Me({mutationFn:async({requestId:o,status:m,tracking_url:_,tracking_urls:M})=>{const W={status:m};_!==void 0&&(W.tracking_url=_),M!==void 0&&(W.tracking_urls=M);const{error:be}=await C.from("shipping_quotes").update(W).eq("id",o);if(be)throw be;const{data:te}=await C.from("shipping_quotes").select("user_id, destination, tracking_url, tracking_urls, shipment_personal_id").eq("id",o).single();if(te){if(m==="paid")await ke(te.user_id,"shipping_payment_confirmed",`Your payment for Shipment #${te.shipment_personal_id} has been confirmed! We will prepare your shipment to ${te.destination}.`,null,te.shipment_personal_id,o);else if(m==="sent"){let Q="";const J=te.tracking_urls;J&&J.length>0?Q=` Your shipment includes ${J.length} box(es) with tracking information.`:_&&(Q=` Track your package at: ${_}`),await ke(te.user_id,"shipment_sent",`Your Shipment #${te.shipment_personal_id} to ${te.destination} has been sent!${Q}`,null,te.shipment_personal_id,o)}}},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Status updated",description:"Shipping request status has been updated."}),re(!1),Y(""),ae(null)},onError:o=>{s({title:"Error",description:"Failed to update status. Please try again.",variant:"destructive"}),console.error("Update status error:",o)}}),ce=Me({mutationFn:async({requestId:o,tracking_url:m})=>{const{error:_}=await C.from("shipping_quotes").update({tracking_url:m}).eq("id",o);if(_)throw _},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Tracking URL updated",description:"The tracking URL has been updated successfully."}),fe(!1),je(""),ne(null)},onError:o=>{s({title:"Error",description:"Failed to update tracking URL. Please try again.",variant:"destructive"}),console.error("Update tracking URL error:",o)}}),dt=Me({mutationFn:async({requestId:o,itemId:m,tracking_url:_})=>{const{data:M,error:W}=await C.from("shipping_quotes").select("tracking_urls").eq("id",o).single();if(W)throw W;const be=M.tracking_urls||[],te=be.map(J=>J.item_id===m?{...J,tracking_url:_}:J);be.some(J=>J.item_id===m)||te.push({item_id:m,tracking_url:_,box_description:""});const{error:Q}=await C.from("shipping_quotes").update({tracking_urls:te}).eq("id",o);if(Q)throw Q},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Tracking URL updated",description:"The box tracking URL has been updated successfully."}),D(!1),pe(""),at(null),it(null)},onError:o=>{s({title:"Error",description:"Failed to update tracking URL. Please try again.",variant:"destructive"}),console.error("Update box tracking URL error:",o)}}),c=Me({mutationFn:async({requestId:o,reason:m,productIssues:_,requestItems:M})=>{const W=M.map(J=>{const Wt=_.find(ft=>ft.productId===J.id);return{product_id:J.id,product_url:J.product_url,item_name:J.item_name,quantity:J.quantity,weight:J.weight,has_issue:Wt?.hasIssue||!1,issue_description:Wt?.issueDescription||null}}),be={rejection_reason:m,rejected_at:new Date().toISOString(),product_issues:W},{error:te}=await C.from("shipping_quotes").update({status:"rejected",rejection_reason:m,rejection_details:be}).eq("id",o);if(te)throw te;const{data:Q}=await C.from("shipping_quotes").select("user_id, shipment_personal_id").eq("id",o).single();Q&&await ke(Q.user_id,"shipping_request_rejected",`Your shipping request for Shipment #${Q.shipment_personal_id} has been rejected. Reason: ${m.substring(0,100)}${m.length>100?"...":""}`,null,Q.shipment_personal_id,o)},onSuccess:()=>{r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Request rejected",description:"Shipping request has been rejected with issue details."}),p(!1),N(""),v([]),f(null)},onError:o=>{s({title:"Error",description:"Failed to reject request. Please try again.",variant:"destructive"}),console.error("Reject request error:",o)}}),j=async()=>{ot(!0);try{await r.invalidateQueries({queryKey:["admin-shipping-requests"]}),s({title:"Updated",description:"Shipping requests refreshed successfully."})}catch{s({title:"Error",description:"Failed to refresh data.",variant:"destructive"})}finally{ot(!1)}},d=o=>{f(o);const m=o.items.map(_=>({productId:_.id,hasIssue:!1,issueDescription:""}));v(m),p(!0)},n=()=>{!x||!w.trim()||c.mutate({requestId:x.id,reason:w,productIssues:k,requestItems:x.items})},b=(o,m,_)=>{v(M=>M.map(W=>W.productId===o?m==="hasIssue"?{...W,hasIssue:_,issueDescription:_?W.issueDescription:""}:{...W,issueDescription:_}:W))},y=o=>{me(o),B(!0)},T=()=>{!ee||!Be||!ze||Te.mutate({requestId:ee,price:parseFloat(Be),url:ze})},K=o=>{const m=o.items.filter(_=>_.is_box);if(se(m),ae(o.id),re(!0),m.length>0&&o.tracking_urls){const _={};o.tracking_urls.forEach(M=>{_[M.item_id]=M.tracking_url}),G(_)}else o.tracking_url?Y(o.tracking_url):(Y(""),G({}))},E=()=>{if(!oe)return;const o=Object.entries(L).filter(([m,_])=>_.trim()!=="").map(([m,_])=>({item_id:m,tracking_url:_}));Ae.mutate({requestId:oe,status:"sent",tracking_url:I||void 0,tracking_urls:o.length>0?o:void 0})},X=(o,m)=>{ne(o),je(m||""),fe(!0)},ve=()=>{_e&&ce.mutate({requestId:_e,tracking_url:rt})},gt=(o,m,_)=>{at(o),it(m),pe(_||""),D(!0)},q=()=>{xt&&nt&&dt.mutate({requestId:xt,itemId:nt,tracking_url:he})},we=o=>{i(m=>({...m,[o]:!m[o]}))},Oe=o=>{switch(o){case"pending":return"bg-yellow-100 text-yellow-800";case"quoted":return"bg-blue-100 text-blue-800";case"sent":return"bg-purple-100 text-purple-800";case"paid":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},ie=o=>{const m=[{label:"Request Received",status:"completed",icon:e.jsx(ye,{className:"h-4 w-4"})},{label:"Quote Sent",status:"upcoming",icon:e.jsx(qs,{className:"h-4 w-4"})},{label:"Payment Confirmed",status:"upcoming",icon:e.jsx(Js,{className:"h-4 w-4"})},{label:"Shipment Sent",status:"upcoming",icon:e.jsx(et,{className:"h-4 w-4"})}];if(o==="rejected")return[{label:"Request Received",status:"completed",icon:e.jsx(ye,{className:"h-4 w-4"})},{label:"Rejected",status:"rejected",icon:e.jsx(Bt,{className:"h-4 w-4"})}];const _={pending:0,quoted:1,paid:2,sent:3}[o]||0;return m.map((M,W)=>({...M,status:W<=_?"completed":"upcoming"}))};let P=H?.filter(o=>{const m=u.toLowerCase();return o.user.full_name?.toLowerCase().includes(m)||o.user.email?.toLowerCase().includes(m)||o.user.user_personal_id?.toLowerCase().includes(m)||o.destination?.toLowerCase().includes(m)||o.shipment_personal_id?.toLowerCase().includes(m)||o.id.toLowerCase().includes(m)})||[];Se!=="all"&&(P=P.filter(o=>o.status===Se)),ct&&(P=P.filter(o=>o.status!=="rejected"));const de=Math.ceil(P.length/Ee),Ce=(le-1)*Ee,Rt=Ce+Ee,$t=P.slice(Ce,Rt);return Ge?e.jsx(V,{children:e.jsx(Z,{className:"p-8",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Loading shipping requests..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsxs(Pe,{children:[e.jsx(tt,{children:"Shipping Requests"}),e.jsx(xs,{children:"Manage all shipping quote requests with complete shipping information"})]}),e.jsxs(Z,{children:[e.jsx("div",{className:"mb-6",children:e.jsx($,{placeholder:"Search by customer name, email, customer ID, shipment ID, or destination...",value:u,onChange:o=>h(o.target.value),className:"max-w-md"})}),e.jsx(V,{className:"bg-muted/30 mb-6",children:e.jsxs(Z,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Status:"}),e.jsxs(Nt,{value:Se,onValueChange:lt,children:[e.jsx(_t,{className:"w-[180px]",children:e.jsx(St,{})}),e.jsxs(Ct,{children:[e.jsx(U,{value:"all",children:"All Statuses"}),e.jsx(U,{value:"pending",children:"Pending Quote"}),e.jsx(U,{value:"quoted",children:"Awaiting Payment"}),e.jsx(U,{value:"paid",children:"Payment Received"}),e.jsx(U,{value:"sent",children:"Shipped"}),e.jsx(U,{value:"rejected",children:"Rejected"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:j,disabled:Ve,className:"gap-2",children:[e.jsx(Gs,{className:`h-4 w-4 ${Ve?"animate-spin":""}`}),Ve?"Refreshing...":"Update"]}),e.jsx(qt,{id:"hide-rejected",checked:ct,onCheckedChange:o=>Dt(o===!0)}),e.jsx("label",{htmlFor:"hide-rejected",className:"text-sm font-medium cursor-pointer",children:"Hide rejected"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Show:"}),e.jsxs(Nt,{value:Ee.toString(),onValueChange:o=>It(Number(o)),children:[e.jsx(_t,{className:"w-[100px]",children:e.jsx(St,{})}),e.jsxs(Ct,{children:[e.jsx(U,{value:"5",children:"5"}),e.jsx(U,{value:"10",children:"10"}),e.jsx(U,{value:"25",children:"25"}),e.jsx(U,{value:"50",children:"50"})]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"per page"})]})]}),P.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",Ce+1,"-",Math.min(Rt,P.length)," of ",P.length," shipping requests"]})]})}),e.jsxs("div",{className:"space-y-4",children:[P.length===0&&H&&H.length>0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(et,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No shipping requests found with this filter"}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your search or filter criteria."})]}),P.length===0&&(!H||H.length===0)&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No shipping requests found"}),$t.length>0&&$t?.map(o=>e.jsxs(js,{open:a[o.id],onOpenChange:()=>we(o.id),children:[e.jsx(vs,{asChild:!0,children:e.jsx(V,{id:`shipment-${o.id}`,className:"cursor-pointer hover:bg-accent/50 transition-colors",onClick:m=>{(window.getSelection()?.toString().length??0)>0&&m.stopPropagation()},children:e.jsx(Pe,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col text-left flex-1 space-y-1",children:[e.jsxs("p",{className:"font-medium text-base",children:[e.jsx("span",{className:"select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:"Shipment for "}),e.jsx("span",{className:"text-blue-500 font-semibold select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:o.user.full_name||o.user.email||"Unknown"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:"Customer ID: "}),e.jsx("span",{className:"font-medium text-emerald-500 select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:o.user.user_personal_id?`#${o.user.user_personal_id}`:"N/A"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx("span",{className:"select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:"Customer Shipment ID: "}),e.jsx("span",{className:"font-medium text-emerald-500 select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:o.shipment_personal_id?`#${o.shipment_personal_id}`:"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium select-text",onMouseDown:m=>m.stopPropagation(),onClick:m=>m.stopPropagation(),children:["Shipment #",o.id.substring(0,8).toUpperCase()]}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-4 w-4 p-0",onClick:m=>{m.stopPropagation(),navigator.clipboard.writeText(o.id),s({title:"Shipment ID copied to clipboard"})},title:"Copy Shipment ID",children:e.jsx(Ot,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:items-end gap-1 text-left sm:text-right",children:[e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(Ie,{className:Oe(o.status),children:o.status}),e.jsx(fs,{className:`h-4 w-4 text-muted-foreground transform transition-transform duration-300 ${a[o.id]?"rotate-180":"rotate-0"}`})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-3 gap-y-1 text-xs text-muted-foreground sm:justify-end",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ia,{className:"h-3 w-3"}),o.destination]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(et,{className:"h-3 w-3"}),o.shipping_method]})]}),e.jsxs("span",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ha,{className:"h-3 w-3"}),Qt(new Date(o.created_at),"PPpp")]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["¥",o.actual_cost||o.estimated_cost||"-"]})]})]})})})}),e.jsx(ws,{children:e.jsx(V,{className:"mt-2",children:e.jsxs(Z,{className:"pt-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Status Flow"}),e.jsx(Ks,{steps:ie(o.status)})]}),(()=>{const m=o.items.filter(_=>_.is_box);return m.length>0&&o.status==="sent"?e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-3",children:"Box Items Tracking"}),e.jsx("div",{className:"space-y-3",children:m.map((_,M)=>{const W=o.tracking_urls?.find(be=>be.item_id===_.id);return e.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-4 w-4 text-blue-700"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-blue-900",children:["Box ",M+1,": ",_.item_name||"No tracking"]}),_.item_name&&e.jsx("p",{className:"text-xs text-blue-700",children:_.local_tracking_number})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W?.tracking_url&&e.jsxs("a",{href:W.tracking_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-700 hover:underline flex items-center gap-1",children:[e.jsx(Mt,{className:"h-3 w-3"}),"View"]}),o.status==="sent"&&e.jsxs(S,{size:"sm",variant:"ghost",onClick:()=>gt(o.id,_.id,W?.tracking_url||""),className:"text-blue-700 hover:bg-blue-50 h-7 px-2",children:[e.jsx(Ds,{className:"h-3 w-3 mr-1"}),"Edit"]})]})]},_.id)})})]}):o.tracking_url?e.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-1",children:"Tracking Information"}),e.jsxs("a",{href:o.tracking_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-700 hover:underline flex items-center gap-1",children:[e.jsx(Mt,{className:"h-3 w-3"}),"View Tracking"]})]}),e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>X(o.id,o.tracking_url||""),className:"border-blue-500 text-blue-700 hover:bg-blue-50",children:[e.jsx(Ds,{className:"h-3 w-3 mr-1"}),"Edit URL"]})]})}):null})(),e.jsxs("div",{className:"mb-4 p-3 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Customer Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Email:"})," ",o.user.email]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Phone:"})," ",o.user.phone_number]})]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Shipping Address"}),e.jsx("div",{className:"text-sm",children:o.shipping_address&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:o.shipping_address.full_name}),e.jsx("p",{children:o.shipping_address.phone_number}),e.jsx("p",{className:"mt-2",children:o.shipping_address.address}),(o.shipping_address.city||o.shipping_address.state)&&e.jsx("p",{children:[o.shipping_address.city,o.shipping_address.state].filter(Boolean).join(", ")}),e.jsx("p",{children:o.shipping_address.postal_code}),e.jsx("p",{children:o.shipping_address.country}),o.shipping_address.address_notes&&e.jsxs("p",{className:"mt-2 text-muted-foreground",children:["Notes: ",o.shipping_address.address_notes]})]})})]}),o.status==="rejected"&&o.rejection_details&&e.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2 text-destructive",children:"Rejection Details"}),e.jsxs("p",{className:"text-sm mb-2",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",o.rejection_details.rejection_reason]}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-3",children:["Rejected on ",new Date(o.rejection_details.rejected_at).toLocaleString()]}),Array.isArray(o.rejection_details.product_issues)&&o.rejection_details.product_issues.length>0&&e.jsxs("div",{className:"space-y-4",children:[o.rejection_details.product_issues.some(m=>m.has_issue)&&e.jsxs("div",{children:[e.jsx(Aa,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-semibold text-destructive mb-1",children:"Flagged Products"}),o.rejection_details.product_issues.filter(m=>m.has_issue).map((m,_)=>e.jsxs("div",{className:"pl-3 border-l-2 border-destructive/30",children:[e.jsx("p",{className:"text-sm font-medium text-destructive",children:m.item_name||"Item "+(_+1)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",m.quantity," | Weight: ",m.weight,"g"]}),m.issue_description&&e.jsxs("p",{className:"text-xs text-destructive mt-1",children:["Issue: ",m.issue_description]}),m.product_url&&e.jsx("a",{href:m.product_url,target:"_blank",rel:"noopener noreferrer",className:"ml-5 text-xs text-blue-700 hover:underline break-all",children:m.product_url.length>60?m.product_url.substring(0,60)+"...":m.product_url})]},_))]}),o.rejection_details.product_issues.some(m=>!m.has_issue)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-700 mb-1",children:"Products"}),o.rejection_details.product_issues.filter(m=>!m.has_issue).map((m,_)=>e.jsxs("div",{className:"pl-3 border-l-2 border-green-300",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:m.item_name||"Item "+(_+1)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",m.quantity," | Weight: ",m.weight,"g"]}),m.product_url&&e.jsx("a",{href:m.product_url,target:"_blank",rel:"noopener noreferrer",className:"ml-5 text-xs text-blue-700 hover:underline break-all",children:m.product_url.length>60?m.product_url.substring(0,60)+"...":m.product_url})]},_))]})]})]}),!(o.status==="rejected"&&o.rejection_details)&&e.jsxs("div",{className:"mb-4 p-3 bg-accent/20 rounded-lg",children:[e.jsxs("h4",{className:"font-medium mb-2",children:["Items (",o.items?.length||0,")"]}),e.jsx("div",{className:"space-y-2",children:o.items?.map((m,_)=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{children:m.item_name||"Item "+(_+1)}),e.jsxs(Ie,{variant:"outline",children:["Qty: ",m.quantity]})]}),m.is_box?m.local_tracking_number&&e.jsxs("div",{className:"ml-5 text-xs text-muted-foreground",children:["Local Tracking: ",m.local_tracking_number]}):m.product_url&&e.jsx("a",{href:m.product_url,target:"_blank",rel:"noopener noreferrer",className:"ml-5 text-xs text-blue-700 hover:underline break-all",children:m.product_url.length>60?m.product_url.substring(0,60)+"...":m.product_url})]}),e.jsxs("span",{className:"text-muted-foreground",children:[m.weight,"g"]})]},_))}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Total Weight:"}),e.jsxs("span",{children:[o.total_weight,"g"]})]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Estimated Cost"}),e.jsxs("p",{className:"font-medium",children:["¥",o.estimated_cost||"-"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Actual Cost"}),e.jsxs("p",{className:"font-medium",children:["¥",o.actual_cost||"-"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[o.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>y(o.id),children:[e.jsx(qs,{className:"h-3 w-3 mr-1"}),"Send Quote"]}),e.jsxs(S,{size:"sm",variant:"outline",className:"text-red-600 hover:text-red-700",onClick:()=>d(o),children:[e.jsx(hs,{className:"h-3 w-3 mr-1"}),"Reject"]})]}),o.status==="quoted"&&e.jsxs(S,{size:"sm",variant:"outline",className:"text-green-600 hover:text-green-700",onClick:()=>Ae.mutate({requestId:o.id,status:"paid"}),children:[e.jsx(ps,{className:"h-3 w-3 mr-1"}),"Confirm Payment"]}),o.status==="paid"&&e.jsxs(S,{size:"sm",variant:"outline",className:"text-purple-600 hover:text-purple-700",onClick:()=>K(o),children:[e.jsx(et,{className:"h-3 w-3 mr-1"}),"Mark as Sent"]})]})]})]})})})]},o.id))]}),P.length>0&&de>1&&e.jsx(V,{className:"bg-muted/30 mt-6",children:e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>Xe(o=>Math.max(1,o-1)),disabled:le===1,children:[e.jsx(Oa,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:de},(o,m)=>m+1).map(o=>e.jsx(S,{variant:le===o?"default":"outline",size:"sm",onClick:()=>Xe(o),className:"min-w-[40px]",children:o},o))}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>Xe(o=>Math.min(de,o+1)),disabled:le===de,children:["Next",e.jsx(oa,{className:"h-4 w-4 ml-1"})]})]})})})]})]}),e.jsx(us,{open:g,onOpenChange:p,children:e.jsxs(Xt,{className:"max-w-2xl",children:[e.jsxs(Gt,{children:[e.jsx(Jt,{children:"Reject Shipping Request"}),e.jsx(Zt,{children:"Flag products with issues and provide rejection reasons."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"rejection-reason",children:"Overall Rejection Reason"}),e.jsx(ds,{id:"rejection-reason",placeholder:"Enter the main reason for rejecting this shipping request...",value:w,onChange:o=>N(o.target.value),className:"min-h-[80px]"})]}),x&&x.items.length>0&&e.jsxs("div",{children:[e.jsx(z,{children:"Product Issues"}),e.jsx(Jr,{className:"h-[300px] w-full rounded-md border p-4",children:e.jsx("div",{className:"space-y-4",children:x.items.map((o,m)=>{const _=k.find(M=>M.productId===o.id);return e.jsxs("div",{className:"space-y-2 p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(qt,{id:`issue-${o.id}`,checked:_?.hasIssue||!1,onCheckedChange:M=>b(o.id,"hasIssue",M)}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(z,{htmlFor:`issue-${o.id}`,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:o.item_name||"Item "+(m+1)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",o.quantity," | Weight: ",o.weight,"g"]}),o.product_url&&e.jsx("a",{href:o.product_url,target:"_blank",rel:"noopener noreferrer",className:"ml-5 text-xs text-blue hover:underline break-all",children:o.product_url.length>60?o.product_url.substring(0,60)+"...":o.product_url})]})]}),_?.hasIssue&&e.jsx(ds,{placeholder:"Describe the issue with this product...",value:_.issueDescription,onChange:M=>b(o.id,"issueDescription",M.target.value),className:"min-h-[60px] text-sm"})]},o.id||m)})})})]})]}),e.jsxs(Kt,{children:[e.jsx(ts,{onClick:()=>{N(""),v([]),f(null)},children:"Cancel"}),e.jsx(es,{onClick:n,disabled:!w.trim(),className:"bg-red-600 hover:bg-red-700 text-white",children:"Reject Request"})]})]})}),e.jsx(Le,{open:A,onOpenChange:B,children:e.jsxs(Fe,{children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Send Shipping Quote"}),e.jsx(Je,{children:"Enter the shipping cost and payment URL for the customer."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(z,{htmlFor:"quote-price",children:"Shipping Cost (¥)"}),e.jsx($,{id:"quote-price",type:"number",value:Be,onChange:o=>Qe(o.target.value),placeholder:"Enter shipping cost",required:!0})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:"quote-url",children:"Payment URL"}),e.jsx($,{id:"quote-url",type:"url",value:ze,onChange:o=>He(o.target.value),placeholder:"https://payment.example.com/...",required:!0})]})]}),e.jsxs(Ze,{children:[e.jsx(S,{variant:"outline",onClick:()=>{B(!1),Qe(""),He(""),me(null)},children:"Cancel"}),e.jsx(S,{onClick:T,disabled:!Be||!ze,children:"Send Quote"})]})]})}),e.jsx(Le,{open:ge,onOpenChange:re,children:e.jsxs(Fe,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Mark Shipment as Sent"}),e.jsx(Je,{children:O.length>0?`This shipment contains ${O.length} box(es). Please enter a tracking URL for each box.`:"Enter the tracking URL for this shipment (optional)."})]}),e.jsx("div",{className:"space-y-4",children:O.length>0?O.map((o,m)=>e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs("span",{children:["Box ",m+1]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o.local_tracking_number&&e.jsxs("p",{children:["Local Tracking: ",o.local_tracking_number]}),o.item_name&&e.jsxs("p",{children:["Item: ",o.item_name]})]}),e.jsxs("div",{children:[e.jsx(z,{htmlFor:`tracking-url-${o.id}`,children:"Tracking URL (Optional)"}),e.jsx($,{id:`tracking-url-${o.id}`,type:"url",value:L[o.id]||"",onChange:_=>G(M=>({...M,[o.id]:_.target.value})),placeholder:"https://tracking.example.com/..."})]})]},o.id)):e.jsxs("div",{children:[e.jsx(z,{htmlFor:"tracking-url",children:"Tracking URL (Optional)"}),e.jsx($,{id:"tracking-url",type:"url",value:I,onChange:o=>Y(o.target.value),placeholder:"https://tracking.example.com/..."})]})}),e.jsxs(Ze,{children:[e.jsx(S,{variant:"outline",onClick:()=>{re(!1),Y(""),G({}),se([]),ae(null)},children:"Cancel"}),e.jsx(S,{onClick:E,children:"Mark as Sent"})]})]})}),e.jsx(Le,{open:Pt,onOpenChange:fe,children:e.jsxs(Fe,{children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Edit Tracking URL"}),e.jsx(Je,{children:"Update the tracking URL for this shipment."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"edit-tracking-url",children:"Tracking URL"}),e.jsx($,{id:"edit-tracking-url",type:"url",value:rt,onChange:o=>je(o.target.value),placeholder:"https://tracking.example.com/..."})]})}),e.jsxs(Ze,{children:[e.jsx(S,{variant:"outline",onClick:()=>{fe(!1),je(""),ne(null)},children:"Cancel"}),e.jsx(S,{onClick:ve,children:"Update URL"})]})]})}),e.jsx(Le,{open:R,onOpenChange:D,children:e.jsxs(Fe,{children:[e.jsxs(Ue,{children:[e.jsx($e,{children:"Edit Box Tracking URL"}),e.jsx(Je,{children:"Update the tracking URL for this box item."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(z,{htmlFor:"edit-box-tracking-url",children:"Tracking URL"}),e.jsx($,{id:"edit-box-tracking-url",type:"url",value:he,onChange:o=>pe(o.target.value),placeholder:"https://tracking.example.com/..."})]})}),e.jsxs(Ze,{children:[e.jsx(S,{variant:"outline",onClick:()=>{D(!1),pe(""),at(null),it(null)},children:"Cancel"}),e.jsx(S,{onClick:q,children:"Update URL"})]})]})})]})}),di=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Analytics & Reports"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsx(tt,{className:"text-lg",children:"Total Requests"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600",children:"127"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This month"})]})]}),e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsx(tt,{className:"text-lg",children:"Revenue"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-3xl font-bold text-green-600",children:"¥185,000"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This month"})]})]}),e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsx(tt,{className:"text-lg",children:"Active Clients"})}),e.jsxs(Z,{children:[e.jsx("p",{className:"text-3xl font-bold text-purple-600",children:"42"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This month"})]})]})]})]}),ui=()=>{const[t,s]=l.useState([]),[r,a]=l.useState("32"),[i,u]=l.useState(!0),[h,g]=l.useState(!1),{toast:p}=ns();l.useEffect(()=>{x(),f()},[]);const x=async()=>{try{const{data:v,error:I}=await C.from("currency_rates").select("*").order("currency_code");if(I)throw I;s(v||[])}catch(v){console.error("Error fetching currency rates:",v),p({title:"Error",description:"Failed to load currency rates",variant:"destructive"})}finally{u(!1)}},f=async()=>{try{const{data:v,error:I}=await C.from("system_settings").select("*").eq("setting_key","dhl_fuel_percentage").maybeSingle();if(I)throw I;v&&a(v.setting_value)}catch(v){console.error("Error fetching system settings:",v),p({title:"Error",description:"Failed to load system settings",variant:"destructive"})}},w=(v,I)=>{s(t.map(Y=>Y.id===v?{...Y,rate_to_jpy:parseFloat(I)||0}:Y))},N=async()=>{g(!0);try{const{data:{user:v}}=await C.auth.getUser();for(const I of t){const{error:Y}=await C.from("currency_rates").update({rate_to_jpy:I.rate_to_jpy,updated_by:v?.id}).eq("id",I.id);if(Y)throw Y}p({title:"Success",description:"Currency rates updated successfully"})}catch(v){console.error("Error updating currency rates:",v),p({title:"Error",description:"Failed to update currency rates",variant:"destructive"})}finally{g(!1)}},k=async()=>{g(!0);try{const{data:{user:v}}=await C.auth.getUser(),{error:I}=await C.from("system_settings").update({setting_value:r,updated_by:v?.id}).eq("setting_key","dhl_fuel_percentage");if(I)throw I;p({title:"Success",description:"Shipping settings updated successfully"})}catch(v){console.error("Error updating shipping settings:",v),p({title:"Error",description:"Failed to update shipping settings",variant:"destructive"})}finally{g(!1)}};return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(cs,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"System Settings"}),e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsxs(tt,{className:"flex items-center gap-2",children:[e.jsx(ps,{className:"w-5 h-5"}),"Currency Exchange Rates"]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Set the exchange rates from JPY to other currencies. These rates are used in the purchase and shipping calculators."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(v=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["1 JPY = ",v.currency_code]}),e.jsx($,{type:"number",step:"0.000001",value:v.rate_to_jpy,onChange:I=>w(v.id,I.target.value),placeholder:`Rate to ${v.currency_code}`})]},v.id))}),e.jsx(S,{onClick:N,disabled:h,className:"bg-blue-300 hover:bg-blue-400 text-white",children:h?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Currency Rates"})]})]}),e.jsxs(V,{children:[e.jsx(Pe,{children:e.jsxs(tt,{className:"flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5"}),"Shipping Settings"]})}),e.jsxs(Z,{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Configure shipping-related settings such as DHL fuel surcharge percentage."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"DHL Fuel Surcharge (%)"}),e.jsx($,{type:"number",step:"0.1",min:"0",value:r,onChange:v=>a(v.target.value),placeholder:"Enter fuel surcharge percentage"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This percentage will be applied to all DHL shipments in the calculator."})]}),e.jsx(S,{onClick:k,disabled:h,className:"bg-blue-300 hover:bg-blue-400 text-white",children:h?e.jsxs(e.Fragment,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2 animate-spin"}),"Saving..."]}):"Save Shipping Settings"})]})]})]})},mi=async()=>{const{data:t,error:s}=await C.from("profiles").select("id, full_name, email, created_at, user_personal_id, country").order("created_at",{ascending:!1});if(s)return console.error("Error fetching profiles:",s),[];const{data:r,error:a}=await C.from("user_roles").select("*");return a&&console.error("Error fetching roles:",a),(t||[]).map(i=>{const u=r?.find(h=>h.user_id===i.id);return{id:i.id,email:i.email||"No email",full_name:i.full_name||"Unknown",role:u?.role||"user",created_at:i.created_at,user_personal_id:i.user_personal_id,country:i.country}})},hi=()=>{const{t}=sa(),{assignRole:s}=ra(),r=zs();Bs();const[a]=ta(),[i,u]=l.useState("requests"),[h,g]=l.useState(!1),p=ms();l.useEffect(()=>{const L=a.get("tab");L&&["requests","storage","shipping-requests","users","notifications","analytics","settings","orders"].includes(L)&&u(L)},[a]);const x=a.get("orderId"),f=a.get("shipmentId"),{data:w=[],refetch:N,isLoading:k}=pt({queryKey:["admin-users"],queryFn:mi,staleTime:60*1e3}),[v]=l.useState([{id:"AJ-001",clientId:"USER-123",clientName:"John Doe",productUrl:"https://example.com/anime-figure",quantity:1,status:"pending",estimatedCost:"¥5,000",finalQuote:"",paypalLink:"",notes:"Limited edition figure",internalNotes:"",date:"2024-06-10"},{id:"AJ-002",clientId:"USER-456",clientName:"Jane Smith",productUrl:"https://example.com/manga-set",quantity:5,status:"approved",estimatedCost:"¥3,000",finalQuote:"¥3,500",paypalLink:"https://paypal.me/example",notes:"Complete manga series",internalNotes:"Customer is a regular",date:"2024-06-08"}]),I=l.useCallback(async(L,G)=>{const{error:O}=await s(L,G);O||p.invalidateQueries({queryKey:["admin-users"]})},[s,p]),Y=()=>{switch(i){case"users":return e.jsx(Tn,{users:w,usersLoading:k,refetchUsers:N,handleRoleChange:I});case"requests":return e.jsx(Ws,{orderId:x});case"storage":return e.jsx(Lr,{});case"shipping-requests":return e.jsx(ci,{shipmentId:f});case"notifications":return e.jsx(qa,{});case"analytics":return e.jsx(di,{});case"settings":return e.jsx(ui,{});default:return e.jsx(Ws,{orderId:x})}};return e.jsx(la,{requireAdmin:!0,children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:[r&&h&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>g(!1)}),e.jsxs("div",{className:"flex w-full",children:[e.jsx(kn,{activeTab:i,setActiveTab:u,isMobile:r,sidebarOpen:h,setSidebarOpen:g,refetchUsers:N}),e.jsxs("div",{className:"flex-1 p-4 md:p-8 min-w-0 overflow-x-auto",children:[r&&e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),"Menu"]}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Admin Panel"})]}),Y()]})]})]})})},to=ea(wt.memo(hi));export{to as default};
