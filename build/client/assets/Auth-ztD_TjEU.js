import{w as W,t as Y,v as z,a as d,p as e,L as G}from"./chunk-4WY6JWTD-CQ2BrMui.js";import{u as K}from"./useAuth-DROiUoFu.js";import{B as m}from"./button-B0x8FPUr.js";import{C as A,c as L,a as X,b as Z}from"./card-SCvgtUFv.js";import{I as n}from"./input-CM33OdNU.js";import{L as t}from"./label-DN8oXECS.js";import{T as q}from"./textarea-DhCnVIFz.js";import{S as ee,a as se,b as ae,c as re,d as te}from"./select-D1jRWDQg.js";import{t as o}from"./use-toast-aoUui9pM.js";import{s as ie}from"./client-D-irrw7s.js";import{u as le}from"./AppContext-ASKE5L8w.js";import{A as ne}from"./shippingUtils-BkW84ZsF.js";import{M as oe}from"./mail-C_0T_cHr.js";import{b as I}from"./index-CobyQ-6_.js";import{E as b}from"./eye-off-Ckx5ESn6.js";import{E as w}from"./eye-C2ugwyJB.js";import{A as _}from"./arrow-right-C0qI5OkS.js";import{A as T}from"./arrow-left-Dj3pATct.js";import"./index-CwuhT9dy.js";import"./index-BNeLBswU.js";import"./index-B_jtOnfb.js";import"./utils-CDN07tui.js";import"./index-DQ6zQjx3.js";import"./Combination-BRrAW_Vh.js";import"./index-Bc3lnN9I.js";import"./tslib.es6-DcwbYiNs.js";import"./index-Cc9y-45e.js";const de=()=>{const{user:C,signUp:U,signIn:$}=K(),p=Y(),[N]=z(),[c,R]=d.useState(N.get("mode")!=="signup"),[g,x]=d.useState(!1),[u,P]=d.useState(!1),[v,D]=d.useState(!1),[B,S]=d.useState(!1),[r,f]=d.useState(1),[s,k]=d.useState({email:"",password:"",confirmPassword:"",fullName:"",phoneNumber:"",address:"",addressNotes:"",country:"",postalCode:"",city:"",state:""}),{t:a}=le();d.useEffect(()=>{C&&p("/")},[C,p]),d.useEffect(()=>{N.get("verified")==="true"&&p("/email-verification")},[N,p]);const i=l=>{k({...s,[l.target.name]:l.target.value})},H=()=>!s.email||!s.password||!s.fullName?(o({title:"Error",description:"Please fill in all required fields",variant:"destructive"}),!1):s.password!==s.confirmPassword?(o({title:"Error",description:"Passwords do not match",variant:"destructive"}),!1):s.password.length<6?(o({title:"Error",description:"Password must be at least 6 characters",variant:"destructive"}),!1):!0,Q=()=>s.phoneNumber?/^[\d\s+()-]+$/.test(s.phoneNumber)?!0:(o({title:"Error",description:"Please enter a valid phone number",variant:"destructive"}),!1):(o({title:"Error",description:"Please enter your phone number",variant:"destructive"}),!1),M=()=>!s.address||!s.country||!s.postalCode||!s.city||!s.state?(o({title:"Error",description:"Please fill in all required address fields",variant:"destructive"}),!1):!0,E=()=>{r===1&&H()?f(2):r===2&&Q()&&f(3)},F=()=>{f(r-1)},O=async l=>{if(l.preventDefault(),x(!0),c){const{error:h}=await $(s.email,s.password);h||p("/dashboard")}else{if(r===3&&!M()){x(!1);return}const{data:h}=await ie.from("profiles").select("email, phone_number").or(`email.eq.${s.email},phone_number.eq.${s.phoneNumber}`);if(h&&h.length>0){const V=h.find(y=>y.email===s.email),J=h.find(y=>y.phone_number===s.phoneNumber);if(V){o({title:"Email already registered",description:"This email is already in use. Please sign in or use a different email.",variant:"destructive"}),x(!1);return}if(J){o({title:"Phone number already registered",description:"This phone number is already in use. Please use a different phone number.",variant:"destructive"}),x(!1);return}}const{error:j}=await U(s.email,s.password,s.fullName,{phone_number:s.phoneNumber,address:s.address,address_notes:s.addressNotes,country:s.country,postal_code:s.postalCode,city:s.city,state:s.state});j?j.message?.includes("already registered")||j.message?.includes("User already registered")?o({title:"Email already registered",description:"This email is already registered. Please sign in instead.",variant:"destructive"}):o({title:"Sign up failed",description:j.message||"An error occurred during signup.",variant:"destructive"}):S(!0)}x(!1)};return B?e.jsx("div",{className:"min-h-screen bg-[url(tile_background.png)] bg-repeat flex items-center justify-center px-4",children:e.jsx(A,{className:"w-full max-w-md bg-white/90 backdrop-blur-sm border-primary/20 shadow-xl",children:e.jsx(L,{className:"p-12 text-center",children:e.jsxs("div",{className:"mb-6",children:[e.jsx(oe,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Check your email"}),e.jsxs("p",{className:"text-muted-foreground mb-8",children:["We've sent a verification email to"," ",e.jsx("strong",{children:s.email}),". Please check your inbox and click the verification link to activate your account."]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Didn't receive the email? Check your spam folder."}),e.jsx(m,{variant:"outline",onClick:()=>{S(!1),f(1)},className:"w-full",children:"Back to Sign Up"})]})})})}):e.jsx("div",{className:"min-h-screen bg-[url(tile_background.png)] bg-repeat animate-fade-in flex items-center justify-center px-4",children:e.jsxs(A,{className:"w-full max-w-md bg-white/90 backdrop-blur-sm border-primary/20 shadow-xl",children:[e.jsxs(X,{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[e.jsx("img",{src:"/aiyu_logo_small.png",alt:"Capybara Logo",className:"h-16 sm:h-16"}),e.jsx("span",{className:"font-paytone text-5xl text-[#3b434d] ",children:"Aiyu Japan"})]}),e.jsx(Z,{className:"text-2xl font-bold text-foreground",children:a(c?"signIn":"createYourAccount")}),!c&&e.jsxs("div",{className:"flex items-center justify-center mt-4 space-x-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=1?"bg-primary text-white":"bg-muted text-muted-foreground"}`,children:r>1?e.jsx(I,{className:"w-4 h-4"}):"1"}),e.jsx("div",{className:`w-12 h-1 ${r>=2?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=2?"bg-primary text-white":"bg-muted text-muted-foreground"}`,children:r>2?e.jsx(I,{className:"w-4 h-4"}):"2"}),e.jsx("div",{className:`w-12 h-1 ${r>=3?"bg-primary":"bg-muted"}`}),e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${r>=3?"bg-primary text-white":"bg-muted text-muted-foreground"}`,children:"3"})]})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsx("form",{onSubmit:O,className:"space-y-4",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"email",children:a("email")}),e.jsx(n,{id:"email",name:"email",type:"email",value:s.email,onChange:i,className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"password",children:a("password")}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"password",name:"password",type:u?"text":"password",value:s.password,onChange:i,className:"rounded-lg pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>P(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:u?e.jsx(b,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsx(m,{type:"submit",className:"w-full",disabled:g,children:a(g?"signingIn":"signIn")})]}):e.jsxs(e.Fragment,{children:[r===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"fullName",children:[a("fullName")," *"]}),e.jsx(n,{id:"fullName",name:"fullName",type:"text",value:s.fullName,onChange:i,className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"email",children:[a("email")," *"]}),e.jsx(n,{id:"email",name:"email",type:"email",value:s.email,onChange:i,className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"password",children:[a("password")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"password",name:"password",type:u?"text":"password",value:s.password,onChange:i,className:"rounded-lg pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>P(!u),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:u?e.jsx(b,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"confirmPassword",children:[a("confirmPassword")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"confirmPassword",name:"confirmPassword",type:v?"text":"password",value:s.confirmPassword,onChange:i,className:"rounded-lg pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>D(!v),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground",children:v?e.jsx(b,{className:"h-4 w-4"}):e.jsx(w,{className:"h-4 w-4"})})]})]}),e.jsxs(m,{type:"button",onClick:E,className:"w-full",children:[a("next")," ",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]}),r===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"phoneNumber",children:[a("phoneNumberLabel")," *"]}),e.jsx(n,{id:"phoneNumber",name:"phoneNumber",type:"tel",value:s.phoneNumber,onChange:i,placeholder:"+81 90-1234-5678",className:"rounded-lg",required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("includeCountryCode")})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:F,className:"flex-1",children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," ",a("back")]}),e.jsxs(m,{type:"button",onClick:E,className:"flex-1",children:[a("next")," ",e.jsx(_,{className:"ml-2 h-4 w-4"})]})]})]}),r===3&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"country",children:[a("country")," *"]}),e.jsxs(ee,{value:s.country,onValueChange:l=>k({...s,country:l}),children:[e.jsx(se,{className:"rounded-lg",children:e.jsx(ae,{placeholder:a("selectCountryPlaceholder")})}),e.jsx(re,{className:"max-h-[300px]",children:ne.map(l=>e.jsx(te,{value:l,children:l},l))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"state",children:[a("stateLabel")," *"]}),e.jsx(n,{id:"state",name:"state",type:"text",value:s.state,onChange:i,placeholder:a("statePlaceholder"),className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"city",children:[a("cityLabel")," *"]}),e.jsx(n,{id:"city",name:"city",type:"text",value:s.city,onChange:i,placeholder:a("cityPlaceholder"),className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"postalCode",children:[a("postalCodeLabel")," *"]}),e.jsx(n,{id:"postalCode",name:"postalCode",type:"text",value:s.postalCode,onChange:i,placeholder:"100-0001",className:"rounded-lg",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(t,{htmlFor:"address",children:[a("deliveryAddress")," *"]}),e.jsx(q,{id:"address",name:"address",value:s.address,onChange:i,placeholder:a("deliveryAddressPlaceholder"),className:"rounded-lg min-h-[80px]",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"addressNotes",children:a("deliveryNotes")}),e.jsx(q,{id:"addressNotes",name:"addressNotes",value:s.addressNotes,onChange:i,placeholder:a("deliveryNotesPlaceholder"),className:"rounded-lg min-h-[60px]"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:F,className:"flex-1",children:[e.jsx(T,{className:"mr-2 h-4 w-4"})," ",a("back")]}),e.jsx(m,{type:"submit",className:"flex-1",disabled:g,children:a(g?"creatingAccount":"completeSignUp")})]})]})]})}),e.jsxs("div",{className:"text-center space-y-2",children:[c&&e.jsx(G,{to:"/forgot-password",children:e.jsx("p",{className:"text-sm text-primary hover:text-primary-hover cursor-pointer",children:a("forgotPasswordQuestion")})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a(c?"dontHaveAccountQuestion":"alreadyHaveAccountQuestion")," ",e.jsx("button",{type:"button",onClick:()=>{R(!c),f(1)},className:"text-primary hover:text-primary-hover font-medium",children:a(c?"signUp":"signIn")})]})]})]})]})})},$e=W(de);export{$e as default};
