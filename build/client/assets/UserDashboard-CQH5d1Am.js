import{a as o,p as e,L as Xe,t as He,v as Ve,w as ws}from"./chunk-4WY6JWTD-CQ2BrMui.js";import{u as pe}from"./AppContext-ASKE5L8w.js";import{B as y}from"./button-B0x8FPUr.js";import{M as We,t as le,C as ts,G as Ss,k as ks}from"./index-Ce6NvDUG.js";import{L as Ye,P as Cs}from"./ProtectedRoute-DFjb99Eu.js";import{I as W}from"./input-CM33OdNU.js";import{L as C}from"./label-DN8oXECS.js";import{T as Re}from"./textarea-DhCnVIFz.js";import{C as B,a as ue,b as he,c as H,d as Ps}from"./card-SCvgtUFv.js";import{u as Is,S as Se,a as ke,b as Ce,c as Pe,d as O,C as ve}from"./select-D1jRWDQg.js";import{C as ce,a as we,b as oe}from"./collapsible-0hcxGzXU.js";import{u as as}from"./useAuth-DROiUoFu.js";import{s as T}from"./client-D-irrw7s.js";import{t as _e,u as rs}from"./use-toast-aoUui9pM.js";import{e as Rs,c as As,b as is,a as qs}from"./Combination-BRrAW_Vh.js";import{c as Ls,u as ns}from"./index-BNeLBswU.js";import{u as Ts}from"./index-CobyQ-6_.js";import{c as Ae}from"./utils-CDN07tui.js";import{C as Ke,U as ls,S as ds,F as cs,a as Ee,R as Ge,b as Le,T as ye,H as ge,c as os,d as Ue,P as Qe,D as Te,e as Es,f as Ds,g as es,h as be,i as Os,j as Ne,k as ze,l as $s,N as Fs}from"./NotificationsView-CuIv8_ER.js";import{A as ms,i as Bs,c as Us,u as Qs,a as zs}from"./shippingUtils-BkW84ZsF.js";import{C as me}from"./index-Cc9y-45e.js";import{X as us,D as Ms,a as Hs,b as Vs,c as Ws,d as Gs,e as Js}from"./dialog-Sc23x6E5.js";import{S as Zs}from"./save-Cvtw8xcv.js";import{n as hs,C as fe,B as ne}from"./badge-CCGCsnjh.js";import{P as ps}from"./plus-DnVR-hSP.js";import{T as Xs,a as Ys,b as Ks,c as et}from"./tooltip-CE8HawYa.js";import{P as X}from"./package-CQEqUhWv.js";import{L as Je,C as de}from"./link-BJqyYBkU.js";import{C as je}from"./circle-check-big-QBdueTg8.js";import{S as ss,T as V}from"./truck-DVkQtnrb.js";import{c as st}from"./index-B_jtOnfb.js";import{u as tt,a as at,R as rt,b as it}from"./useSystemSettings-B0Ke3myG.js";import{A as nt}from"./arrow-right-C0qI5OkS.js";import"./index-CwuhT9dy.js";import"./index-DQ6zQjx3.js";import"./index-Bc3lnN9I.js";import"./index-DnUP4w3H.js";import"./index-B_pwq4tm.js";import"./tslib.es6-DcwbYiNs.js";import"./index-B51jR1Lo.js";import"./circle-pKPOAmWE.js";const lt=[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]],dt=Ls("scale",lt);var $e="Switch",[ct]=As($e),[ot,mt]=ct($e),xs=o.forwardRef((u,p)=>{const{__scopeSwitch:j,name:d,checked:k,defaultChecked:P,required:g,disabled:E,value:q="on",onCheckedChange:L,form:v,...n}=u,[l,b]=o.useState(null),h=ns(p,D=>b(D)),R=o.useRef(!1),U=l?v||!!l.closest("form"):!0,[$,G]=Rs({prop:k,defaultProp:P??!1,onChange:L,caller:$e});return e.jsxs(ot,{scope:j,checked:$,disabled:E,children:[e.jsx(is.button,{type:"button",role:"switch","aria-checked":$,"aria-required":g,"data-state":bs($),"data-disabled":E?"":void 0,disabled:E,value:q,...n,ref:h,onClick:qs(u.onClick,D=>{G(t=>!t),U&&(R.current=D.isPropagationStopped(),R.current||D.stopPropagation())})}),U&&e.jsx(fs,{control:l,bubbles:!R.current,name:d,value:q,checked:$,required:g,disabled:E,form:v,style:{transform:"translateX(-100%)"}})]})});xs.displayName=$e;var gs="SwitchThumb",js=o.forwardRef((u,p)=>{const{__scopeSwitch:j,...d}=u,k=mt(gs,j);return e.jsx(is.span,{"data-state":bs(k.checked),"data-disabled":k.disabled?"":void 0,...d,ref:p})});js.displayName=gs;var ut="SwitchBubbleInput",fs=o.forwardRef(({__scopeSwitch:u,control:p,checked:j,bubbles:d=!0,...k},P)=>{const g=o.useRef(null),E=ns(g,P),q=Is(j),L=Ts(p);return o.useEffect(()=>{const v=g.current;if(!v)return;const n=window.HTMLInputElement.prototype,b=Object.getOwnPropertyDescriptor(n,"checked").set;if(q!==j&&b){const h=new Event("click",{bubbles:d});b.call(v,j),v.dispatchEvent(h)}},[q,j,d]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:j,...k,tabIndex:-1,ref:E,style:{...k.style,...L,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});fs.displayName=ut;function bs(u){return u?"checked":"unchecked"}var Ns=xs,ht=js;const _s=o.forwardRef(({className:u,...p},j)=>e.jsx(Ns,{className:Ae("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",u),...p,ref:j,children:e.jsx(ht,{className:Ae("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));_s.displayName=Ns.displayName;const pt=({userId:u,username:p})=>{const[j,d]=o.useState(!1),[k,P]=o.useState(0),{t:g}=pe(),E=(l,b)=>{b&&(navigator.clipboard.writeText(b),_e({title:g("japaneseAddresstoastCopied"),description:`${l}: ${b}`}))},q=l=>{d(l),P(b=>b+1)},L={username:p||"",prefecture:"大阪府大阪市淀川区",street:"西中島 6丁目2-3",building:`チサン第7-903号室 (${u})`,postal:"〒532-0011",phone:"090-7238-0062"},v={username:p||"",prefecture:"Osaka, Osaka-shi Yodogawa-ku",street:"Nishinakajima 6-2-3",building:`Chisun 7th #903 (${u})`,postal:"532-0011",phone:"090-7238-0062"},n=j?v:L;return e.jsxs(B,{className:"max-w-4xl border border-gray-200 shadow-sm mt-5",children:[e.jsxs(ue,{className:"flex flex-col items-start text-left space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{className:"h-5 w-5 text-capybara-orange"}),e.jsx(he,{children:g("japaneseAddresstitle")})]}),u&&e.jsx("div",{className:"flex justify-center w-full",children:e.jsxs("button",{onClick:()=>E("User ID",u),className:"flex items-center gap-2 bg-capybara-orange text-black font-mono px-4 py-2 rounded-full text-sm hover:opacity-90 transition",children:[e.jsx("span",{children:u}),e.jsx(Ke,{className:"h-3.5 w-3.5"})]})}),e.jsx("p",{className:"text-xs text-muted-foreground text-center w-full",children:g("japaneseAddressuserCodeNote")})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-center items-center gap-4",children:[e.jsx(C,{className:`text-sm transition-colors duration-300 ${j?"text-muted-foreground":"text-capybara-orange font-semibold"}`,children:g("japaneseAddresstoggleJapanese")}),e.jsx(_s,{checked:j,onCheckedChange:q,className:"transition-colors duration-300 data-[state=checked]:bg-capybara-orange"}),e.jsx(C,{className:`text-sm transition-colors duration-300 ${j?"text-capybara-orange font-semibold":"text-muted-foreground"}`,children:g("japaneseAddresstoggleRomaji")})]}),e.jsx("div",{className:"border rounded-lg divide-y text-sm transition-opacity duration-500 opacity-100 animate-fade-in",children:[{label:g("japaneseAddresslabelsname"),value:n.username},{label:g("japaneseAddresslabelsprefectureCity"),value:n.prefecture},{label:g("japaneseAddresslabelsstreet"),value:n.street},{label:g("japaneseAddresslabelsbuilding"),value:n.building},{label:g("japaneseAddresslabelspostalCode"),value:n.postal},{label:g("japaneseAddresslabelsphone"),value:n.phone}].map(l=>e.jsxs("div",{className:"flex justify-between items-center p-3 hover:bg-muted/40 transition-colors cursor-pointer group",onClick:()=>E(l.label,l.value),children:[e.jsxs("div",{className:"flex items-center gap-1 font-medium text-gray-800",children:[l.label,e.jsx(Ke,{className:"h-3.5 w-3.5 opacity-50 group-hover:opacity-100 transition-opacity"})]}),e.jsx("span",{children:l.value})]},l.label))},k),e.jsx("div",{className:"text-sm text-muted-foreground leading-relaxed",children:e.jsx("p",{children:g("japaneseAddressexplanation")})}),e.jsxs("div",{className:"border-t pt-3 text-sm text-muted-foreground",children:[e.jsx("p",{className:"font-semibold text-red-600 mb-1",children:g("japaneseAddresswarningsTitle")}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:g("japaneseAddresswarnings0")}),e.jsx("li",{children:g("japaneseAddresswarnings1")}),e.jsx("li",{children:g("japaneseAddresswarnings2")})]})]}),e.jsxs("div",{className:"border-t pt-3 text-sm text-muted-foreground leading-relaxed space-y-2",children:[e.jsx("p",{className:"font-semibold text-red-600 mb-1",children:g("japaneseAddressrulesTitle")}),e.jsx("p",{children:g("japaneseAddressrulesIntro")}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:g("japaneseAddressrules0")}),e.jsx("li",{children:g("japaneseAddressrules1")}),e.jsx("li",{children:g("japaneseAddressrules2")}),e.jsx("li",{children:g("japaneseAddressrules3")})]}),e.jsx("p",{className:"mt-3",children:g("japaneseAddressrulesBottom")})]})]})]})},xt=()=>{const{user:u,profile:p,refreshProfile:j}=as(),{t:d}=pe(),[k,P]=o.useState(!1),[g,E]=o.useState(!1),[q,L]=o.useState(!1),[v,n]=o.useState(!1),[l,b]=o.useState({user_personal_id:"",full_name:"",email:"",phone_number:"",address:"",address_notes:"",country:"",postal_code:"",city:"",state:""}),[h,R]=o.useState({full_name:"",email:"",phone_number:"",address:"",address_notes:"",country:"",postal_code:"",city:"",state:""});o.useEffect(()=>{U()},[u]),o.useEffect(()=>{if(p){const a={user_personal_id:p.user_personal_id||"",full_name:p.full_name||"",email:p.email||u?.email||"",phone_number:p.phone_number||"",address:p.address||"",address_notes:p.address_notes||"",country:p.country||"",postal_code:p.postal_code||"",city:p.city||"",state:p.state||""};b(a),R({full_name:a.full_name,email:a.email,phone_number:a.phone_number,address:a.address,address_notes:a.address_notes,country:a.country,postal_code:a.postal_code,city:a.city,state:a.state})}},[p,u]);const U=async()=>{if(u){P(!0);try{const{data:a,error:I}=await T.from("profiles").select("*").eq("id",u.id).maybeSingle();if(I)throw I;if(a){const _={user_personal_id:a.user_personal_id||"",full_name:a.full_name||"",email:a.email||u.email||"",phone_number:a.phone_number||"",address:a.address||"",address_notes:a.address_notes||"",country:a.country||"",postal_code:a.postal_code||"",city:a.city||"",state:a.state||""};b(_),R({full_name:_.full_name,email:_.email,phone_number:_.phone_number,address:_.address,address_notes:_.address_notes,country:_.country,postal_code:_.postal_code,city:_.city,state:_.state})}}catch{_e({title:"Error",description:d("errorLoadingProfile"),variant:"destructive"})}finally{P(!1)}}},$=async a=>{if(a.preventDefault(),!u){_e({title:"Error",description:d("mustBeLoggedIn"),variant:"destructive"});return}if(!h.full_name||!h.phone_number||!h.address||!h.country||!h.postal_code){_e({title:"Error",description:d("fillAllRequired"),variant:"destructive"});return}E(!0);try{const{data:I}=await T.from("profiles").select("id").eq("id",u.id).maybeSingle();let _;if(I){const{error:A}=await T.from("profiles").update({full_name:h.full_name,email:h.email,phone_number:h.phone_number,address:h.address,address_notes:h.address_notes||null,country:h.country,postal_code:h.postal_code,city:h.city,state:h.state,updated_at:new Date().toISOString()}).eq("id",u.id);_=A}else{const{error:A}=await T.from("profiles").insert({id:u.id,full_name:h.full_name,email:h.email,phone_number:h.phone_number,address:h.address,address_notes:h.address_notes||null,country:h.country,postal_code:h.postal_code,city:h.city,state:h.state});_=A}if(_)throw _;b({...l,...h}),L(!1),_e({title:"Success",description:d("savingSuccess")}),await j()}catch(I){_e({title:"Error",description:I.message||d("savingError"),variant:"destructive"})}finally{E(!1)}},G=()=>{R({...l}),L(!1)},D=()=>{R({...l}),L(!0),v||n(!0)},t=a=>{R({...h,[a.target.name]:a.target.value})};return k?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Ye,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"max-w-4xl",children:e.jsxs(ce,{open:v,onOpenChange:n,children:[e.jsx(we,{asChild:!0,children:e.jsxs(ue,{className:"flex flex-row items-center justify-between cursor-pointer hover:bg-muted/40 transition-colors rounded-t-lg select-none",children:[e.jsxs(he,{className:"flex items-center",children:[e.jsx(ls,{className:"mr-2 h-5 w-5 text-capybara-orange"}),d("profileInformation")]}),e.jsx(me,{className:"h-5 w-5 transition-transform duration-200 data-[state=open]:rotate-180"})]})}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsx(H,{children:q?e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[l.user_personal_id&&e.jsxs("div",{className:"space-y-2 bg-muted/50 p-4 rounded-lg border",children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:"User ID"}),e.jsx("p",{className:"font-mono font-semibold text-lg",children:l.user_personal_id})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"full_name",children:[d("fullNameLabel")," *"]}),e.jsx(W,{id:"full_name",name:"full_name",value:h.full_name,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"email",children:[d("emailLabel")," *"]}),e.jsx(W,{id:"email",name:"email",type:"email",value:h.email,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"phone_number",children:[d("phoneNumberLabel")," *"]}),e.jsx(W,{id:"phone_number",name:"phone_number",type:"tel",value:h.phone_number,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"country",children:[d("countryLabel")," *"]}),e.jsxs(Se,{value:h.country,onValueChange:a=>R({...h,country:a}),children:[e.jsx(ke,{children:e.jsx(Ce,{placeholder:d("selectCountryPlaceholder")})}),e.jsx(Pe,{className:"max-h-[300px]",children:ms.map(a=>e.jsx(O,{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"state",children:[d("stateLabel")," *"]}),e.jsx(W,{id:"state",name:"state",value:h.state,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"city",children:[d("cityLabel")," *"]}),e.jsx(W,{id:"city",name:"city",value:h.city,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"postal_code",children:[d("postalCodeLabel")," *"]}),e.jsx(W,{id:"postal_code",name:"postal_code",value:h.postal_code,onChange:t,required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"address",children:[d("deliveryAddress")," *"]}),e.jsx(Re,{id:"address",name:"address",value:h.address,onChange:t,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"address_notes",children:d("deliveryNotes")}),e.jsx(Re,{id:"address_notes",name:"address_notes",value:h.address_notes,onChange:t})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:G,disabled:g,children:[e.jsx(us,{className:"mr-2 h-4 w-4"}),d("cancelButton")]}),e.jsx(y,{type:"submit",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"mr-2 h-4 w-4 animate-spin"}),d("saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(Zs,{className:"mr-2 h-4 w-4"}),d("saveButton")]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[l.user_personal_id&&e.jsxs("div",{className:"space-y-2 bg-muted/50 p-4 rounded-lg border mb-6",children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:"User ID"}),e.jsx("p",{className:"font-mono font-semibold text-lg",children:l.user_personal_id})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("fullNameLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.full_name||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("emailLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.email||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("phoneNumberLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.phone_number||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("countryLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.country||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("stateLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.state||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("cityLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.city||d("notProvided")})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("postalCodeLabel")}),e.jsx("p",{className:"font-medium mt-1",children:l.postal_code||d("notProvided")})]})]}),e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("deliveryAddress")}),e.jsx("p",{className:"font-medium mt-1 whitespace-pre-wrap",children:l.address||d("notProvided")})]}),l.address_notes&&e.jsxs("div",{children:[e.jsx(C,{className:"text-muted-foreground text-sm",children:d("deliveryNotes")}),e.jsx("p",{className:"font-medium mt-1 whitespace-pre-wrap",children:l.address_notes})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(y,{className:"w-full",onClick:D,children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),d("editProfileButton")]})})]})})})]})}),e.jsx(pt,{userId:l.user_personal_id,username:l.full_name})]})};function gt(){const{t:u}=pe(),[p,j]=o.useState([{url:"",name:"",quantity:1,notes:""}]),[d,k]=o.useState(!1),{toast:P}=rs(),g=()=>{j([...p,{url:"",name:"",quantity:1,notes:""}])},E=v=>{j(p.filter((n,l)=>l!==v))},q=(v,n,l)=>{const b=[...p];n==="quantity"?b[v][n]=Number(l)||1:b[v][n]=l,j(b)},L=async v=>{v.preventDefault(),k(!0);try{const{data:{user:n}}=await T.auth.getUser();if(!n)throw new Error("Not authenticated");const l=p.filter(t=>t.url.trim());if(l.length===0){P({title:"Error",description:u("atLeastOneProduct"),variant:"destructive"});return}const{data:b,error:h}=await T.rpc("create_order_with_product_requests",{p_user_id:n.id,p_product_requests:l.map(t=>({product_url:t.url.trim(),item_name:t.name.trim()||null,quantity:t.quantity,notes:t.notes.trim()||null}))});if(h)throw h;let R="new";if(b?.[0]?.order_id){const{data:t}=await T.from("orders").select("order_personal_id").eq("id",b[0].order_id).single();R=t?.order_personal_id||b[0].order_id.slice(0,8)}let U=R;b?.[0]?.order_id&&(U=typeof b[0].order_id=="string"?b[0].order_id.slice(0,8).toUpperCase():"");const{data:$}=await T.from("profiles").select("full_name, user_personal_id").eq("id",n.id).single(),G=$?.full_name||"Unknown User",D=$?.user_personal_id?`#${$.user_personal_id}`:"";b?.[0]&&await hs("new_product_request",`New product request from ${G} ${D}. Order #${U} with ${l.length} item${l.length>1?"s":""}.`,b[0].order_id),P({title:"Success",description:u("requestSubmittedSuccess")}),j([{url:"",name:"",quantity:1,notes:""}])}catch(n){P({title:"Error",description:n.message||u("requestSubmittedError"),variant:"destructive"})}finally{k(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center gap-2 sm:gap-3 mb-2",children:[e.jsx(y,{variant:"default",asChild:!0,className:"flex-1 min-w-0 text-center w-full border-2 border-black-800 text-black bg-white hover:bg-capybara-orange hover:text-white transition-colors px-3 py-2.5 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium whitespace-normal",children:e.jsx(Xe,{to:"/store-guide",children:u("seeJapaneseStores")})}),e.jsx(y,{variant:"default",asChild:!0,className:"flex-1 min-w-0 text-center w-full border-2 border-black-800 text-black bg-white hover:bg-capybara-orange hover:text-white transition-colors px-3 py-2.5 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium whitespace-normal",children:e.jsx(Xe,{to:"/calculator",children:u("calculateEstimatedCost")})})]}),e.jsxs(B,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:u("productRequestTitle")}),e.jsx(Ps,{children:u("productRequestSubtitle")})]}),e.jsx(H,{children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[p.map((v,n)=>e.jsxs("div",{className:"space-y-2 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs(C,{children:[u("products")," ",n+1]}),p.length>1&&e.jsx(y,{type:"button",variant:"ghost",size:"sm",onClick:()=>E(n),children:e.jsx(us,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx(W,{placeholder:u("productUrlPlaceholder"),value:v.url,onChange:l=>q(n,"url",l.target.value),required:!0,className:"md:col-span-2"}),e.jsx(W,{type:"number",placeholder:u("quantity"),value:v.quantity,onChange:l=>q(n,"quantity",l.target.value),min:"1",required:!0}),e.jsx(W,{placeholder:u("productNamePlaceholder"),value:v.name,onChange:l=>q(n,"name",l.target.value)}),e.jsx(Re,{placeholder:u("productNotesPlaceholder"),value:v.notes,onChange:l=>q(n,"notes",l.target.value),className:"md:col-span-2",rows:2})]})]},n)),e.jsxs(y,{type:"button",variant:"outline",onClick:g,className:"w-full",children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),u("addProduct")]}),e.jsx(y,{type:"submit",className:"w-full",disabled:d,children:u(d?"submitting":"submitRequestButton")})]})})]})]})}const jt=()=>{const[u,p]=o.useState([]),[j,d]=o.useState(!0),[k,P]=o.useState(!1),[g,E]=o.useState(new Set),[q,L]=o.useState(1),[v,n]=o.useState(5),[l,b]=o.useState("all"),[h,R]=o.useState(!1),[U,$]=o.useState(!1),G=He(),[D]=Ve(),{t}=pe();o.useEffect(()=>{a()},[]),o.useEffect(()=>{L(1)},[l,v,h]),o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[q]),o.useEffect(()=>{const i=D.get("orderId");i&&u.length>0&&(E(new Set([i])),setTimeout(()=>{const f=document.getElementById(`order-${i}`);f&&f.scrollIntoView({behavior:"smooth",block:"center"})},100))},[D,u]);const a=async()=>{try{const{data:{user:i}}=await T.auth.getUser();if(!i)return;const{data:f,error:s}=await T.from("orders").select(`
          *,
          quotes (*),
          order_items (
            product_request:product_requests (*)
          )
        `).eq("user_id",i.id).order("created_at",{ascending:!1});if(s)throw s;const m=f?.filter(N=>!(N.quotes?.some(w=>w.type==="shipping")??!1))||[];p(m)}catch(i){console.error("Error fetching orders:",i),le.error("Failed to load orders")}finally{d(!1)}},I=i=>{const f=new Set(g);f.has(i)?f.delete(i):f.add(i),E(f)},_=i=>{const f=i.order_items?.map(c=>c.product_request.status)??[],s=f.filter(c=>c==="purchased").length,m=f.filter(c=>c==="received").length,N=f.length;return{somePurchased:s>0&&s<N&&m===0,allPurchased:s===N&&N>0&&m===0,someReceived:m>0&&m<N,allReceived:m===N&&N>0,purchasedCount:s,receivedCount:m,totalCount:N}},A=i=>{if(i.is_rejected)return"rejected";i.order_items?.map(m=>m.product_request.status);const f=_(i);if(f.allReceived)return"all_received";if(f.allPurchased||f.purchasedCount>0&&f.receivedCount>0)return"in_transit";if(f.somePurchased)return"some_purchased";const s=i.quotes?.find(m=>m.type==="product");return s?s.status==="paid"?"paid":"quoted":"requested"},F=(i,f)=>{const m=_(f).allPurchased||i==="in_transit"||i==="all_received"?t("statusStepItemsPurchased"):t("statusStepItemsBeingPurchased"),N=[{label:t("statusStepRequestSubmitted"),status:"upcoming",icon:e.jsx(de,{className:"h-4 w-4"})},{label:t("statusStepPaymentConfirmed"),status:"upcoming",icon:e.jsx(je,{className:"h-4 w-4"})},{label:m,status:"upcoming",icon:e.jsx(ss,{className:"h-4 w-4"})},{label:t("statusStepItemsOnTheWay"),status:"upcoming",icon:e.jsx(V,{className:"h-4 w-4"})},{label:t("statusStepAllAtWarehouse"),status:"upcoming",icon:e.jsx(ge,{className:"h-4 w-4"})}];return i==="rejected"?[{label:t("statusStepRequestSubmitted"),status:"completed",icon:e.jsx(de,{className:"h-4 w-4"})},{label:t("statusRejected"),status:"rejected",icon:e.jsx(Ue,{className:"h-4 w-4"})}]:N.map((c,w)=>{if(w===0)return{...c,status:"completed"};if(w===1){if(["requested","quoted"].includes(i))return{...c,status:"current"};if(["paid","some_purchased","all_purchased","in_transit","all_received"].includes(i))return{...c,status:"completed"}}if(w===2){if(i==="paid")return{...c,status:"current"};if(["some_purchased","all_purchased","in_transit","all_received"].includes(i))return{...c,status:"completed"}}if(w===3){if(["some_purchased","in_transit"].includes(i))return{...c,status:"current"};if(["all_received"].includes(i))return{...c,status:"completed"}}return w===4&&["all_received"].includes(i)?{...c,status:"completed"}:{...c,status:"upcoming"}})},x=i=>({requested:"bg-capybara-yellow text-red-500",quoted:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",some_purchased:"bg-purple-100 text-purple-800",all_purchased:"bg-green-100 text-green-800",in_transit:"bg-blue-100 text-blue-800",all_received:"bg-indigo-100 text-indigo-800",purchased:"bg-purple-100 text-purple-800",rejected:"bg-red-100 text-red-800"})[i]||"bg-gray-100 text-gray-800",Q=i=>({requested:t("requested"),quoted:t("quoted"),paid:t("paid"),purchased:t("purchased"),all_received:t("all_received"),partial_received:t("partial_received"),rejected:t("rejected")})[i]||"Status information unavailable.",Y=i=>({requested:e.jsx(de,{className:"h-4 w-4"}),quoted:e.jsx(Te,{className:"h-4 w-4"}),paid:e.jsx(je,{className:"h-4 w-4"}),some_purchased:e.jsx(ss,{className:"h-4 w-4"}),all_purchased:e.jsx(Qe,{className:"h-4 w-4"}),in_transit:e.jsx(V,{className:"h-4 w-4"}),all_received:e.jsx(ge,{className:"h-4 w-4"}),purchased:e.jsx(Qe,{className:"h-4 w-4"}),received:e.jsx(ge,{className:"h-4 w-4"}),shipped:e.jsx(V,{className:"h-4 w-4"}),rejected:e.jsx(Ue,{className:"h-4 w-4"})})[i]||e.jsx(X,{className:"h-4 w-4"}),ee=i=>{const f=i.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase());let s="",m=null;switch(i){case"requested":s="bg-gray-100 text-gray-800 border-gray-300",m=e.jsx(de,{className:"h-3 w-3 mr-1"});break;case"quoted":s="bg-yellow-100 text-yellow-800 border-yellow-300",m=e.jsx(Te,{className:"h-3 w-3 mr-1"});break;case"paid":s="bg-blue-100 text-blue-800 border-blue-300",m=e.jsx(je,{className:"h-3 w-3 mr-1"});break;case"purchased":s="bg-green-100 text-green-800 border-green-300",m=e.jsx(Qe,{className:"h-3 w-3 mr-1"});break;case"received":s="bg-indigo-100 text-indigo-800 border-indigo-300",m=e.jsx(ge,{className:"h-3 w-3 mr-1"});break;case"shipping_quoted":s="bg-purple-100 text-purple-800 border-purple-300",m=e.jsx(Te,{className:"h-3 w-3 mr-1"});break;case"shipping_paid":s="bg-teal-100 text-teal-800 border-teal-300",m=e.jsx(je,{className:"h-3 w-3 mr-1"});break;case"shipped":s="bg-emerald-100 text-emerald-800 border-emerald-300",m=e.jsx(V,{className:"h-3 w-3 mr-1"});break;case"rejected":s="bg-red-100 text-red-800 border-red-300",m=e.jsx(Ue,{className:"h-3 w-3 mr-1"});break;default:s="bg-gray-100 text-gray-800 border-gray-300",m=e.jsx(de,{className:"h-3 w-3 mr-1"})}return e.jsxs(ne,{variant:"outline",className:`text-xs flex items-center gap-1 ${s}`,children:[m,f]})},te=i=>{window.open(i,"_blank")},Ie=()=>{const i=window.location.pathname.includes("admin")?"/admin-dashboard":"/user-dashboard";G(`${i}?tab=storage`)},K=i=>{G(`/edit-order/${i}`)},M=async()=>{P(!0);try{await a(),le.success(t("ordersUpdatedSuccess"))}catch{le.error(t("ordersUpdateError"))}finally{P(!1)}};if(j)return e.jsx("div",{className:"flex justify-center p-8",children:t("loadingOrders")});let z=l==="all"?u:u.filter(i=>A(i)===l);h&&(z=z.filter(i=>!i.is_rejected));const ae=Math.ceil(z.length/v),S=(q-1)*v,re=S+v,ie=z.slice(S,re);return u.length===0?e.jsx(B,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:t("noActiveOrders")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:t("noActiveOrdersDescription")})]})}):e.jsx(Xs,{delayDuration:0,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("h2",{className:"text-2xl font-bold",children:t("currentOrders")})}),e.jsxs(y,{variant:"outline",onClick:()=>$(!U),className:"mb-4 gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),t("filterOrders"),U?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(me,{className:"h-4 w-4"})]}),e.jsx(ce,{open:U,onOpenChange:$,children:e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsx(B,{className:"bg-muted/30 mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:`\r
        flex flex-wrap items-center justify-between gap-3\r
        md:justify-start\r
      `,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t("statusFilter")}),e.jsxs(Se,{value:l,onValueChange:b,children:[e.jsx(ke,{className:"w-[190px]",children:e.jsx(Ce,{placeholder:t("allStatuses")})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"all",children:t("allStatuses")}),e.jsx(O,{value:"requested",children:t("statusRequested")}),e.jsx(O,{value:"quoted",children:t("statusAwaitingPayment")}),e.jsx(O,{value:"paid",children:t("statusPaid")}),e.jsx(O,{value:"some_purchased",children:t("statusSomePurchased")}),e.jsx(O,{value:"all_purchased",children:t("statusAllPurchased")}),e.jsx(O,{value:"in_transit",children:t("statusInTransit")}),e.jsx(O,{value:"all_received",children:t("statusAllAtWarehouse")}),e.jsx(O,{value:"rejected",children:t("statusRejected")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t("showPerPage")}),e.jsxs(Se,{value:v.toString(),onValueChange:i=>n(Number(i)),children:[e.jsx(ke,{className:"w-[90px]",children:e.jsx(Ce,{})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"5",children:"5"}),e.jsx(O,{value:"10",children:"10"}),e.jsx(O,{value:"25",children:"25"}),e.jsx(O,{value:"50",children:"50"})]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:t("perPage")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{id:"hide-rejected",checked:h,onCheckedChange:i=>R(i===!0)}),e.jsx("label",{htmlFor:"hide-rejected",className:"text-sm font-medium cursor-pointer whitespace-nowrap",children:t("hideRejected")})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:M,disabled:k,className:"gap-2",children:[e.jsx(Ge,{className:`h-4 w-4 ${k?"animate-spin":""}`}),t(k?"refreshing":"update")]})]})]}),z.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[t("showingOrders")," ",S+1,"-",Math.min(re,z.length)," ",t("ofOrders")," ",z.length," ",t("ordersText")]})]})})})}),ie.map(i=>{const f=A(i),s=F(f,i),m=i.quotes?.find(r=>r.type==="product"),N=g.has(i.id),w={requested:t("statusRequested"),quoted:t("statusAwaitingPayment"),paid:t("statusPaid"),some_purchased:t("statusSomePurchased"),all_purchased:t("statusAllPurchased"),in_transit:t("statusInTransit"),all_received:t("statusAllAtWarehouse"),rejected:t("statusRejected")}[f]||(f?f.replace(/_/g," ").replace(/^\w/,r=>r.toUpperCase()):"");return e.jsx(ce,{open:N,children:e.jsxs(B,{id:`order-${i.id}`,children:[e.jsxs(ue,{onClick:()=>I(i.id),className:"cursor-pointer hover:bg-muted/50 transition-colors border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(he,{className:"text-lg",children:[t("orderNumber"),i.order_personal_id||i.id.slice(0,8)]}),e.jsx(Ys,{children:e.jsxs("span",{className:"cursor-default",children:[e.jsx(Ks,{asChild:!0,children:e.jsx("span",{children:e.jsxs("span",{className:`${x(f)} px-2 py-1 text-xs rounded-md inline-flex items-center gap-1`,children:[Y(f),e.jsx("span",{className:"ml-1",children:w})]})})}),e.jsx(et,{side:"right",alignOffset:40,className:"right-80 z-60 text-grey-700 border border-capybara-orange shadow-lg",children:e.jsx("p",{children:Q(f)})})]})})]}),e.jsx(we,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>I(i.id),children:N?e.jsx(ve,{}):e.jsx(me,{})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t("createdOn")," ",new Date(i.created_at).toLocaleDateString()]})]}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx(Le,{steps:s}),["some_purchased","all_purchased","in_transit"].includes(f)&&e.jsx("div",{className:"mt-3 mb-4 p-3 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ℹ️ ",t("normalDeliveryInfo")]})}),["paid"].includes(f)&&e.jsx("div",{className:"mt-3 mb-4 p-3 bg-blue-50 dark:bg-blue-950/30 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ℹ️ ",t("paymentReceivedInfo")]})}),i.is_rejected&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-red-900",children:t("orderRejected")}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:i.rejection_details?.rejection_reason||i.rejection_reason}),e.jsxs(y,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>K(i.id),children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),t("editOrder")]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-medium text-sm",children:[t("productsInOrder"),":"]}),i.rejection_details?i.rejection_details.product_issues?.map((r,J)=>e.jsx("div",{className:"flex items-start justify-between p-3 bg-secondary rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("p",{className:"font-medium text-sm",children:[J+1,") ",r.item_name||"Unnamed Product"]})}),e.jsx("a",{href:r.product_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary hover:underline truncate block max-w-md",children:r.product_url}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Qty: ",r.quantity||1]})}),r.has_issue&&r.issue_description&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 bg-yellow-50 border border-yellow-200 rounded p-2",children:[e.jsx(fe,{className:"h-3 w-3 text-yellow-600 flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-yellow-700",children:[t("issuePrefix")," ",r.issue_description]})]})]})},r.product_id)):i.order_items?.map((r,J)=>e.jsxs("div",{className:"flex flex-wrap items-start justify-between p-3 bg-secondary rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("p",{className:"font-medium text-sm truncate",children:[J+1,") ",r.product_request.item_name||"Unnamed Product"]}),r.product_request.status==="received"&&e.jsxs(ne,{variant:"secondary",className:"text-xs bg-indigo-100 text-indigo-800 border-indigo-200",children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"In Storage"]})]}),e.jsx("div",{className:"max-w-[280px] truncate",children:e.jsxs("a",{href:r.product_request.product_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-blue-600 hover:underline text-xs",title:r.product_request.product_url,children:[e.jsx(Je,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:r.product_request.product_url})]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 flex-wrap text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Qty: ",r.product_request.quantity||1]}),r.product_request.notes&&e.jsxs("span",{children:["Note: ",r.product_request.notes]})]}),r.product_request.has_purchase_issue&&r.product_request.purchase_issue_description&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 bg-yellow-50 border border-yellow-200 rounded p-2",children:[e.jsx(fe,{className:"h-3 w-3 text-yellow-600 flex-shrink-0"}),e.jsxs("span",{className:"text-xs text-yellow-700",children:["Issue: ",r.product_request.purchase_issue_description]})]})]}),!i.is_rejected&&e.jsx("div",{className:"flex-shrink-0 ml-3 self-start",children:ee(r.product_request.status)})]},r.product_request.id))]}),(f==="all_received"||f==="in_transit"&&i.order_items?.some(r=>r.product_request.status==="received"))&&e.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-indigo-900",children:f==="all_received"?"All items at warehouse":"Items on the way to warehouse"}),e.jsx("p",{className:"text-sm text-indigo-700",children:f==="all_received"?"View and manage your items in storage":i.order_items?.some(r=>r.product_request.status==="received")?"Some items may already be available in storage":"Items will be available in storage once received"})]})]}),e.jsx(y,{variant:"outline",size:"sm",onClick:Ie,className:"border-indigo-300 text-indigo-700 hover:bg-indigo-100",children:t("goToStorage")})]})}),m&&m.status!=="paid"&&e.jsx("div",{className:"bg-primary/5 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium mb-2",children:t("quoteIssued")}),e.jsxs("div",{className:"flex items-start text-xs text-muted-foreground max-w-s text-left pt-1",children:[e.jsx(ye,{className:"h-3 w-3 mr-2 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t("paymentConfirmationNotice1"),e.jsx("br",{}),t("paymentConfirmationNotice2")]})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsx(y,{onClick:()=>te(m.quote_url),className:"bg-primary hover:bg-primary/90",children:t("payNow")})})]})})]})})]})},i.id)}),z.length>0&&ae>1&&e.jsx(B,{className:"bg-muted/30",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>L(i=>Math.max(1,i-1)),disabled:q===1,children:[e.jsx(os,{className:"h-4 w-4 mr-1"}),t("previous")]}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:ae},(i,f)=>f+1).map(i=>e.jsx(y,{variant:q===i?"default":"outline",size:"sm",onClick:()=>L(i),className:"min-w-[40px]",children:i},i))}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>L(i=>Math.min(ae,i+1)),disabled:q===ae,children:[t("next"),e.jsx(ts,{className:"h-4 w-4 ml-1"})]})]})})})]})})},ft=st("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),De=o.forwardRef(({className:u,variant:p,...j},d)=>e.jsx("div",{ref:d,role:"alert",className:Ae(ft({variant:p}),u),...j}));De.displayName="Alert";const Me=o.forwardRef(({className:u,...p},j)=>e.jsx("h5",{ref:j,className:Ae("mb-1 font-medium leading-none tracking-tight",u),...p}));Me.displayName="AlertTitle";const Oe=o.forwardRef(({className:u,...p},j)=>e.jsx("div",{ref:j,className:Ae("text-sm [&_p]:leading-relaxed",u),...p}));Oe.displayName="AlertDescription";const bt=({open:u,onOpenChange:p,selectedItems:j,totalWeight:d,onSuccess:k})=>{const{profile:P}=as(),{toast:g}=rs(),{convertCurrency:E}=tt(),{settings:q,loading:L}=at(),[v,n]=o.useState(!1),[l,b]=o.useState(""),[h,R]=o.useState("economic"),[U,$]=o.useState(""),[G,D]=o.useState(""),[t,a]=o.useState(""),[I,_]=o.useState(""),[A,F]=o.useState(""),[x,Q]=o.useState(""),[Y,ee]=o.useState(""),[te,Ie]=o.useState(""),[K,M]=o.useState(""),[z,ae]=o.useState(""),{t:S}=pe(),re=l?zs(l):null,ie=l?Bs(l):!1;o.useEffect(()=>{l==="Paraguay"?R("paraguay"):h==="paraguay"&&R("economic")},[l]),o.useEffect(()=>{ie&&h!=="dhl"&&R("dhl")},[ie,h]);const i=Number(d)||0,f=l==="Paraguay"?[{value:"paraguay",label:S("paraguayShippingLabel")}]:ie?[{value:"dhl",label:S("dhlShipping")}]:i>2e3?[{value:"express",label:S("expressShippingLabel")},{value:"dhl",label:S("dhlShipping")}]:[{value:"economic",label:S("economicShippingLabel")},{value:"express",label:S("expressShippingLabel")},{value:"dhl",label:S("dhlShipping")}];o.useEffect(()=>{i>2e3&&h==="economic"&&R("express")},[i,h]),console.log("DEBUG totalWeight:",d,typeof d),console.log("DEBUG selectedCountry:",l),console.log("DEBUG shippingMethod:",h);const s=(h==="dhl"||h==="paraguay")&&te&&K&&z?{L:Number(te),W:Number(K),H:Number(z)}:void 0,m=l&&!L?Us(l,h,i,s,h==="dhl"?q.dhlFuelPercentage:void 0):null,N=m?typeof m=="number"?m:m.total:null,c=Qs(N||0,1e3);o.useEffect(()=>{u&&P&&($(P.full_name||""),D(P.phone_number||""),a(P.address||""),_(P.address_notes||""),b(P.country||""),F(P.postal_code||""),Q(P.city||""),ee(P.state||""))},[u,P]);const w=async()=>{if(!U||!G||!t||!l||!A||!x||!Y){g({title:"Missing Information",description:S("missingAddressInfo"),variant:"destructive"});return}n(!0);try{const{error:r}=await T.from("shipping_quotes").insert({user_id:P?.id,shipping_method:h,destination:l,total_weight:d,estimated_cost:N,shipping_address:{full_name:U,phone_number:G,address:t,address_notes:I,country:l,postal_code:A,city:x,state:Y,...(h==="dhl"||h==="paraguay")&&te&&K&&z?{dimensions:{length:Number(te),width:Number(K),height:Number(z)},...h==="dhl"?{fuel_percentage:q.dhlFuelPercentage}:{}}:{}},items:j.map(Z=>({order_item_id:Z.id,order_id:Z.order_id||"",item_name:Z.product_request.item_name,quantity:Z.product_request.quantity,weight:Z.weight||0,product_url:Z.product_request.product_url}))});if(r)throw r;const{data:J}=await T.from("shipping_quotes").select("id").eq("user_id",P?.id).order("created_at",{ascending:!1}).limit(1).single();if(J){const{data:Z}=await T.from("profiles").select("full_name, user_personal_id").eq("id",P?.id).single(),se=Z?.full_name||"Unknown User",Fe=Z?.user_personal_id?`#${Z.user_personal_id}`:"";await hs("new_shipping_request",`New shipping quote request from ${se} ${Fe} — ${l} (${h}). ${j.length} item${j.length>1?"s":""}, ${d}g total.`,J.id)}g({title:"Shipping Quote Requested",description:S("shippingQuoteRequestedSuccess")}),k?.(),p(!1)}catch(r){console.error("Error submitting shipping quote:",r),g({title:"Error",description:S("shippingQuoteRequestError"),variant:"destructive"})}finally{n(!1)}};return e.jsx(Ms,{open:u,onOpenChange:p,children:e.jsxs(Hs,{className:"max-w-2xl max-h-[90vh] overflow-y-auto rounded-3xl bg-white/95 backdrop-blur-sm border-2 border-capybara-yellow shadow-lg",children:[e.jsxs(Vs,{children:[e.jsxs(Ws,{className:"text-2xl font-heading flex items-center gap-2 text-gray-800",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-capybara-orange to-capybara-yellow rounded-full flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-white"})}),S("requestShippingQuoteTitle")]}),e.jsx(Gs,{className:"text-gray-500 font-body text-sm",children:S("shippingQuoteDescription")})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs(B,{className:"p-4 rounded-2xl bg-capybara-cream border border-capybara-yellow shadow-inner",children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-gray-700",children:[e.jsx(X,{className:"w-4 h-4 text-capybara-orange"}),S("selectedItems")," (",j.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto text-sm font-body text-gray-700",children:j.map(r=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[r.product_request.item_name," ×",r.product_request.quantity]}),e.jsxs("span",{className:"text-gray-500",children:[r.weight,"g"]})]},r.id))}),e.jsxs("div",{className:"mt-3 pt-3 border-t flex justify-between font-semibold text-gray-800",children:[e.jsx("span",{children:S("totalWeight")}),e.jsxs("span",{children:[d,"g"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(C,{className:"text-base font-semibold mb-2 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4 text-capybara-orange"}),S("shippingCountry")]}),e.jsxs(Se,{value:l,onValueChange:b,children:[e.jsx(ke,{className:"rounded-full border-2 border-capybara-orange/20 focus:border-capybara-orange text-sm px-3 py-2",children:e.jsx(Ce,{placeholder:"Select Country"})}),e.jsx(Pe,{className:"rounded-2xl border-2 border-capybara-orange/20 max-h-[300px]",children:ms.map(r=>e.jsx(O,{value:r,children:r},r))})]}),re&&!ie&&e.jsxs("p",{className:"text-xs text-gray-600 text-center",children:["Zone ",re.zone,": ",re.name]}),ie&&e.jsx("p",{className:"text-xs text-gray-600 text-center",children:"DHL Shipping Only"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"font-body text-sm text-gray-700",children:"Shipping Method"}),e.jsx(rt,{value:h,onValueChange:r=>R(r),className:"space-y-2 mt-2",children:f.map(r=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-full bg-capybara-cream transition-colors",children:[e.jsx(it,{value:r.value,id:r.value,className:"w-3 h-3"}),e.jsx(C,{htmlFor:r.value,className:"flex-1 font-body cursor-pointer text-xs",children:e.jsx("span",{className:"font-semibold",children:r.label})})]},r.value))})]}),(h==="dhl"||h==="paraguay")&&e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"font-body text-sm text-gray-700",children:S("dimensionsLabel")}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"length",className:"text-xs",children:S("lengthLabel")}),e.jsx(W,{id:"length",type:"number",min:"1",value:te,onChange:r=>Ie(r.target.value),placeholder:"L",className:"rounded-full border-2 border-capybara-orange/20 focus:border-capybara-orange"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"width",className:"text-xs",children:S("widthLabel")}),e.jsx(W,{id:"width",type:"number",min:"1",value:K,onChange:r=>M(r.target.value),placeholder:"W",className:"rounded-full border-2 border-capybara-orange/20 focus:border-capybara-orange"})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"height",className:"text-xs",children:S("heightLabel")}),e.jsx(W,{id:"height",type:"number",min:"1",value:z,onChange:r=>ae(r.target.value),placeholder:"H",className:"rounded-full border-2 border-capybara-orange/20 focus:border-capybara-orange"})]})]})]})}),N&&e.jsxs(B,{className:"p-4 bg-gradient-to-br bg-gray-700 text-white rounded-2xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-center",children:[c.toLocaleString()," yen"]}),e.jsx("p",{className:"text-gray-300 text-sm text-center",children:S("estimatedInternationalShipping")}),e.jsx("div",{className:"border-t border-gray-200 mt-3 pt-3 space-y-1 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"USD"}),e.jsxs("span",{children:["$",E(N,"usd")]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-base flex items-center gap-2 text-gray-800",children:[e.jsx(We,{className:"w-4 h-4 text-capybara-orange"}),S("shippingAddressLabel")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"fullName",children:[S("fullName")," *"]}),e.jsx(W,{id:"fullName",value:U,onChange:r=>$(r.target.value)})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"phone",children:[S("phoneNumberLabel")," *"]}),e.jsx(W,{id:"phone",value:G,onChange:r=>D(r.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"state",children:[S("stateLabel")," *"]}),e.jsx(W,{id:"state",value:Y,onChange:r=>ee(r.target.value)})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"city",children:[S("cityLabel")," *"]}),e.jsx(W,{id:"city",value:x,onChange:r=>Q(r.target.value)})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"postalCode",children:[S("postalCode")," *"]}),e.jsx(W,{id:"postalCode",value:A,onChange:r=>F(r.target.value)})]})]})]})]}),e.jsxs("div",{children:[e.jsxs(C,{htmlFor:"address",children:[S("deliveryAddress")," *"]}),e.jsx(Re,{id:"address",value:t,onChange:r=>a(r.target.value),rows:2})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"addressNotes",children:S("deliveryNotes")}),e.jsx(Re,{id:"addressNotes",value:I,onChange:r=>_(r.target.value),rows:2})]}),e.jsxs(Js,{children:[e.jsx(y,{variant:"outline",onClick:()=>p(!1),children:S("cancel")}),e.jsx(y,{onClick:w,disabled:v||!N,children:S(v?"requestingQuote":"requestQuote")})]})]})})},Nt=()=>{const u=He(),[p,j]=o.useState([]),[d,k]=o.useState(new Set),[P,g]=o.useState(!0),[E,q]=o.useState(!1),[L,v]=o.useState([]),{t:n}=pe(),l=p.filter(t=>d.has(t.id)),b=l.reduce((t,a)=>t+(a.weight||0),0);o.useEffect(()=>{R(),h()},[]);const h=async()=>{try{const{data:{user:t}}=await T.auth.getUser();if(!t)return;const{data:a,error:I}=await T.from("shipping_quotes").select("*").eq("user_id",t.id).order("created_at",{ascending:!1});if(I)throw I;const _=[];for(const A of a||[]){const F=A.items.map(Q=>Q.order_item_id),x={id:A.id,shipment_personal_id:A.shipment_personal_id,created_at:A.created_at,status:A.status,items:[],total_weight:A.total_weight,destination:A.destination,shipping_method:A.shipping_method};_.push(x)}v(_)}catch(t){console.error("Error fetching shipping quotes:",t)}},R=async()=>{try{const{data:{user:t}}=await T.auth.getUser();if(!t)return;const{data:a,error:I}=await T.from("product_requests").select(`
          id,
          product_url,
          item_name,
          quantity,
          status,
          weight,
          is_box,
          local_tracking_number,
          created_at,
          order_items!left (
            id,
            order:orders!left (
              id,
              order_personal_id,
              created_at
            )
          )
        `).eq("user_id",t.id).eq("status","received").order("created_at",{ascending:!1});if(I)throw I;const _=a?.map(x=>{const Q=x.order_items?.[0],Y=Q?.order;return{id:Q?.id||x.id,product_request_id:x.id,order_id:Y?.id,order_personal_id:Y?.order_personal_id,product_url:x.product_url,item_name:x.item_name,quantity:x.quantity||1,weight:x.weight,status:x.status,created_at:x.created_at,order_created_at:Y?.created_at||x.created_at,is_box:x.is_box,local_tracking_number:x.local_tracking_number,product_request:{item_name:x.item_name||"Unnamed Product",quantity:x.quantity||1,product_url:x.product_url}}})||[];console.log("Fetched storage items:",_.length,"items"),j(_);const{data:A}=await T.from("shipping_quotes").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}),F=[];for(const x of A||[]){const Q=[];for(const Y of x.items){const ee=_.find(te=>te.id===(Y.order_item_id||Y.id));ee&&Q.push(ee)}Q.length>0&&F.push({id:x.id,shipment_personal_id:x.shipment_personal_id,created_at:x.created_at,status:x.status,items:Q,total_weight:x.total_weight,destination:x.destination,shipping_method:x.shipping_method})}v(F)}catch(t){console.error("Error fetching storage items:",t),le.error("Failed to load storage items")}finally{g(!1)}},U=t=>{if(t){const I=p.filter(_=>!L.some(A=>A.status!=="rejected"&&A.items.some(F=>F.id===_.id))).filter(_=>_.weight!==null&&_.weight!==void 0&&!_.is_box);k(new Set(I.map(_=>_.id)))}else k(new Set)},$=(t,a)=>{const I=p.find(F=>F.id===t);if(I&&(I.weight===null||I.weight===void 0)||L.some(F=>F.status!=="rejected"&&F.items.some(x=>x.id===t)))return;if(a&&I){if(I.is_box&&d.size>0&&p.some(x=>d.has(x.id)&&!x.is_box)){le.error("Cannot mix address service items with regular items");return}if(!I.is_box&&d.size>0&&p.some(x=>d.has(x.id)&&x.is_box)){le.error("Cannot mix regular items with address service items");return}}const A=new Set(d);a?A.add(t):A.delete(t),k(A)},G=()=>{if(d.size===0){le.error("Please select at least one item to ship");return}q(!0)};if(P)return e.jsx("div",{className:"flex justify-center p-8",children:"Loading storage items..."});if(p.length===0)return e.jsx(B,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(X,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:n("noItemsAtWarehouse")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:n("noItemsDescription")})]})});const D=p.filter(t=>!L.some(a=>a.status!=="rejected"&&a.items.some(I=>I.id===t.id)));return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:n("warehouseStorage")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n("selectItemsToShip")})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Refresh"}),e.jsx("span",{className:"sm:hidden",children:"Refresh"})]}),e.jsxs(ne,{variant:"outline",className:"text-xs sm:text-sm whitespace-nowrap",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),D.length," ",e.jsx("span",{className:"hidden xs:inline",children:D.length===1?n("itemLabel"):n("itemsLabel")})]})]})]}),D.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-lg font-semibold",children:n("availableItems")}),e.jsx(B,{children:e.jsx(H,{className:"p-0",children:e.jsxs(Es,{children:[e.jsx(Ds,{children:e.jsxs(es,{children:[e.jsx(be,{className:"w-12",children:e.jsx(Ee,{checked:D.filter(t=>t.weight!==null&&t.weight!==void 0&&!t.is_box).length>0&&d.size===D.filter(t=>t.weight!==null&&t.weight!==void 0&&!t.is_box).length,onCheckedChange:U})}),e.jsx(be,{children:n("itemName")}),e.jsx(be,{children:n("quantity")}),e.jsx(be,{children:n("weight")}),e.jsx(be,{children:n("orderNumberShort")}),e.jsx(be,{children:n("arrived")})]})}),e.jsx(Os,{children:D.map(t=>{const a=t.weight!==null&&t.weight!==void 0,I=L.some(x=>x.status!=="rejected"&&x.items.some(Q=>Q.id===t.id)),_=d.size>0&&p.some(x=>d.has(x.id)&&x.is_box),A=d.size>0&&p.some(x=>d.has(x.id)&&!x.is_box),F=t.is_box&&A||!t.is_box&&_;return e.jsxs(es,{className:!a||I||F?"opacity-60":"",children:[e.jsx(Ne,{children:e.jsx(Ee,{checked:d.has(t.id),onCheckedChange:x=>$(t.id,x),disabled:!a||I||F})}),e.jsx(Ne,{children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:t.item_name||n("unnamedProduct")}),t.is_box&&e.jsx(ne,{variant:"secondary",className:"text-xs whitespace-nowrap",children:n("addressService")})]}),e.jsx("div",{className:"max-w-[280px] truncate",children:t.is_box&&t.local_tracking_number?e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(X,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Local Tracking #:"}),e.jsx("span",{children:t.local_tracking_number})]}):e.jsxs("a",{href:t.product_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-blue-600 hover:underline text-xs",title:t.product_url,children:[e.jsx(Je,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.product_url})]})})]})}),e.jsx(Ne,{children:t.quantity}),e.jsx(Ne,{children:a?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(dt,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:[t.weight,"g"]})]}):e.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(fe,{className:"h-3 w-3"}),e.jsx("span",{className:"text-sm",children:n("awaitingWeighing")})]})}),e.jsx(Ne,{children:e.jsxs("span",{className:"text-xs font-mono",children:["#",t.order_personal_id||(t.order_id?t.order_id.slice(0,8):"-")]})}),e.jsx(Ne,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(t.order_created_at).toLocaleDateString()})})]},t.id)})})]})})}),d.size>0&&e.jsx(B,{className:"bg-primary/5 border-primary/20",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[d.size," ",d.size===1?n("itemSelected"):n("itemsSelected")]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n("totalWeight")," ",b,"g"]})]}),e.jsxs(y,{onClick:G,className:"bg-primary hover:bg-primary/90",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),n("requestShippingQuote")]})]})})}),e.jsxs(De,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(Oe,{children:e.jsxs("ul",{className:"text-sm space-y-1 mt-2",children:[e.jsxs("li",{children:["• ",n("storageAlert1")]}),e.jsxs("li",{children:["• ",n("storageAlert2")]}),e.jsxs("li",{children:["• ",n("storageAlert3")]})]})})]})]}),L.filter(t=>t.status==="pending"||t.status==="quoted").length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:n("shippingQuotesRequested")}),L.filter(t=>t.status==="pending"||t.status==="quoted").map(t=>e.jsx(ce,{children:e.jsxs(B,{className:"border-primary/20 bg-primary/5",children:[e.jsx(ue,{children:e.jsx(we,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left",children:[e.jsxs(he,{className:"text-base flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),n("shipmentNumber"),t.shipment_personal_id||t.id.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[t.items.length," items • ",t.total_weight,"g • ",t.destination," • ",t.shipping_method]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{variant:"outline",className:"capitalize",children:t.status}),e.jsx(me,{className:"h-4 w-4 transition-transform duration-200"})]})]})})}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsxs(H,{children:[e.jsx("div",{className:"space-y-2",children:t.items.map(a=>e.jsxs("div",{className:"text-sm p-2 bg-background rounded",children:[e.jsx("span",{className:"font-medium",children:a.item_name||"Unnamed Product"}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:["x",a.quantity]})]},a.id))}),e.jsxs(y,{variant:"outline",className:"w-full mt-4",onClick:()=>u("/user-dashboard?tab=shipping"),children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),n("viewInShipping")]})]})})]})},t.id))]}),e.jsx(bt,{open:E,onOpenChange:q,selectedItems:l,totalWeight:b,onSuccess:()=>{R(),h(),k(new Set)}})]})},_t=()=>{const[u,p]=o.useState([]),[j,d]=o.useState([]),[k,P]=o.useState(!0),[g,E]=o.useState(new Set),[q]=Ve(),[L,v]=o.useState(!1),[n,l]=o.useState(1),[b,h]=o.useState(5),[R,U]=o.useState("all"),[$,G]=o.useState(!1),[D,t]=o.useState(!1),{t:a}=pe(),I=j.filter(s=>s.status==="pending"),_=j.filter(s=>s.status!=="pending"),A=s=>{try{const m=new URL(s),N=m.hostname.replace(/^www\./,""),c=m.pathname+m.search+m.hash,w=c.length>40?c.slice(0,40)+"...":c;return`${N}${w}`}catch{return s}},F=({url:s})=>e.jsxs("a",{href:s,target:"_blank",rel:"noopener noreferrer",title:s,className:"ml-1 inline-flex items-center gap-1 text-xs text-blue-600 hover:underline break-all",children:[e.jsx(Je,{className:"h-3 w-3 flex-shrink-0"}),A(s)]}),x=({item:s})=>s.is_box&&s.local_tracking_number?e.jsxs("div",{className:"ml-1 inline-flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(X,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"font-medium",children:"Local Tracking #:"}),e.jsx("span",{children:s.local_tracking_number})]}):s.product_url?e.jsx(F,{url:s.product_url}):null;o.useEffect(()=>{Q();const m=(async()=>{const{data:{user:N}}=await T.auth.getUser();if(!N)return;const c=T.channel("shipping-updates").on("postgres_changes",{event:"*",schema:"public",table:"shipping_quotes",filter:`user_id=eq.${N.id}`},()=>{Q()}).subscribe();return()=>{T.removeChannel(c)}})();return()=>{m.then(N=>N?.())}},[]),o.useEffect(()=>{const s=q.get("shipmentId");s&&j.length>0&&(E(new Set([`quote-${s}`])),setTimeout(()=>{const m=document.getElementById(`shipment-${s}`);m&&m.scrollIntoView({behavior:"smooth",block:"center"})},100))},[q,j]),o.useEffect(()=>{l(1)},[R,b,$]),o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[n]);const Q=async()=>{try{const{data:{user:s}}=await T.auth.getUser();if(!s)return;const{data:m,error:N}=await T.from("shipping_quotes").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});if(N)throw N;const c=await Promise.all((m||[]).map(async J=>{console.log("=== PROCESSING QUOTE ===",J.shipment_personal_id),console.log("Quote items BEFORE enrichment:",JSON.stringify(J.items,null,2));const Z=await Promise.all(J.items.map(async(se,Fe)=>{if(console.log(`
--- Processing item ${Fe} ---`),console.log("Original item:",JSON.stringify(se,null,2)),se.order_item_id){const{data:qe,error:vs}=await T.from("product_requests").select("product_url, item_name, quantity, weight, has_shipping_issue, shipping_issue_description, is_box, local_tracking_number").eq("id",se.order_item_id).maybeSingle();if(console.log(`Query product_requests with id: ${se.order_item_id}`),console.log("Result:",qe),console.log("Error:",vs),qe){const xe={...se,...qe,item_name:qe.item_name||se.item_name};return console.log("✅ Enriched item (direct):",JSON.stringify(xe,null,2)),xe}const{data:Be,error:ys}=await T.from("order_items").select("product_request_id").eq("id",se.order_item_id).maybeSingle();if(console.log(`Query order_items with id: ${se.order_item_id}`),console.log("Result:",Be),console.log("Error:",ys),Be?.product_request_id){const{data:xe}=await T.from("product_requests").select("product_url, item_name, quantity, weight, has_shipping_issue, shipping_issue_description, is_box, local_tracking_number").eq("id",Be.product_request_id).maybeSingle();if(console.log("Product request via junction:",xe),xe){const Ze={...se,...xe,item_name:xe.item_name||se.item_name};return console.log("✅ Enriched item (via junction):",JSON.stringify(Ze,null,2)),Ze}}}return console.log("❌ No enrichment, returning original"),se}));return console.log("Quote items AFTER enrichment:",JSON.stringify(Z,null,2)),{...J,items:Z,tracking_urls:J.tracking_urls||void 0}}));d(c);const{data:w,error:r}=await T.from("orders").select(`
          *,
          order_items (
            product_request:product_requests (*)
          )
        `).eq("user_id",s.id).eq("status","shipped").order("updated_at",{ascending:!1});if(r)throw r;p(w||[])}catch(s){console.error(a("shippingDataLoadError"),s),le.error(a("shippingDataLoadError"))}finally{P(!1)}},Y=async()=>{v(!0);try{await Q(),le.success(a("shippingDataUpdated"))}catch{le.error(a("shippingDataUpdateError"))}finally{v(!1)}},ee=s=>{const m=new Set(g);m.has(s)?m.delete(s):m.add(s),E(m)},te=s=>{if(s==="rejected")return[{label:a("requestSubmittedStatus"),status:"completed",icon:e.jsx(X,{className:"h-4 w-4"})},{label:a("statusRejectedBadge"),status:"rejected",icon:e.jsx(fe,{className:"h-4 w-4"})}];const m=[{label:a("requestSubmittedStatus"),status:"upcoming",icon:e.jsx(X,{className:"h-4 w-4"})},{label:a("awaitingPaymentStatus"),status:"upcoming",icon:e.jsx(ze,{className:"h-4 w-4"})},{label:a("paymentReceivedStatus"),status:"upcoming",icon:e.jsx(Te,{className:"h-4 w-4"})},{label:a("itemsShipped"),status:"upcoming",icon:e.jsx(V,{className:"h-4 w-4"})}];return s==="pending"?m[0].status="current":s==="quoted"?(m[0].status="completed",m[1].status="current"):s==="paid"?(m[0].status="completed",m[1].status="completed",m[2].status="completed",m[3].status="current"):(s==="shipped"||s==="sent")&&m.forEach(N=>N.status="completed"),m},Ie=()=>[{label:"Processing",status:"completed",icon:e.jsx(de,{className:"h-4 w-4"})},{label:"Shipped",status:"current",icon:e.jsx(V,{className:"h-4 w-4"})},{label:"In Transit",status:"upcoming",icon:e.jsx(X,{className:"h-4 w-4"})},{label:"Delivered",status:"upcoming",icon:e.jsx(je,{className:"h-4 w-4"})}];if(k)return e.jsx("div",{className:"flex justify-center p-8",children:a("loadingShipments")});if(j.length===0&&u.length===0)return e.jsx(B,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a("noShipmentsYet")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a("noShipmentsDescription")})]})});const K=[...I.map(s=>({...s,type:"pending_quote"})),..._.map(s=>({...s,type:"processed_quote"})),...u.map(s=>({...s,type:"shipped_order"}))];let M=K;R==="awaiting_quote"?M=K.filter(s=>s.type==="pending_quote"):R==="quoted"?M=K.filter(s=>s.type==="processed_quote"&&s.status==="quoted"):R==="paid"?M=K.filter(s=>s.type==="processed_quote"&&s.status==="paid"):R==="shipped"?M=K.filter(s=>s.type==="processed_quote"&&(s.status==="shipped"||s.status==="sent")||s.type==="shipped_order"):R==="rejected"&&(M=K.filter(s=>s.type==="processed_quote"&&s.status==="rejected")),$&&(M=M.filter(s=>!(s.type==="processed_quote"&&s.status==="rejected")));const z=Math.ceil(M.length/b),ae=(n-1)*b,S=ae+b,re=M.slice(ae,S),ie=re.filter(s=>s.type==="pending_quote"),i=re.filter(s=>s.type==="processed_quote"),f=re.filter(s=>s.type==="shipped_order");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:a("shippingTitle")}),e.jsxs(y,{variant:"outline",onClick:()=>t(!D),className:"mb-4 gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),a("filterShipments"),D?e.jsx(ve,{className:"h-4 w-4"}):e.jsx(me,{className:"h-4 w-4"})]}),e.jsx(ce,{open:D,onOpenChange:t,children:e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsx(B,{className:"bg-muted/30 mb-4",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:`\r
        flex flex-wrap items-center justify-between gap-3\r
        md:justify-start\r
      `,children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:a("statusFilter")}),e.jsxs(Se,{value:R,onValueChange:U,children:[e.jsx(ke,{className:"w-[190px]",children:e.jsx(Ce,{placeholder:a("selectStatus")})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"all",children:a("allStatuses")}),e.jsx(O,{value:"awaiting_quote",children:a("statusAwaitingQuote")}),e.jsx(O,{value:"quoted",children:a("statusQuoted")}),e.jsx(O,{value:"paid",children:a("statusPaymentReceived")}),e.jsx(O,{value:"shipped",children:a("statusShippedBadge")}),e.jsx(O,{value:"rejected",children:a("statusRejectedBadge")})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:a("showPerPage")}),e.jsxs(Se,{value:b.toString(),onValueChange:s=>h(Number(s)),children:[e.jsx(ke,{className:"w-[90px]",children:e.jsx(Ce,{})}),e.jsxs(Pe,{children:[e.jsx(O,{value:"5",children:"5"}),e.jsx(O,{value:"10",children:"10"}),e.jsx(O,{value:"25",children:"25"}),e.jsx(O,{value:"50",children:"50"})]})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:a("perPage")})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{id:"hide-rejected",checked:$,onCheckedChange:s=>G(s===!0)}),e.jsx("label",{htmlFor:"hide-rejected",className:"text-sm font-medium cursor-pointer whitespace-nowrap",children:a("hideRejected")})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:Y,disabled:L,className:"gap-2",children:[e.jsx(Ge,{className:`h-4 w-4 ${L?"animate-spin":""}`}),a(L?"refreshing":"update")]})]})]}),M.length>0&&e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:[a("showingShipments")," ",ae+1,"-",Math.min(S,M.length)," ",a("ofShipments")," ",M.length," ",a("shipmentsText")]})]})})})}),M.length===0&&(j.length>0||u.length>0)&&e.jsx(B,{children:e.jsxs(H,{className:"p-8 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a("noShipmentsWithFilter")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a("noShipmentsWithFilter")})]})}),ie.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-yellow-600"}),a("shippingRequestsAwaitingQuote"),e.jsx(ne,{variant:"outline",className:"border-yellow-500 text-yellow-700",children:I.length})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("awaitingQuoteDescription")}),ie.map(s=>{const m=g.has(`quote-${s.id}`),N=s.items.reduce((c,w)=>c+(w.quantity||1),0);return e.jsx(ce,{open:m,children:e.jsxs(B,{id:`shipment-${s.id}`,className:"border-primary/20",children:[e.jsxs(ue,{className:"cursor-pointer",onClick:()=>ee(`quote-${s.id}`),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(he,{className:"text-lg flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),a("shipmentNumber"),s.shipment_personal_id||s.id.slice(0,8)]}),e.jsxs(ne,{className:s.status==="pending"?"bg-yellow-100 text-yellow-800 border-yellow-200":s.status==="quoted"?"bg-blue-100 text-blue-800 border-blue-200":s.status==="paid"?"bg-green-100 text-green-800 border-green-200":s.status==="rejected"?"bg-red-100 text-red-800 border-red-200":"bg-purple-100 text-purple-800 border-purple-200",children:[s.status==="pending"&&a("statusAwaitingQuoteBadge"),s.status==="quoted"&&a("statusAwaitingPaymentBadge"),s.status==="paid"&&a("statusPaymentReceivedBadge"),(s.status==="shipped"||s.status==="sent")&&a("statusShippedBadge"),s.status==="rejected"&&a("statusRejectedBadge")]})]}),e.jsx(we,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ee(`quote-${s.id}`),children:m?e.jsx(ve,{}):e.jsx(me,{})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[a("requestedOn")," ",new Date(s.created_at).toLocaleDateString()," •",N," ",N===1?"item":"items"," •",s.total_weight,"g •",s.destination," •",s.shipping_method]})]}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx(Le,{steps:te(s.status)}),s.status==="rejected"&&s.rejection_reason&&e.jsxs(De,{variant:"destructive",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(Me,{children:a("rejectionReasonTitle")}),e.jsx(Oe,{children:s.rejection_reason})]}),s.quote_url&&s.status==="quoted"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:a("paymentLinkAvailable")}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:a("clickToPay")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>window.open(s.quote_url,"_blank"),children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),a("payNow")]})]})}),s.quote_url&&(s.status==="paid"||s.status==="shipped"||s.status==="sent")&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:a("paymentConfirmed")}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:a("shippingPaymentReceived")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-green-500 text-green-700 hover:bg-green-50",onClick:()=>window.open(s.quote_url,"_blank"),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),a("viewInvoice")]})]})}),(s.status==="shipped"||s.status==="sent")&&(()=>{const c=s.items.filter(w=>w.is_box===!0);return console.log("Box Items:",c),c.length>0?e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:"Track Your Boxes"}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:"Each box can be tracked individually"})]}),e.jsx("div",{className:"space-y-3",children:c.map((w,r)=>{console.log("Individual Box Item:",w);const J=s.tracking_urls?.find(Z=>Z.item_id===w.order_item_id);return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white rounded border border-purple-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-purple-700"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:w.item_name||`Box ${r+1}`}),w.local_tracking_number&&e.jsxs("p",{className:"text-xs text-purple-600",children:["Tracking: ",w.local_tracking_number]})]})]}),J?.tracking_url&&e.jsxs(y,{size:"sm",variant:"outline",className:"border-purple-500 text-purple-700 hover:bg-purple-50",onClick:()=>window.open(J.tracking_url,"_blank"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),a("trackPackage")]})]},w.order_item_id||r)})})]}):s.tracking_url?e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:a("shipmentTracking")}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:a("shipmentTrackingInfo")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-purple-500 text-purple-700 hover:bg-purple-50",onClick:()=>window.open(s.tracking_url,"_blank"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),a("trackPackage")]})]})}):null})(),(s.estimated_cost||s.actual_cost)&&e.jsx("div",{className:"bg-primary/5 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.estimated_cost&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("estimatedCost")}),e.jsxs("p",{className:"text-lg font-semibold",children:["¥",s.estimated_cost.toLocaleString()]})]}),s.actual_cost&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("finalQuote")}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["¥",s.actual_cost.toLocaleString()]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:a("itemsInShipment")}),s.status==="rejected"&&s.rejection_details?.product_issues?s.rejection_details.product_issues.map((c,w)=>{const r=c.has_issue;return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${r?"bg-destructive/10 border border-destructive/30":"bg-secondary/30"}`,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[r&&e.jsx(ye,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${r?"text-destructive":""}`,children:c.item_name||"Unnamed Product"}),e.jsx(x,{item:c}),r&&c.issue_description&&e.jsxs("p",{className:"text-xs text-destructive/80 mt-1",children:[a("issuePrefix")," ",c.issue_description]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Qty: ",c.quantity||1]}),c.weight&&e.jsxs("span",{className:"text-xs text-muted-foreground block",children:[c.weight,"g"]})]})]},w)}):s.items.map((c,w)=>{const r=c.has_shipping_issue&&s.status==="rejected";return e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${r?"bg-destructive/10 border border-destructive/30":"bg-secondary/30"}`,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[r&&e.jsx(ye,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${r?"text-destructive":""}`,children:c.item_name||"Unnamed Product"}),e.jsx(x,{item:c}),r&&c.shipping_issue_description&&e.jsxs("p",{className:"text-xs text-destructive/80 mt-1",children:[a("issuePrefix")," ",c.shipping_issue_description]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Qty: ",c.quantity||1]}),c.weight&&e.jsxs("span",{className:"text-xs text-muted-foreground block",children:[c.weight,"g"]})]})]},w)})]}),s.shipping_address&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:a("shippingAddressLabel")}),e.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressName")})," ",s.shipping_address.full_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressPhone")})," ",s.shipping_address.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("address")})," ",s.shipping_address.address]}),s.shipping_address.address_notes&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressNotes")})," ",s.shipping_address.address_notes]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("cityState")})," ",s.shipping_address.city||"-",", ",s.shipping_address.state||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("postalCode")})," ",s.shipping_address.postal_code]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("country")})," ",s.shipping_address.country]})]})]})]})})]})},s.id)})]}),i.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),a("shipmentsTitle"),e.jsx(ne,{variant:"outline",children:_.length})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("shipmentsDescription")}),i.map(s=>{const m=g.has(`quote-${s.id}`),N=s.items.reduce((c,w)=>c+(w.quantity||1),0);return e.jsx(ce,{open:m,children:e.jsxs(B,{className:"border-primary/20",children:[e.jsxs(ue,{onClick:()=>ee(`quote-${s.id}`),className:"cursor-pointer hover:bg-muted/50 transition-colors border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(he,{className:"text-lg flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),a("shipmentNumber"),s.shipment_personal_id||s.id.slice(0,8)]}),e.jsxs(ne,{className:s.status==="quoted"?"bg-blue-100 text-blue-800 border-blue-200":s.status==="paid"?"bg-green-100 text-green-800 border-green-200":s.status==="rejected"?"bg-red-100 text-red-800 border-red-200":"bg-purple-100 text-purple-800 border-purple-200",children:[s.status==="quoted"&&a("statusAwaitingPaymentBadge"),s.status==="paid"&&a("statusPaymentReceivedBadge"),(s.status==="shipped"||s.status==="sent")&&a("statusShippedBadge"),s.status==="rejected"&&a("statusRejectedBadge")]})]}),e.jsx(we,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ee(`quote-${s.id}`),children:m?e.jsx(ve,{}):e.jsx(me,{})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[a("requestedOn")," ",new Date(s.created_at).toLocaleDateString()," •",N," ",N===1?"item":"items"," •",s.total_weight,"g •",s.destination," •",s.shipping_method]})]}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx(Le,{steps:te(s.status)}),s.status==="rejected"&&s.rejection_reason&&e.jsxs(De,{variant:"destructive",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(Me,{children:a("rejectionReasonTitle")}),e.jsx(Oe,{children:s.rejection_reason})]}),s.quote_url&&s.status==="quoted"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900",children:a("paymentLinkAvailable")}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:a("clickToPay")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-blue-500 text-blue-700 hover:bg-blue-50",onClick:()=>window.open(s.quote_url,"_blank"),children:[e.jsx(ze,{className:"h-4 w-4 mr-1"}),a("payNow")]})]})}),s.quote_url&&(s.status==="paid"||s.status==="shipped"||s.status==="sent")&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-900",children:a("paymentConfirmed")}),e.jsx("p",{className:"text-xs text-green-700 mt-1",children:a("shippingPaymentReceived")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-green-500 text-green-700 hover:bg-green-50",onClick:()=>window.open(s.quote_url,"_blank"),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),a("viewInvoice")]})]})}),(s.status==="shipped"||s.status==="sent")&&e.jsx(e.Fragment,{children:s.tracking_urls&&s.tracking_urls.length>0?e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:a("shipmentTracking")}),s.tracking_urls.map((c,w)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 py-2 border-t first:border-t-0",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(X,{className:"h-4 w-4 text-purple-700 mt-0.5 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-sm text-purple-900",children:s.items.find(r=>r.order_item_id===c.item_id)?.item_name||"Package"})})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-purple-500 text-purple-700 hover:bg-purple-50 flex-shrink-0",onClick:()=>window.open(c.tracking_url,"_blank"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),a("trackPackage")]})]},c.item_id))]}):s.tracking_url?e.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-900",children:a("shipmentTracking")}),e.jsx("p",{className:"text-xs text-purple-700 mt-1",children:a("shipmentTrackingInfo")})]}),e.jsxs(y,{size:"sm",variant:"outline",className:"border-purple-500 text-purple-700 hover:bg-purple-50",onClick:()=>window.open(s.tracking_url,"_blank"),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),a("trackPackage")]})]})}):null}),(s.estimated_cost||s.actual_cost)&&e.jsx("div",{className:"bg-primary/5 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.estimated_cost&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("estimatedCost")}),e.jsxs("p",{className:"text-lg font-semibold",children:["¥",s.estimated_cost.toLocaleString()]})]}),s.actual_cost&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("finalQuote")}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["¥",s.actual_cost.toLocaleString()]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:a("items")}),s.status==="rejected"&&s.rejection_details?.product_issues?s.rejection_details.product_issues.map((c,w)=>{const r=c.has_issue;return e.jsxs("div",{className:`flex items-start justify-between py-2 border-b last:border-0 ${r?"bg-red-50 -mx-2 px-2 rounded":""}`,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[r&&e.jsx(ye,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${r?"text-destructive":""}`,children:c.item_name||"Unnamed Product"}),e.jsx(x,{item:c}),r&&c.issue_description&&e.jsxs("p",{className:"text-xs text-destructive/80 mt-1",children:[a("issuePrefix")," ",c.issue_description]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Qty: ",c.quantity||1]}),c.weight&&e.jsxs("span",{className:"text-xs text-muted-foreground block",children:[c.weight,"g"]})]})]},w)}):s.items.map((c,w)=>{const r=c.has_shipping_issue;return e.jsxs("div",{className:`flex items-start justify-between py-2 border-b last:border-0 ${r?"bg-red-50 -mx-2 px-2 rounded":""}`,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[r&&e.jsx(ye,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${r?"text-destructive":""}`,children:c.item_name||"Unnamed Product"}),e.jsx(x,{item:c}),r&&c.shipping_issue_description&&e.jsxs("p",{className:"text-xs text-destructive/80 mt-1",children:[a("issuePrefix")," ",c.shipping_issue_description]})]})]})}),e.jsxs("div",{className:"text-right",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Qty: ",c.quantity||1]}),c.weight&&e.jsxs("span",{className:"text-xs text-muted-foreground block",children:[c.weight,"g"]})]})]},w)})]}),s.shipping_address&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:a("shippingAddressLabel")}),e.jsxs("div",{className:"text-sm text-gray-700 bg-gray-50 border border-gray-200 rounded-lg p-3 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressName")})," ",s.shipping_address.full_name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressPhone")})," ",s.shipping_address.phone_number]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("address")})," ",s.shipping_address.address]}),s.shipping_address.address_notes&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("addressNotes")})," ",s.shipping_address.address_notes]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("cityState")})," ",s.shipping_address.city||"-",", ",s.shipping_address.state||"-"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("postalCode")})," ",s.shipping_address.postal_code]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:a("country")})," ",s.shipping_address.country]})]})]})]})})]})},s.id)})]}),f.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Shipped Orders"]}),f.map(s=>{const m=g.has(`order-${s.id}`),N=s.order_items?.reduce((c,w)=>c+(w.product_request.quantity||1),0)||0;return e.jsx(ce,{open:m,children:e.jsxs(B,{children:[e.jsxs(ue,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(he,{className:"text-lg",children:["Order #",s.id.slice(0,8)]}),e.jsxs(ne,{className:"bg-blue-100 text-blue-800",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"Shipped"]})]}),e.jsx(we,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ee(`order-${s.id}`),children:m?e.jsx(ve,{}):e.jsx(me,{})})})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Shipped on ",s.shipped_at?new Date(s.shipped_at).toLocaleDateString():"N/A"," • ",N," ",N===1?"item":"items"]})]}),e.jsx(oe,{className:"overflow-hidden data-[state=open]:animate-collapsible-down data-[state=closed]:animate-collapsible-up",children:e.jsxs(H,{className:"space-y-4",children:[e.jsx(Le,{steps:Ie()}),s.tracking_number&&e.jsx("div",{className:"bg-primary/5 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Tracking Number"}),e.jsx("p",{className:"text-lg font-mono",children:s.tracking_number})]}),e.jsxs(y,{variant:"outline",size:"sm",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Track Package"]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Items in this shipment:"}),s.order_items?.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-secondary/30 rounded",children:[e.jsx("p",{className:"text-sm",children:c.product_request.item_name||"Unnamed Product"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Qty: ",c.product_request.quantity||1]})]},c.product_request.id))]})]})})]})},s.id)})]}),M.length>0&&z>1&&e.jsx(B,{className:"bg-muted/30",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>l(s=>Math.max(1,s-1)),disabled:n===1,children:[e.jsx(os,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-2",children:Array.from({length:z},(s,m)=>m+1).map(s=>e.jsx(y,{variant:n===s?"default":"outline",size:"sm",onClick:()=>l(s),className:"min-w-[40px]",children:s},s))}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>l(s=>Math.min(z,s+1)),disabled:n===z,children:["Next",e.jsx(ts,{className:"h-4 w-4 ml-1"})]})]})})})]})},vt=()=>{const{t:u}=pe(),p=ks(),j=He(),[d]=Ve(),[k,P]=o.useState("submit");o.useEffect(()=>{const n=d.get("tab");n&&["submit","orders","storage","shipping","profile","notifications"].includes(n)&&P(n)},[d.toString()]),o.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[k]);const g=[{id:"orders",label:u("orders"),icon:X},{id:"storage",label:u("storage"),icon:ge},{id:"shipping",label:u("shipping"),icon:V},{id:"profile",label:u("profile"),icon:ls}],q=[{id:"submit",label:u("submitRequest"),icon:ps},...g],L=()=>e.jsxs("div",{className:`${p?"hidden":"w-64 bg-white/90 backdrop-blur-sm border-r border-blue-200 min-h-screen"} p-6`,children:[e.jsx("div",{className:"flex items-center space-x-3 pl-4 mb-8",children:e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-800",children:u("dashboard")}),e.jsx("p",{className:"text-sm text-gray-600",children:"User Panel"})]})}),e.jsx("nav",{className:"space-y-2",children:q.map(n=>{const l=n.icon;return e.jsxs(y,{variant:k===n.id?"default":"ghost",className:"w-full justify-start",onClick:()=>j(`/user-dashboard?tab=${n.id}`,{replace:!0}),children:[e.jsx(l,{className:"mr-2 h-4 w-4"}),n.label]},n.id)})})]}),v=()=>e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-40 bg-background border-t border-capybara-yellow shadow-lg md:hidden",children:e.jsxs("nav",{className:"flex items-stretch justify-around h-16",children:[" ",g.map(n=>{const l=n.icon,b=k===n.id;return e.jsxs("button",{onClick:()=>j(`/user-dashboard?tab=${n.id}`,{replace:!0}),className:`bg-white/95 flex flex-1 flex-col justify-center items-center gap-1 transition-all ${b?"text-capybara-orange":"text-gray-700 hover:text-capybara-orange hover:capybara-cream"}`,children:[e.jsx(l,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs font-medium",children:n.label})]},n.id)})]})});return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex",children:[e.jsx(L,{}),e.jsxs("div",{className:`flex-1 p-4 md:p-8 min-w-0 overflow-x-auto ${p?"pb-24":""}`,children:[k==="submit"&&e.jsx("div",{className:"max-w-2xl",children:e.jsx(gt,{})}),k==="shipping"&&e.jsx(_t,{}),k==="storage"&&e.jsx(Nt,{}),k==="orders"&&e.jsx(jt,{}),k==="profile"&&e.jsx(xt,{}),k==="notifications"&&e.jsx(Fs,{})]})]}),p&&e.jsx(v,{})]})},yt=()=>e.jsx(Cs,{children:e.jsx(vt,{})}),ma=ws(yt);export{ma as default};
